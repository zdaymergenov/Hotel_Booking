import{SvelteComponent as pe,init as ge,safe_not_equal as ve,svg_element as X,claim_svg_element as G,children as D,detach as v,attr as h,insert_hydration as Z,append_hydration as E,noop as F,text as we,claim_text as ye,empty as Se,group_outros as _e,transition_out as z,check_outros as be,transition_in as A,create_component as ee,claim_component as te,mount_component as ie,destroy_component as ne,element as x,claim_element as H,listen as $,run_all as Be,onMount as nt,binding_callbacks as he,space as J,claim_space as Q,set_style as Re,toggle_class as Ne,set_data as rt,bind as Me,add_flush_callback as De,get_svelte_dataset as Ve,createEventDispatcher as at,bubble as ut}from"../../../svelte/svelte.js";import"../../../svelte/svelte-submodules.js";import{R as je}from"./2.BPD7TSJN.js";import{M as ht}from"./Music.BVFRDHso.js";import{P as dt,T as ct}from"./Trim.CWFkmJwA.js";import{P as ft}from"./Play.DJ4h2PVY.js";import{U as mt}from"./Undo.LhwFM5M8.js";import{E as pt}from"./Empty.D5XVnMZ_.js";import{H as Ee}from"./hls.C_AVPmGC.js";function gt(o){let e,t;return{c(){e=X("svg"),t=X("path"),this.h()},l(i){e=G(i,"svg",{xmlns:!0,width:!0,height:!0,fill:!0,"stroke-width":!0,viewBox:!0,color:!0});var n=D(e);t=G(n,"path",{stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),D(t).forEach(v),n.forEach(v),this.h()},h(){h(t,"stroke","currentColor"),h(t,"stroke-width","1.5"),h(t,"stroke-linecap","round"),h(t,"stroke-linejoin","round"),h(t,"d","M21.044 5.704a.6.6 0 0 1 .956.483v11.626a.6.6 0 0 1-.956.483l-7.889-5.813a.6.6 0 0 1 0-.966l7.89-5.813ZM10.044 5.704a.6.6 0 0 1 .956.483v11.626a.6.6 0 0 1-.956.483l-7.888-5.813a.6.6 0 0 1 0-.966l7.888-5.813Z"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24px"),h(e,"height","24px"),h(e,"fill","currentColor"),h(e,"stroke-width","1.5"),h(e,"viewBox","0 0 24 24"),h(e,"color","currentColor")},m(i,n){Z(i,e,n),E(e,t)},p:F,i:F,o:F,d(i){i&&v(e)}}}class vt extends pe{constructor(e){super(),ge(this,e,null,gt,ve,{})}}function _t(o){let e,t,i,n;return{c(){e=X("svg"),t=X("rect"),i=X("text"),n=we("CC"),this.h()},l(r){e=G(r,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var s=D(e);t=G(s,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0,ry:!0}),D(t).forEach(v),i=G(s,"text",{x:!0,y:!0,"font-family":!0,"font-size":!0,"font-weight":!0,fill:!0,stroke:!0,"text-anchor":!0});var l=D(i);n=ye(l,"CC"),l.forEach(v),s.forEach(v),this.h()},h(){h(t,"x","2"),h(t,"y","6"),h(t,"width","20"),h(t,"height","12"),h(t,"rx","2"),h(t,"ry","2"),h(i,"x","12"),h(i,"y","15"),h(i,"font-family","sans-serif"),h(i,"font-size","8"),h(i,"font-weight","bold"),h(i,"fill","currentColor"),h(i,"stroke","none"),h(i,"text-anchor","middle"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","100%"),h(e,"height","100%"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","1"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","feather feather-closed-caption")},m(r,s){Z(r,e,s),E(e,t),E(e,i),E(i,n)},p:F,i:F,o:F,d(r){r&&v(e)}}}class bt extends pe{constructor(e){super(),ge(this,e,null,_t,ve,{})}}function wt(o){let e,t;return{c(){e=X("svg"),t=X("path"),this.h()},l(i){e=G(i,"svg",{xmlns:!0,width:!0,height:!0,fill:!0,"stroke-width":!0,viewBox:!0,color:!0});var n=D(e);t=G(n,"path",{stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),D(t).forEach(v),n.forEach(v),this.h()},h(){h(t,"stroke","currentColor"),h(t,"stroke-width","1.5"),h(t,"stroke-linecap","round"),h(t,"stroke-linejoin","round"),h(t,"d","M2.956 5.704A.6.6 0 0 0 2 6.187v11.626a.6.6 0 0 0 .956.483l7.889-5.813a.6.6 0 0 0 0-.966l-7.89-5.813ZM13.956 5.704a.6.6 0 0 0-.956.483v11.626a.6.6 0 0 0 .956.483l7.889-5.813a.6.6 0 0 0 0-.966l-7.89-5.813Z"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24px"),h(e,"height","24px"),h(e,"fill","currentColor"),h(e,"stroke-width","1.5"),h(e,"viewBox","0 0 24 24"),h(e,"color","currentColor")},m(i,n){Z(i,e,n),E(e,t)},p:F,i:F,o:F,d(i){i&&v(e)}}}class yt extends pe{constructor(e){super(),ge(this,e,null,wt,ve,{})}}function kt(o){let e,t,i,n,r;return{c(){e=X("svg"),t=X("title"),i=we("Low volume"),n=X("path"),r=X("path"),this.h()},l(s){e=G(s,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,xmlns:!0,stroke:!0,color:!0});var l=D(e);t=G(l,"title",{});var u=D(t);i=ye(u,"Low volume"),u.forEach(v),n=G(l,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),D(n).forEach(v),r=G(l,"path",{d:!0,"stroke-width":!0}),D(r).forEach(v),l.forEach(v),this.h()},h(){h(n,"d","M19.5 7.5C19.5 7.5 21 9 21 11.5C21 14 19.5 15.5 19.5 15.5"),h(n,"stroke-width","1.5"),h(n,"stroke-linecap","round"),h(n,"stroke-linejoin","round"),h(r,"d","M2 13.8571V10.1429C2 9.03829 2.89543 8.14286 4 8.14286H6.9C7.09569 8.14286 7.28708 8.08544 7.45046 7.97772L13.4495 4.02228C14.1144 3.5839 15 4.06075 15 4.85714V19.1429C15 19.9392 14.1144 20.4161 13.4495 19.9777L7.45046 16.0223C7.28708 15.9146 7.09569 15.8571 6.9 15.8571H4C2.89543 15.8571 2 14.9617 2 13.8571Z"),h(r,"stroke-width","1.5"),h(e,"width","100%"),h(e,"height","100%"),h(e,"viewBox","0 0 24 24"),h(e,"stroke-width","1.5"),h(e,"fill","none"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"stroke","currentColor"),h(e,"color","currentColor")},m(s,l){Z(s,e,l),E(e,t),E(t,i),E(e,n),E(e,r)},p:F,i:F,o:F,d(s){s&&v(e)}}}class Ct extends pe{constructor(e){super(),ge(this,e,null,kt,ve,{})}}function Et(o){let e,t,i,n,r,s;return{c(){e=X("svg"),t=X("title"),i=we("High volume"),n=X("path"),r=X("path"),s=X("path"),this.h()},l(l){e=G(l,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,stroke:!0,xmlns:!0,color:!0});var u=D(e);t=G(u,"title",{});var d=D(t);i=ye(d,"High volume"),d.forEach(v),n=G(u,"path",{d:!0,"stroke-width":!0}),D(n).forEach(v),r=G(u,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),D(r).forEach(v),s=G(u,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),D(s).forEach(v),u.forEach(v),this.h()},h(){h(n,"d","M1 13.8571V10.1429C1 9.03829 1.89543 8.14286 3 8.14286H5.9C6.09569 8.14286 6.28708 8.08544 6.45046 7.97772L12.4495 4.02228C13.1144 3.5839 14 4.06075 14 4.85714V19.1429C14 19.9392 13.1144 20.4161 12.4495 19.9777L6.45046 16.0223C6.28708 15.9146 6.09569 15.8571 5.9 15.8571H3C1.89543 15.8571 1 14.9617 1 13.8571Z"),h(n,"stroke-width","1.5"),h(r,"d","M17.5 7.5C17.5 7.5 19 9 19 11.5C19 14 17.5 15.5 17.5 15.5"),h(r,"stroke-width","1.5"),h(r,"stroke-linecap","round"),h(r,"stroke-linejoin","round"),h(s,"d","M20.5 4.5C20.5 4.5 23 7 23 11.5C23 16 20.5 18.5 20.5 18.5"),h(s,"stroke-width","1.5"),h(s,"stroke-linecap","round"),h(s,"stroke-linejoin","round"),h(e,"width","100%"),h(e,"height","100%"),h(e,"viewBox","0 0 24 24"),h(e,"stroke-width","1.5"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"color","currentColor")},m(l,u){Z(l,e,u),E(e,t),E(t,i),E(e,n),E(e,r),E(e,s)},p:F,i:F,o:F,d(l){l&&v(e)}}}class Lt extends pe{constructor(e){super(),ge(this,e,null,Et,ve,{})}}function Mt(o){let e,t,i,n,r,s,l,u,d;return{c(){e=X("svg"),t=X("title"),i=we("Muted volume"),n=X("g"),r=X("path"),s=X("path"),l=X("defs"),u=X("clipPath"),d=X("rect"),this.h()},l(a){e=G(a,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,xmlns:!0,stroke:!0,color:!0});var c=D(e);t=G(c,"title",{});var k=D(t);i=ye(k,"Muted volume"),k.forEach(v),n=G(c,"g",{"clip-path":!0});var f=D(n);r=G(f,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),D(r).forEach(v),s=G(f,"path",{d:!0,"stroke-width":!0}),D(s).forEach(v),f.forEach(v),l=G(c,"defs",{});var p=D(l);u=G(p,"clipPath",{id:!0});var C=D(u);d=G(C,"rect",{width:!0,height:!0,fill:!0}),D(d).forEach(v),C.forEach(v),p.forEach(v),c.forEach(v),this.h()},h(){h(r,"d","M18 14L20.0005 12M22 10L20.0005 12M20.0005 12L18 10M20.0005 12L22 14"),h(r,"stroke-width","1.5"),h(r,"stroke-linecap","round"),h(r,"stroke-linejoin","round"),h(s,"d","M2 13.8571V10.1429C2 9.03829 2.89543 8.14286 4 8.14286H6.9C7.09569 8.14286 7.28708 8.08544 7.45046 7.97772L13.4495 4.02228C14.1144 3.5839 15 4.06075 15 4.85714V19.1429C15 19.9392 14.1144 20.4161 13.4495 19.9777L7.45046 16.0223C7.28708 15.9146 7.09569 15.8571 6.9 15.8571H4C2.89543 15.8571 2 14.9617 2 13.8571Z"),h(s,"stroke-width","1.5"),h(n,"clip-path","url(#clip0_3173_16686)"),h(d,"width","24"),h(d,"height","24"),h(d,"fill","white"),h(u,"id","clip0_3173_16686"),h(e,"width","100%"),h(e,"height","100%"),h(e,"viewBox","0 0 24 24"),h(e,"stroke-width","1.5"),h(e,"fill","none"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"stroke","currentColor"),h(e,"color","currentColor")},m(a,c){Z(a,e,c),E(e,t),E(t,i),E(e,n),E(n,r),E(n,s),E(e,l),E(l,u),E(u,d)},p:F,i:F,o:F,d(a){a&&v(e)}}}class Dt extends pe{constructor(e){super(),ge(this,e,null,Mt,ve,{})}}var Tt=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function l(a){try{d(i.next(a))}catch(c){s(c)}}function u(a){try{d(i.throw(a))}catch(c){s(c)}}function d(a){a.done?r(a.value):n(a.value).then(l,u)}d((i=i.apply(o,e||[])).next())})};function St(o,e){return Tt(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:e});return t.decodeAudioData(o).finally(()=>t.close())})}function Rt(o){const e=o[0];if(e.some(t=>t>1||t<-1)){const t=e.length;let i=0;for(let n=0;n<t;n++){const r=Math.abs(e[n]);r>i&&(i=r)}for(const n of o)for(let r=0;r<t;r++)n[r]/=i}return o}function Pt(o,e){return typeof o[0]=="number"&&(o=[o]),Rt(o),{duration:e,length:o[0].length,sampleRate:o[0].length/e,numberOfChannels:o.length,getChannelData:t=>o==null?void 0:o[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}const Ie={decode:St,createBuffer:Pt};var Ze=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function l(a){try{d(i.next(a))}catch(c){s(c)}}function u(a){try{d(i.throw(a))}catch(c){s(c)}}function d(a){a.done?r(a.value):n(a.value).then(l,u)}d((i=i.apply(o,e||[])).next())})};function At(o,e,t){var i,n;return Ze(this,void 0,void 0,function*(){const r=yield fetch(o,t);{const s=(i=r.clone().body)===null||i===void 0?void 0:i.getReader(),l=Number((n=r.headers)===null||n===void 0?void 0:n.get("Content-Length"));let u=0;const d=(a,c)=>Ze(this,void 0,void 0,function*(){if(a)return;u+=(c==null?void 0:c.length)||0;const k=Math.round(u/l*100);return e(k),s==null?void 0:s.read().then(({done:f,value:p})=>d(f,p))});s==null||s.read().then(({done:a,value:c})=>d(a,c))}return r.blob()})}const Wt={fetchBlob:At};class xe{constructor(){this.listeners={},this.on=this.addEventListener,this.un=this.removeEventListener}addEventListener(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),i!=null&&i.once){const n=()=>{this.removeEventListener(e,n),this.removeEventListener(e,t)};return this.addEventListener(e,n),n}return()=>this.removeEventListener(e,t)}removeEventListener(e,t){var i;(i=this.listeners[e])===null||i===void 0||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>i(...t))}}class Ot extends xe{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)})}onMediaEvent(e,t,i){return this.media.addEventListener(e,t,i),()=>this.media.removeEventListener(e,t)}onceMediaEvent(e,t){return this.onMediaEvent(e,t,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}setSrc(e,t){if(this.getSrc()===e)return;this.revokeSrc();const n=t instanceof Blob?URL.createObjectURL(t):e;this.media.src=n,this.media.load()}destroy(){this.media.pause(),!this.isExternalMedia&&(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(e){this.media=e}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}function zt(o,e,t,i,n=5){let r=()=>{};if(!o)return r;const s=l=>{if(l.button===2)return;l.preventDefault(),l.stopPropagation(),o.style.touchAction="none";let u=l.clientX,d=l.clientY,a=!1;const c=p=>{p.preventDefault(),p.stopPropagation();const C=p.clientX,S=p.clientY;if(a||Math.abs(C-u)>=n||Math.abs(S-d)>=n){const{left:N,top:T}=o.getBoundingClientRect();a||(a=!0,t==null||t(u-N,d-T)),e(C-u,S-d,C-N,S-T),u=C,d=S}},k=p=>{a&&(p.preventDefault(),p.stopPropagation())},f=()=>{o.style.touchAction="",a&&(i==null||i()),r()};document.addEventListener("pointermove",c),document.addEventListener("pointerup",f),document.addEventListener("pointerleave",f),document.addEventListener("click",k,!0),r=()=>{document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",f),document.removeEventListener("pointerleave",f),setTimeout(()=>{document.removeEventListener("click",k,!0)},10)}};return o.addEventListener("pointerdown",s),()=>{r(),o.removeEventListener("pointerdown",s)}}class He extends xe{constructor(e,t){super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=e;const i=this.parentFromOptionsContainer(e.container);this.parent=i;const[n,r]=this.initHtml();i.appendChild(n),this.container=n,this.scrollContainer=r.querySelector(".scroll"),this.wrapper=r.querySelector(".wrapper"),this.canvasWrapper=r.querySelector(".canvases"),this.progressWrapper=r.querySelector(".progress"),this.cursor=r.querySelector(".cursor"),t&&r.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){const e=i=>{const n=this.wrapper.getBoundingClientRect(),r=i.clientX-n.left,s=i.clientX-n.left,l=r/n.width,u=s/n.height;return[l,u]};this.wrapper.addEventListener("click",i=>{const[n,r]=e(i);this.emit("click",n,r)}),this.wrapper.addEventListener("dblclick",i=>{const[n,r]=e(i);this.emit("dblclick",n,r)}),this.options.dragToSeek&&this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:i,scrollWidth:n,clientWidth:r}=this.scrollContainer,s=i/n,l=(i+r)/n;this.emit("scroll",s,l)});const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){zt(this.wrapper,(e,t,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"});return t.innerHTML=`
      <style>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek&&!this.options.dragToSeek&&this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var e;this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect()}createDelay(e=10){const t={};return this.timeouts.push(t),i=>{t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(i,e)}}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const t=document.createElement("canvas"),n=t.getContext("2d").createLinearGradient(0,0,0,t.height),r=1/(e.length-1);return e.forEach((s,l)=>{const u=l*r;n.addColorStop(u,s)}),n}renderBarWaveform(e,t,i,n){const r=e[0],s=e[1]||e[0],l=r.length,{width:u,height:d}=i.canvas,a=d/2,c=window.devicePixelRatio||1,k=t.barWidth?t.barWidth*c:1,f=t.barGap?t.barGap*c:t.barWidth?k/2:0,p=t.barRadius||0,C=u/(k+f)/l,S=p&&"roundRect"in i?"roundRect":"rect";i.beginPath();let N=0,T=0,m=0;for(let P=0;P<=l;P++){const M=Math.round(P*C);if(M>N){const B=Math.round(T*a*n),q=Math.round(m*a*n),Y=B+q||1;let O=a-B;t.barAlign==="top"?O=0:t.barAlign==="bottom"&&(O=d-Y),i[S](N*(k+f),O,k,Y,p),N=M,T=0,m=0}const y=Math.abs(r[P]||0),_=Math.abs(s[P]||0);y>T&&(T=y),_>m&&(m=_)}i.fill(),i.closePath()}renderLineWaveform(e,t,i,n){const r=s=>{const l=e[s]||e[0],u=l.length,{height:d}=i.canvas,a=d/2,c=i.canvas.width/u;i.moveTo(0,a);let k=0,f=0;for(let p=0;p<=u;p++){const C=Math.round(p*c);if(C>k){const N=Math.round(f*a*n)||1,T=a+N*(s===0?-1:1);i.lineTo(k,T),k=C,f=0}const S=Math.abs(l[p]||0);S>f&&(f=S)}i.lineTo(k,a)};i.beginPath(),r(0),r(1),i.fill(),i.closePath()}renderWaveform(e,t,i){if(i.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction){t.renderFunction(e,i);return}let n=t.barHeight||1;if(t.normalize){const r=Array.from(e[0]).reduce((s,l)=>Math.max(s,Math.abs(l)),0);n=r?1/r:1}if(t.barWidth||t.barGap||t.barAlign){this.renderBarWaveform(e,t,i,n);return}this.renderLineWaveform(e,t,i,n)}renderSingleCanvas(e,t,i,n,r,s,l,u){const d=window.devicePixelRatio||1,a=document.createElement("canvas"),c=e[0].length;a.width=Math.round(i*(s-r)/c),a.height=n*d,a.style.width=`${Math.floor(a.width/d)}px`,a.style.height=`${n}px`,a.style.left=`${Math.floor(r*i/d/c)}px`,l.appendChild(a);const k=a.getContext("2d");if(this.renderWaveform(e.map(f=>f.slice(r,s)),t,k),a.width>0&&a.height>0){const f=a.cloneNode(),p=f.getContext("2d");p.drawImage(a,0,0),p.globalCompositeOperation="source-in",p.fillStyle=this.convertColorValues(t.progressColor),p.fillRect(0,0,a.width,a.height),u.appendChild(f)}}renderChannel(e,t,i){const n=document.createElement("div"),r=this.getHeight();n.style.height=`${r}px`,this.canvasWrapper.style.minHeight=`${r}px`,this.canvasWrapper.appendChild(n);const s=n.cloneNode();this.progressWrapper.appendChild(s);const{scrollLeft:l,scrollWidth:u,clientWidth:d}=this.scrollContainer,a=e[0].length,c=a/u;let k=Math.min(He.MAX_CANVAS_WIDTH,d);if(t.barWidth||t.barGap){const M=t.barWidth||.5,y=t.barGap||M/2,_=M+y;k%_!==0&&(k=Math.floor(k/_)*_)}const f=Math.floor(Math.abs(l)*c),p=Math.floor(f+k*c),C=p-f,S=(M,y)=>{this.renderSingleCanvas(e,t,i,r,Math.max(0,M),Math.min(y,a),n,s)},N=this.createDelay(),T=this.createDelay(),m=(M,y)=>{S(M,y),M>0&&N(()=>{m(M-C,y-C)})},P=(M,y)=>{S(M,y),y<a&&T(()=>{P(M+C,y+C)})};m(f,p),p<a&&P(p,p+C)}render(e){this.timeouts.forEach(l=>l.timeout&&clearTimeout(l.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const t=window.devicePixelRatio||1,i=this.scrollContainer.clientWidth,n=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrolling=n>i;const r=this.options.fillParent&&!this.isScrolling,s=(r?i:n)*t;if(this.wrapper.style.width=r?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let l=0;l<e.numberOfChannels;l++){const u=Object.assign(Object.assign({},this.options),this.options.splitChannels[l]);this.renderChannel([e.getChannelData(l)],u,s)}else{const l=[e.getChannelData(0)];e.numberOfChannels>1&&l.push(e.getChannelData(1)),this.renderChannel(l,this.options,s)}this.audioData=e,this.emit("render")}reRender(){if(!this.audioData)return;const e=this.progressWrapper.clientWidth;this.render(this.audioData);const t=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=t-e}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{clientWidth:i,scrollLeft:n,scrollWidth:r}=this.scrollContainer,s=r*e,l=i/2,u=t&&this.options.autoCenter&&!this.isDragging?l:i;if(s>n+u||s<n)if(this.options.autoCenter&&!this.isDragging){const d=l/20;s-(n+l)>=d&&s<n+i?this.scrollContainer.scrollLeft+=d:this.scrollContainer.scrollLeft=s-l}else this.isDragging?this.scrollContainer.scrollLeft=s<n?s-10:s-i+10:this.scrollContainer.scrollLeft=s;{const{scrollLeft:d}=this.scrollContainer,a=d/r,c=(d+i)/r;this.emit("scroll",a,c)}}renderProgress(e,t){if(isNaN(e))return;const i=e*100;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.marginLeft=Math.round(i)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(e,t)}}He.MAX_CANVAS_WIDTH=4e3;class Nt extends xe{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}var Ue=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function l(a){try{d(i.next(a))}catch(c){s(c)}}function u(a){try{d(i.throw(a))}catch(c){s(c)}}function d(a){a.done?r(a.value):n(a.value).then(l,u)}d((i=i.apply(o,e||[])).next())})};class Vt extends xe{constructor(e=new AudioContext){super(),this.bufferNode=null,this.autoplay=!1,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return Ue(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){this.currentSrc=e,fetch(e).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>{this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play()})}_play(){var e;this.paused&&(this.paused=!1,(e=this.bufferNode)===null||e===void 0||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.bufferNode.buffer=this.buffer,this.bufferNode.connect(this.gainNode),this.playedDuration>=this.duration&&(this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,this.playedDuration),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))})}_pause(){var e;this.paused||(this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime)}play(){return Ue(this,void 0,void 0,function*(){this._play(),this.emit("play")})}pause(){this._pause(),this.emit("pause")}setSinkId(e){return Ue(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){var e,t;return(t=(e=this.bufferNode)===null||e===void 0?void 0:e.playbackRate.value)!==null&&t!==void 0?t:1}set playbackRate(e){this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return this.paused?this.playedDuration:this.playedDuration+this.audioContext.currentTime-this.playStartTime}set currentTime(e){this.emit("seeking"),this.paused?this.playedDuration=e:(this._pause(),this.playedDuration=e,this._play()),this.emit("timeupdate")}get duration(){var e;return((e=this.buffer)===null||e===void 0?void 0:e.duration)||0}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}getGainNode(){return this.gainNode}}var Le=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function l(a){try{d(i.next(a))}catch(c){s(c)}}function u(a){try{d(i.throw(a))}catch(c){s(c)}}function d(a){a.done?r(a.value):n(a.value).then(l,u)}d((i=i.apply(o,e||[])).next())})};const jt={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class Fe extends Ot{static create(e){return new Fe(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new Vt:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.options=Object.assign({},jt,e),this.timer=new Nt;const i=t?void 0:this.getMediaElement();this.renderer=new He(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const n=this.options.url||this.getSrc();n?this.load(n,this.options.peaks,this.options.duration):this.options.peaks&&this.options.duration&&this.loadPredecoded()}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),!0),this.emit("timeupdate",e),this.emit("audioprocess",e)}))}initPlayerEvents(){this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t)=>{const i=this.getDuration();this.emit("scroll",e*i,t*i)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let e;this.subscriptions.push(this.renderer.on("drag",t=>{this.options.interact&&(this.renderer.renderProgress(t),clearTimeout(e),e=setTimeout(()=>{this.seekTo(t)},this.isPlaying()?0:200),this.emit("interaction",t*this.getDuration()),this.emit("drag",t))}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e.init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadPredecoded(){return Le(this,void 0,void 0,function*(){this.options.peaks&&this.options.duration&&(this.decodedData=Ie.createBuffer(this.options.peaks,this.options.duration),yield Promise.resolve(),this.renderDecoded())})}renderDecoded(){return Le(this,void 0,void 0,function*(){this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData))})}loadAudio(e,t,i,n){return Le(this,void 0,void 0,function*(){if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!t&&!i){const r=s=>this.emit("loading",s);t=yield Wt.fetchBlob(e,r,this.options.fetchParams)}if(this.setSrc(e,t),n=(yield Promise.resolve(n||this.getDuration()))||(yield new Promise(r=>{this.onceMediaEvent("loadedmetadata",()=>r(this.getDuration()))}))||(yield Promise.resolve(0)),i)this.decodedData=Ie.createBuffer(i,n);else if(t){const r=yield t.arrayBuffer();this.decodedData=yield Ie.decode(r,this.options.sampleRate)}this.renderDecoded(),this.emit("ready",this.getDuration())})}load(e,t,i){return Le(this,void 0,void 0,function*(){yield this.loadAudio(e,void 0,t,i)})}loadBlob(e,t,i){return Le(this,void 0,void 0,function*(){yield this.loadAudio("blob",e,t,i)})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const n=Math.min(e,this.decodedData.numberOfChannels),r=[];for(let s=0;s<n;s++){const l=this.decodedData.getChannelData(s),u=[],d=Math.round(l.length/t);for(let a=0;a<t;a++){const c=l.slice(a*d,(a+1)*d),k=Math.max(...c);u.push(Math.round(k*i)/i)}r.push(u)}return r}getDuration(){let e=super.getDuration()||0;return(e===0||e===1/0)&&this.decodedData&&(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}playPause(){return Le(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}destroy(){this.emit("destroy"),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}function Bt(o){const e=o.numberOfChannels,t=o.length*e*2+44,i=new ArrayBuffer(t),n=new DataView(i);let r=0;const s=function(l,u,d){for(let a=0;a<d.length;a++)l.setUint8(u+a,d.charCodeAt(a))};s(n,r,"RIFF"),r+=4,n.setUint32(r,t-8,!0),r+=4,s(n,r,"WAVE"),r+=4,s(n,r,"fmt "),r+=4,n.setUint32(r,16,!0),r+=4,n.setUint16(r,1,!0),r+=2,n.setUint16(r,e,!0),r+=2,n.setUint32(r,o.sampleRate,!0),r+=4,n.setUint32(r,o.sampleRate*2*e,!0),r+=4,n.setUint16(r,e*2,!0),r+=2,n.setUint16(r,16,!0),r+=2,s(n,r,"data"),r+=4,n.setUint32(r,o.length*e*2,!0),r+=4;for(let l=0;l<o.length;l++)for(let u=0;u<e;u++){const d=Math.max(-1,Math.min(1,o.getChannelData(u)[l]));n.setInt16(r,d*32767,!0),r+=2}return new Uint8Array(i)}const xt=async(o,e,t,i)=>{const n=new AudioContext({sampleRate:i||o.sampleRate}),r=o.numberOfChannels,s=i||o.sampleRate;let l=o.length,u=0;e&&t&&(u=Math.round(e*s),l=Math.round(t*s)-u);const d=n.createBuffer(r,l,s);for(let a=0;a<r;a++){const c=o.getChannelData(a),k=d.getChannelData(a);for(let f=0;f<l;f++)k[f]=c[u+f]}return Bt(d)},Ye=(o,e)=>{o&&o.skip(e)},Te=(o,e)=>(e||(e=5),o/100*e||5);class st{constructor(){this.listeners={},this.on=this.addEventListener,this.un=this.removeEventListener}addEventListener(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),i==null?void 0:i.once){const n=()=>{this.removeEventListener(e,n),this.removeEventListener(e,t)};return this.addEventListener(e,n),n}return()=>this.removeEventListener(e,t)}removeEventListener(e,t){var i;(i=this.listeners[e])===null||i===void 0||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>i(...t))}}class Ht extends st{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}function ze(o,e,t,i,n=5){let r=()=>{};if(!o)return r;const s=l=>{if(l.button===2)return;l.preventDefault(),l.stopPropagation(),o.style.touchAction="none";let u=l.clientX,d=l.clientY,a=!1;const c=p=>{p.preventDefault(),p.stopPropagation();const C=p.clientX,S=p.clientY;if(a||Math.abs(C-u)>=n||Math.abs(S-d)>=n){const{left:N,top:T}=o.getBoundingClientRect();a||(a=!0,t==null||t(u-N,d-T)),e(C-u,S-d,C-N,S-T),u=C,d=S}},k=p=>{a&&(p.preventDefault(),p.stopPropagation())},f=()=>{o.style.touchAction="",a&&(i==null||i()),r()};document.addEventListener("pointermove",c),document.addEventListener("pointerup",f),document.addEventListener("pointerleave",f),document.addEventListener("click",k,!0),r=()=>{document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",f),document.removeEventListener("pointerleave",f),setTimeout(()=>{document.removeEventListener("click",k,!0)},10)}};return o.addEventListener("pointerdown",s),()=>{r(),o.removeEventListener("pointerdown",s)}}class Ke extends st{constructor(e,t,i=0){var n,r,s,l,u,d,a;super(),this.totalDuration=t,this.numberOfChannels=i,this.minLength=0,this.maxLength=1/0,this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((n=e.end)!==null&&n!==void 0?n:e.start),this.drag=(r=e.drag)===null||r===void 0||r,this.resize=(s=e.resize)===null||s===void 0||s,this.color=(l=e.color)!==null&&l!==void 0?l:"rgba(0, 0, 0, 0.1)",this.minLength=(u=e.minLength)!==null&&u!==void 0?u:this.minLength,this.maxLength=(d=e.maxLength)!==null&&d!==void 0?d:this.maxLength,this.channelIdx=(a=e.channelIdx)!==null&&a!==void 0?a:-1,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){const e=this.start===this.end;this.element.setAttribute("part",`${e?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t=document.createElement("div");t.setAttribute("data-resize","left"),t.setAttribute("style",`
        position: absolute;
        z-index: 2;
        width: 6px;
        height: 100%;
        top: 0;
        left: 0;
        border-left: 2px solid rgba(0, 0, 0, 0.5);
        border-radius: 2px 0 0 2px;
        cursor: ew-resize;
        word-break: keep-all;
      `),t.setAttribute("part","region-handle region-handle-left");const i=t.cloneNode();i.setAttribute("data-resize","right"),i.style.left="",i.style.right="0",i.style.borderRight=i.style.borderLeft,i.style.borderLeft="",i.style.borderRadius="0 2px 2px 0",i.setAttribute("part","region-handle region-handle-right"),e.appendChild(t),e.appendChild(i),ze(t,n=>this.onResize(n,"start"),()=>null,()=>this.onEndResizing(),1),ze(i,n=>this.onResize(n,"end"),()=>null,()=>this.onEndResizing(),1)}removeResizeHandles(e){const t=e.querySelector('[data-resize="left"]'),i=e.querySelector('[data-resize="right"]');t&&e.removeChild(t),i&&e.removeChild(i)}initElement(){const e=document.createElement("div"),t=this.start===this.end;let i=0,n=100;return this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(n=100/this.numberOfChannels,i=n*this.channelIdx),e.setAttribute("style",`
      position: absolute;
      top: ${i}%;
      height: ${n}%;
      background-color: ${t?"none":this.color};
      border-left: ${t?"2px solid "+this.color:"none"};
      border-radius: 2px;
      box-sizing: border-box;
      transition: background-color 0.2s ease;
      cursor: ${this.drag?"grab":"default"};
      pointer-events: all;
    `),!t&&this.resize&&this.addResizeHandles(e),e}renderPosition(){const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",t=>this.emit("click",t)),e.addEventListener("mouseenter",t=>this.emit("over",t)),e.addEventListener("mouseleave",t=>this.emit("leave",t)),e.addEventListener("dblclick",t=>this.emit("dblclick",t)),ze(e,t=>this.onMove(t),()=>this.onStartMoving(),()=>this.onEndMoving()))}onStartMoving(){this.drag&&(this.element.style.cursor="grabbing")}onEndMoving(){this.drag&&(this.element.style.cursor="grab",this.emit("update-end"))}_onUpdate(e,t){if(!this.element.parentElement)return;const i=e/this.element.parentElement.clientWidth*this.totalDuration,n=t&&t!=="start"?this.start:this.start+i,r=t&&t!=="end"?this.end:this.end+i,s=r-n;n>=0&&r<=this.totalDuration&&n<=r&&s>=this.minLength&&s<=this.maxLength&&(this.start=n,this.end=r,this.renderPosition(),this.emit("update"))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(){this.emit("play")}setContent(e){var t;if((t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){this.content=document.createElement("div");const i=this.start===this.end;this.content.style.padding=`0.2em ${i?.2:.4}em`,this.content.textContent=e}else this.content=e;this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(e){var t,i;if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const n=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((i=e.end)!==null&&i!==void 0?i:n?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const n=this.start===this.end;this.resize=e.resize,this.resize&&!n?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class qe extends Ht{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new qe(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const i=this.regions.filter(n=>n.start<=t&&n.end>=t);i.forEach(n=>{e.includes(n)||this.emit("region-in",n)}),e.forEach(n=>{i.includes(n)||this.emit("region-out",n)}),e=i}))}initRegionsContainer(){const e=document.createElement("div");return e.setAttribute("style",`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    `),e}getRegions(){return this.regions}avoidOverlapping(e){if(!e.content)return;const t=e.content,i=t.getBoundingClientRect().left,n=e.element.scrollWidth,r=this.regions.filter(s=>{if(s===e||!s.content)return!1;const l=s.content.getBoundingClientRect().left,u=s.element.scrollWidth;return i<l+u&&l<i+n}).map(s=>{var l;return((l=s.content)===null||l===void 0?void 0:l.getBoundingClientRect().height)||0}).reduce((s,l)=>s+l,0);t.style.marginTop=`${r}px`}saveRegion(e){this.regionsContainer.appendChild(e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",()=>{var i,n;(i=this.wavesurfer)===null||i===void 0||i.play(),(n=this.wavesurfer)===null||n===void 0||n.setTime(e.start)}),e.on("click",i=>{this.emit("region-clicked",e,i)}),e.on("dblclick",i=>{this.emit("region-double-clicked",e,i)}),e.once("remove",()=>{t.forEach(i=>i()),this.regions=this.regions.filter(i=>i!==e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,i;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const n=this.wavesurfer.getDuration(),r=(i=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||i===void 0?void 0:i.numberOfChannels,s=new Ke(e,n,r);return n?this.saveRegion(s):this.subscriptions.push(this.wavesurfer.once("ready",l=>{s._setTotalDuration(l),this.saveRegion(s)})),s}enableDragSelection(e){var t,i;const n=(i=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||i===void 0?void 0:i.querySelector("div");if(!n)return()=>{};let r=null,s=0;return ze(n,(l,u,d)=>{r&&r._onUpdate(l,d>s?"end":"start")},l=>{var u,d;if(s=l,!this.wavesurfer)return;const a=this.wavesurfer.getDuration(),c=(d=(u=this.wavesurfer)===null||u===void 0?void 0:u.getDecodedData())===null||d===void 0?void 0:d.numberOfChannels,k=this.wavesurfer.getWrapper().clientWidth,f=l/k*a,p=(l+5)/k*a;r=new Ke(Object.assign(Object.assign({},e),{start:f,end:p}),a,c),this.regionsContainer.appendChild(r.element)},()=>{r&&(this.saveRegion(r),r=null)})}clearRegions(){this.regions.forEach(e=>e.remove())}destroy(){this.clearRegions(),super.destroy()}}function It(o){let e,t;return e=new Lt({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function Ut(o){let e,t;return e=new Ct({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function Ft(o){let e,t;return e=new Dt({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function qt(o){let e,t,i,n;const r=[Ft,Ut,It],s=[];function l(u,d){return u[0]==0?0:u[0]<.5?1:u[0]>=.5?2:-1}return~(e=l(o))&&(t=s[e]=r[e](o)),{c(){t&&t.c(),i=Se()},l(u){t&&t.l(u),i=Se()},m(u,d){~e&&s[e].m(u,d),Z(u,i,d),n=!0},p(u,[d]){let a=e;e=l(u),e!==a&&(t&&(_e(),z(s[a],1,1,()=>{s[a]=null}),be()),~e?(t=s[e],t||(t=s[e]=r[e](u),t.c()),A(t,1),t.m(i.parentNode,i)):t=null)},i(u){n||(A(t),n=!0)},o(u){z(t),n=!1},d(u){u&&v(i),~e&&s[e].d(u)}}}function Xt(o,e,t){let{currentVolume:i}=e;return o.$$set=n=>{"currentVolume"in n&&t(0,i=n.currentVolume)},[i]}class Gt extends pe{constructor(e){super(),ge(this,e,Xt,qt,ve,{currentVolume:0})}}function Zt(o){let e,t,i;return{c(){e=x("input"),this.h()},l(n){e=H(n,"INPUT",{id:!0,class:!0,type:!0,min:!0,max:!0,step:!0}),this.h()},h(){h(e,"id","volume"),h(e,"class","volume-slider svelte-wuo8j5"),h(e,"type","range"),h(e,"min","0"),h(e,"max","1"),h(e,"step","0.01"),e.value=o[0]},m(n,r){Z(n,e,r),o[4](e),t||(i=[$(e,"focusout",o[5]),$(e,"input",o[6])],t=!0)},p(n,[r]){r&1&&(e.value=n[0])},i:F,o:F,d(n){n&&v(e),o[4](null),t=!1,Be(i)}}}function Yt(o,e,t){let{currentVolume:i=1}=e,{show_volume_slider:n=!1}=e,{waveform:r}=e,s;nt(()=>{l()});const l=()=>{let c=s;c&&(c.style.background=`linear-gradient(to right, var(--color-accent) ${i*100}%, var(--neutral-400) ${i*100}%)`)};function u(c){he[c?"unshift":"push"](()=>{s=c,t(3,s)})}const d=()=>t(1,n=!1),a=c=>{c.target instanceof HTMLInputElement&&(t(0,i=parseFloat(c.target.value)),r==null||r.setVolume(i))};return o.$$set=c=>{"currentVolume"in c&&t(0,i=c.currentVolume),"show_volume_slider"in c&&t(1,n=c.show_volume_slider),"waveform"in c&&t(2,r=c.waveform)},o.$$.update=()=>{o.$$.dirty&1&&l()},[i,n,r,s,u,d,a]}class Kt extends pe{constructor(e){super(),ge(this,e,Yt,Zt,ve,{currentVolume:0,show_volume_slider:1,waveform:2})}}function Je(o){let e,t,i,n;function r(u){o[30](u)}function s(u){o[31](u)}let l={waveform:o[3]};return o[14]!==void 0&&(l.currentVolume=o[14]),o[1]!==void 0&&(l.show_volume_slider=o[1]),e=new Kt({props:l}),he.push(()=>Me(e,"currentVolume",r)),he.push(()=>Me(e,"show_volume_slider",s)),{c(){ee(e.$$.fragment)},l(u){te(e.$$.fragment,u)},m(u,d){ie(e,u,d),n=!0},p(u,d){const a={};d[0]&8&&(a.waveform=u[3]),!t&&d[0]&16384&&(t=!0,a.currentVolume=u[14],De(()=>t=!1)),!i&&d[0]&2&&(i=!0,a.show_volume_slider=u[1],De(()=>i=!1)),e.$set(a)},i(u){n||(A(e.$$.fragment,u),n=!0)},o(u){z(e.$$.fragment,u),n=!1},d(u){ne(e,u)}}}function Jt(o){let e,t;return e=new ft({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function Qt(o){let e,t;return e=new dt({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function Qe(o){let e,t,i,n,r;return t=new bt({}),{c(){e=x("button"),ee(t.$$.fragment),this.h()},l(s){e=H(s,"BUTTON",{class:!0,"data-testid":!0,style:!0});var l=D(e);te(t.$$.fragment,l),l.forEach(v),this.h()},h(){h(e,"class","action icon cc-button svelte-1joklbr"),h(e,"data-testid","subtitles-toggle"),Re(e,"color",o[2]?"var(--color-accent)":"var(--neutral-400)")},m(s,l){Z(s,e,l),ie(t,e,null),i=!0,n||(r=$(e,"click",o[19]),n=!0)},p(s,l){(!i||l[0]&4)&&Re(e,"color",s[2]?"var(--color-accent)":"var(--neutral-400)")},i(s){i||(A(t.$$.fragment,s),i=!0)},o(s){z(t.$$.fragment,s),i=!1},d(s){s&&v(e),ne(t),n=!1,r()}}}function $e(o){let e,t,i,n,r,s=o[7]&&o[0]===""&&et(o);const l=[ei,$t],u=[];function d(a,c){return a[0]===""?0:1}return t=d(o),i=u[t]=l[t](o),{c(){s&&s.c(),e=J(),i.c(),n=Se()},l(a){s&&s.l(a),e=Q(a),i.l(a),n=Se()},m(a,c){s&&s.m(a,c),Z(a,e,c),u[t].m(a,c),Z(a,n,c),r=!0},p(a,c){a[7]&&a[0]===""?s?(s.p(a,c),c[0]&129&&A(s,1)):(s=et(a),s.c(),A(s,1),s.m(e.parentNode,e)):s&&(_e(),z(s,1,1,()=>{s=null}),be());let k=t;t=d(a),t===k?u[t].p(a,c):(_e(),z(u[k],1,1,()=>{u[k]=null}),be(),i=u[t],i?i.p(a,c):(i=u[t]=l[t](a),i.c()),A(i,1),i.m(n.parentNode,n))},i(a){r||(A(s),A(i),r=!0)},o(a){z(s),z(i),r=!1},d(a){a&&(v(e),v(n)),s&&s.d(a),u[t].d(a)}}}function et(o){let e,t,i,n,r;return t=new mt({}),{c(){e=x("button"),ee(t.$$.fragment),this.h()},l(s){e=H(s,"BUTTON",{class:!0,"aria-label":!0});var l=D(e);te(t.$$.fragment,l),l.forEach(v),this.h()},h(){h(e,"class","action icon svelte-1joklbr"),h(e,"aria-label","Reset audio")},m(s,l){Z(s,e,l),ie(t,e,null),i=!0,n||(r=$(e,"click",o[36]),n=!0)},p:F,i(s){i||(A(t.$$.fragment,s),i=!0)},o(s){z(t.$$.fragment,s),i=!1},d(s){s&&v(e),ne(t),n=!1,r()}}}function $t(o){let e,t="Trim",i,n,r="Cancel",s,l;return{c(){e=x("button"),e.textContent=t,i=J(),n=x("button"),n.textContent=r,this.h()},l(u){e=H(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Ve(e)!=="svelte-1brf00d"&&(e.textContent=t),i=Q(u),n=H(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Ve(n)!=="svelte-1r0ma01"&&(n.textContent=r),this.h()},h(){h(e,"class","text-button svelte-1joklbr"),h(n,"class","text-button svelte-1joklbr")},m(u,d){Z(u,e,d),Z(u,i,d),Z(u,n,d),s||(l=[$(e,"click",o[16]),$(n,"click",o[18])],s=!0)},p:F,i:F,o:F,d(u){u&&(v(e),v(i),v(n)),s=!1,Be(l)}}}function ei(o){let e,t,i,n,r;return t=new ct({}),{c(){e=x("button"),ee(t.$$.fragment),this.h()},l(s){e=H(s,"BUTTON",{class:!0,"aria-label":!0});var l=D(e);te(t.$$.fragment,l),l.forEach(v),this.h()},h(){h(e,"class","action icon svelte-1joklbr"),h(e,"aria-label","Trim audio to selection")},m(s,l){Z(s,e,l),ie(t,e,null),i=!0,n||(r=$(e,"click",o[18]),n=!0)},p:F,i(s){i||(A(t.$$.fragment,s),i=!0)},o(s){z(t.$$.fragment,s),i=!1},d(s){s&&v(e),ne(t),n=!1,r()}}}function ti(o){let e,t,i,n,r,s,l,u,d,a,c,k,f,p,C,S,N,T,m,P,M,y,_,B,q,Y,O,K,w,R,W;n=new Gt({props:{currentVolume:o[14]}});let V=o[1]&&Je(o);C=new vt({});const le=[Qt,Jt],de=[];function ke(L,j){return L[6]?0:1}m=ke(o),P=de[m]=le[m](o),B=new yt({});let I=o[12]&&Qe(o),U=o[11]&&o[8]&&$e(o);return{c(){e=x("div"),t=x("div"),i=x("button"),ee(n.$$.fragment),r=J(),V&&V.c(),s=J(),l=x("button"),u=x("span"),d=we(o[13]),a=we("x"),k=J(),f=x("div"),p=x("button"),ee(C.$$.fragment),N=J(),T=x("button"),P.c(),y=J(),_=x("button"),ee(B.$$.fragment),Y=J(),O=x("div"),I&&I.c(),K=J(),U&&U.c(),this.h()},l(L){e=H(L,"DIV",{class:!0,"data-testid":!0});var j=D(e);t=H(j,"DIV",{class:!0});var se=D(t);i=H(se,"BUTTON",{class:!0,"aria-label":!0});var ce=D(i);te(n.$$.fragment,ce),ce.forEach(v),r=Q(se),V&&V.l(se),s=Q(se),l=H(se,"BUTTON",{class:!0,"aria-label":!0});var b=D(l);u=H(b,"SPAN",{});var ae=D(u);d=ye(ae,o[13]),a=ye(ae,"x"),ae.forEach(v),b.forEach(v),se.forEach(v),k=Q(j),f=H(j,"DIV",{class:!0});var re=D(f);p=H(re,"BUTTON",{class:!0,"aria-label":!0});var fe=D(p);te(C.$$.fragment,fe),fe.forEach(v),N=Q(re),T=H(re,"BUTTON",{class:!0,"aria-label":!0});var Pe=D(T);P.l(Pe),Pe.forEach(v),y=Q(re),_=H(re,"BUTTON",{class:!0,"aria-label":!0});var Ae=D(_);te(B.$$.fragment,Ae),Ae.forEach(v),re.forEach(v),Y=Q(j),O=H(j,"DIV",{class:!0});var Ce=D(O);I&&I.l(Ce),K=Q(Ce),U&&U.l(Ce),Ce.forEach(v),j.forEach(v),this.h()},h(){h(i,"class","action icon volume svelte-1joklbr"),h(i,"aria-label","Adjust volume"),Re(i,"color",o[1]?"var(--color-accent)":"var(--neutral-400)"),h(l,"class","playback icon svelte-1joklbr"),h(l,"aria-label",c=`Adjust playback speed to ${o[15][(o[15].indexOf(o[13])+1)%o[15].length]}x`),Ne(l,"hidden",o[1]),h(t,"class","control-wrapper svelte-1joklbr"),h(p,"class","rewind icon svelte-1joklbr"),h(p,"aria-label",S=`Skip backwards by ${Te(o[4],o[10].skip_length)} seconds`),h(T,"class","play-pause-button icon svelte-1joklbr"),h(T,"aria-label",M=o[6]?o[5]("audio.pause"):o[5]("audio.play")),h(_,"class","skip icon svelte-1joklbr"),h(_,"aria-label",q="Skip forward by "+Te(o[4],o[10].skip_length)+" seconds"),h(f,"class","play-pause-wrapper svelte-1joklbr"),h(O,"class","settings-wrapper svelte-1joklbr"),h(e,"class","controls svelte-1joklbr"),h(e,"data-testid","waveform-controls")},m(L,j){Z(L,e,j),E(e,t),E(t,i),ie(n,i,null),E(t,r),V&&V.m(t,null),E(t,s),E(t,l),E(l,u),E(u,d),E(u,a),E(e,k),E(e,f),E(f,p),ie(C,p,null),E(f,N),E(f,T),de[m].m(T,null),E(f,y),E(f,_),ie(B,_,null),E(e,Y),E(e,O),I&&I.m(O,null),E(O,K),U&&U.m(O,null),w=!0,R||(W=[$(i,"click",o[29]),$(l,"click",o[32]),$(p,"click",o[33]),$(T,"click",o[34]),$(_,"click",o[35])],R=!0)},p(L,j){const se={};j[0]&16384&&(se.currentVolume=L[14]),n.$set(se),j[0]&2&&Re(i,"color",L[1]?"var(--color-accent)":"var(--neutral-400)"),L[1]?V?(V.p(L,j),j[0]&2&&A(V,1)):(V=Je(L),V.c(),A(V,1),V.m(t,s)):V&&(_e(),z(V,1,1,()=>{V=null}),be()),(!w||j[0]&8192)&&rt(d,L[13]),(!w||j[0]&8192&&c!==(c=`Adjust playback speed to ${L[15][(L[15].indexOf(L[13])+1)%L[15].length]}x`))&&h(l,"aria-label",c),(!w||j[0]&2)&&Ne(l,"hidden",L[1]),(!w||j[0]&1040&&S!==(S=`Skip backwards by ${Te(L[4],L[10].skip_length)} seconds`))&&h(p,"aria-label",S);let ce=m;m=ke(L),m!==ce&&(_e(),z(de[ce],1,1,()=>{de[ce]=null}),be(),P=de[m],P||(P=de[m]=le[m](L),P.c()),A(P,1),P.m(T,null)),(!w||j[0]&96&&M!==(M=L[6]?L[5]("audio.pause"):L[5]("audio.play")))&&h(T,"aria-label",M),(!w||j[0]&1040&&q!==(q="Skip forward by "+Te(L[4],L[10].skip_length)+" seconds"))&&h(_,"aria-label",q),L[12]?I?(I.p(L,j),j[0]&4096&&A(I,1)):(I=Qe(L),I.c(),A(I,1),I.m(O,K)):I&&(_e(),z(I,1,1,()=>{I=null}),be()),L[11]&&L[8]?U?(U.p(L,j),j[0]&2304&&A(U,1)):(U=$e(L),U.c(),A(U,1),U.m(O,null)):U&&(_e(),z(U,1,1,()=>{U=null}),be())},i(L){w||(A(n.$$.fragment,L),A(V),A(C.$$.fragment,L),A(P),A(B.$$.fragment,L),A(I),A(U),w=!0)},o(L){z(n.$$.fragment,L),z(V),z(C.$$.fragment,L),z(P),z(B.$$.fragment,L),z(I),z(U),w=!1},d(L){L&&v(e),ne(n),V&&V.d(),ne(C),de[m].d(),ne(B),I&&I.d(),U&&U.d(),R=!1,Be(W)}}}function ii(o,e,t){let{waveform:i}=e,{audio_duration:n}=e,{i18n:r}=e,{playing:s}=e,{show_redo:l=!1}=e,{interactive:u=!1}=e,{handle_trim_audio:d}=e,{mode:a=""}=e,{container:c}=e,{handle_reset_value:k}=e,{waveform_options:f={}}=e,{trim_region_settings:p={}}=e,{show_volume_slider:C=!1}=e,{editable:S=!0}=e,{subtitles_toggle:N=!0}=e,{show_subtitles:T=!1}=e,{trimDuration:m=0}=e,P=[.5,1,1.5,2],M=P[1],y=null,_=null,B,q,Y="",O=1;const K=()=>{y&&(t(25,_=y==null?void 0:y.addRegion({start:n/4,end:n/2,...p})),t(20,m=_.end-_.start))},w=()=>{if(i&&y&&_){const b=_.start,ae=_.end;d(b,ae),t(0,a=""),t(25,_=null)}},R=()=>{y==null||y.getRegions().forEach(b=>{b.remove()}),y==null||y.clearRegions()},W=()=>{R(),a==="edit"?t(0,a=""):(t(0,a="edit"),K())},V=()=>{t(2,N=!N)},le=(b,ae)=>{let re,fe;_&&(b==="left"?ae==="ArrowLeft"?(re=_.start-.05,fe=_.end):(re=_.start+.05,fe=_.end):ae==="ArrowLeft"?(re=_.start,fe=_.end-.05):(re=_.start,fe=_.end+.05),_.setOptions({start:re,end:fe}),t(20,m=_.end-_.start))},de=()=>t(1,C=!C);function ke(b){O=b,t(14,O)}function I(b){C=b,t(1,C)}const U=()=>{t(13,M=P[(P.indexOf(M)+1)%P.length]),i==null||i.setPlaybackRate(M)},L=()=>i==null?void 0:i.skip(Te(n,f.skip_length)*-1),j=()=>i==null?void 0:i.playPause(),se=()=>i==null?void 0:i.skip(Te(n,f.skip_length)),ce=()=>{k(),R(),t(0,a="")};return o.$$set=b=>{"waveform"in b&&t(3,i=b.waveform),"audio_duration"in b&&t(4,n=b.audio_duration),"i18n"in b&&t(5,r=b.i18n),"playing"in b&&t(6,s=b.playing),"show_redo"in b&&t(7,l=b.show_redo),"interactive"in b&&t(8,u=b.interactive),"handle_trim_audio"in b&&t(21,d=b.handle_trim_audio),"mode"in b&&t(0,a=b.mode),"container"in b&&t(22,c=b.container),"handle_reset_value"in b&&t(9,k=b.handle_reset_value),"waveform_options"in b&&t(10,f=b.waveform_options),"trim_region_settings"in b&&t(23,p=b.trim_region_settings),"show_volume_slider"in b&&t(1,C=b.show_volume_slider),"editable"in b&&t(11,S=b.editable),"subtitles_toggle"in b&&t(2,N=b.subtitles_toggle),"show_subtitles"in b&&t(12,T=b.show_subtitles),"trimDuration"in b&&t(20,m=b.trimDuration)},o.$$.update=()=>{if(o.$$.dirty[0]&4194312&&t(24,y=c&&i?i.registerPlugin(qe.create()):null),o.$$.dirty[0]&16777216&&(y==null||y.on("region-out",b=>{b.play()})),o.$$.dirty[0]&16777216&&(y==null||y.on("region-updated",b=>{t(20,m=b.end-b.start)})),o.$$.dirty[0]&16777216&&(y==null||y.on("region-clicked",(b,ae)=>{ae.stopPropagation(),t(25,_=b),b.play()})),o.$$.dirty[0]&255852544&&_){const b=c.children[0].shadowRoot;t(27,q=b.querySelector('[data-resize="right"]')),t(26,B=b.querySelector('[data-resize="left"]')),B&&q&&(B.setAttribute("role","button"),q.setAttribute("role","button"),B==null||B.setAttribute("aria-label","Drag to adjust start time"),q==null||q.setAttribute("aria-label","Drag to adjust end time"),B==null||B.setAttribute("tabindex","0"),q==null||q.setAttribute("tabindex","0"),B.addEventListener("focus",()=>{y&&t(28,Y="left")}),q.addEventListener("focus",()=>{y&&t(28,Y="right")}))}o.$$.dirty[0]&285212672&&y&&window.addEventListener("keydown",b=>{b.key==="ArrowLeft"?le(Y,"ArrowLeft"):b.key==="ArrowRight"&&le(Y,"ArrowRight")})},[a,C,N,i,n,r,s,l,u,k,f,S,T,M,O,P,w,R,W,V,m,d,c,p,y,_,B,q,Y,de,ke,I,U,L,j,se,ce]}class ni extends pe{constructor(e){super(),ge(this,e,ii,ti,ve,{waveform:3,audio_duration:4,i18n:5,playing:6,show_redo:7,interactive:8,handle_trim_audio:21,mode:0,container:22,handle_reset_value:9,waveform_options:10,trim_region_settings:23,show_volume_slider:1,editable:11,subtitles_toggle:2,show_subtitles:12,trimDuration:20},null,[-1,-1])}}function ri(o){let e,t,i,n,r,s,l="0:00",u,d,a,c,k="0:00",f,p,C,S,N,T,m,P,M,y,_=o[0]==="edit"&&o[21]>0&&tt(o);function B(w){o[36](w)}function q(w){o[37](w)}function Y(w){o[38](w)}function O(w){o[39](w)}let K={container:o[11],waveform:o[12],playing:o[16],audio_duration:o[20],i18n:o[4],interactive:o[5],handle_trim_audio:o[24],show_redo:o[5],handle_reset_value:o[10],waveform_options:o[9],trim_region_settings:o[7],editable:o[6],show_subtitles:o[2]!==null};return o[0]!==void 0&&(K.mode=o[0]),o[21]!==void 0&&(K.trimDuration=o[21]),o[22]!==void 0&&(K.show_volume_slider=o[22]),o[14]!==void 0&&(K.subtitles_toggle=o[14]),S=new ni({props:K}),he.push(()=>Me(S,"mode",B)),he.push(()=>Me(S,"trimDuration",q)),he.push(()=>Me(S,"show_volume_slider",Y)),he.push(()=>Me(S,"subtitles_toggle",O)),{c(){e=x("div"),t=x("div"),i=x("div"),n=J(),r=x("div"),s=x("time"),s.textContent=l,u=J(),d=x("div"),_&&_.c(),a=J(),c=x("time"),c.textContent=k,f=J(),p=x("div"),C=J(),ee(S.$$.fragment),this.h()},l(w){e=H(w,"DIV",{class:!0,"data-testid":!0});var R=D(e);t=H(R,"DIV",{class:!0});var W=D(t);i=H(W,"DIV",{id:!0,class:!0}),D(i).forEach(v),W.forEach(v),n=Q(R),r=H(R,"DIV",{class:!0});var V=D(r);s=H(V,"TIME",{id:!0,class:!0,"data-svelte-h":!0}),Ve(s)!=="svelte-lp3mlp"&&(s.textContent=l),u=Q(V),d=H(V,"DIV",{});var le=D(d);_&&_.l(le),a=Q(le),c=H(le,"TIME",{id:!0,class:!0,"data-svelte-h":!0}),Ve(c)!=="svelte-1jd0owv"&&(c.textContent=k),le.forEach(v),V.forEach(v),f=Q(R),p=H(R,"DIV",{class:!0,"data-testid":!0}),D(p).forEach(v),C=Q(R),te(S.$$.fragment,R),R.forEach(v),this.h()},h(){h(i,"id","waveform"),h(i,"class","svelte-1vm10g7"),Re(i,"height",o[11]?null:"58px"),h(t,"class","waveform-container svelte-1vm10g7"),h(s,"id","time"),h(s,"class","svelte-1vm10g7"),h(c,"id","duration"),h(c,"class","svelte-1vm10g7"),h(r,"class","timestamps svelte-1vm10g7"),h(p,"class","subtitle-display svelte-1vm10g7"),h(p,"data-testid","subtitle-display"),h(e,"class","component-wrapper svelte-1vm10g7"),h(e,"data-testid",M=o[3]?"waveform-"+o[3]:"unlabelled-audio")},m(w,R){Z(w,e,R),E(e,t),E(t,i),o[32](i),E(e,n),E(e,r),E(r,s),o[33](s),E(r,u),E(r,d),_&&_.m(d,null),E(d,a),E(d,c),o[34](c),E(e,f),E(e,p),o[35](p),E(e,C),ie(S,e,null),y=!0},p(w,R){R[0]&2048&&Re(i,"height",w[11]?null:"58px"),w[0]==="edit"&&w[21]>0?_?_.p(w,R):(_=tt(w),_.c(),_.m(d,a)):_&&(_.d(1),_=null);const W={};R[0]&2048&&(W.container=w[11]),R[0]&4096&&(W.waveform=w[12]),R[0]&65536&&(W.playing=w[16]),R[0]&1048576&&(W.audio_duration=w[20]),R[0]&16&&(W.i18n=w[4]),R[0]&32&&(W.interactive=w[5]),R[0]&32&&(W.show_redo=w[5]),R[0]&1024&&(W.handle_reset_value=w[10]),R[0]&512&&(W.waveform_options=w[9]),R[0]&128&&(W.trim_region_settings=w[7]),R[0]&64&&(W.editable=w[6]),R[0]&4&&(W.show_subtitles=w[2]!==null),!N&&R[0]&1&&(N=!0,W.mode=w[0],De(()=>N=!1)),!T&&R[0]&2097152&&(T=!0,W.trimDuration=w[21],De(()=>T=!1)),!m&&R[0]&4194304&&(m=!0,W.show_volume_slider=w[22],De(()=>m=!1)),!P&&R[0]&16384&&(P=!0,W.subtitles_toggle=w[14],De(()=>P=!1)),S.$set(W),(!y||R[0]&8&&M!==(M=w[3]?"waveform-"+w[3]:"unlabelled-audio"))&&h(e,"data-testid",M)},i(w){y||(A(S.$$.fragment,w),y=!0)},o(w){z(S.$$.fragment,w),y=!1},d(w){w&&v(e),o[32](null),o[33](null),_&&_.d(),o[34](null),o[35](null),ne(S)}}}function si(o){let e,t;return e=new pt({props:{size:"small",$$slots:{default:[oi]},$$scope:{ctx:o}}}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},p(i,n){const r={};n[1]&131072&&(r.$$scope={dirty:n,ctx:i}),e.$set(r)},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function tt(o){let e,t=je(o[21])+"",i;return{c(){e=x("time"),i=we(t),this.h()},l(n){e=H(n,"TIME",{id:!0,class:!0});var r=D(e);i=ye(r,t),r.forEach(v),this.h()},h(){h(e,"id","trim-duration"),h(e,"class","svelte-1vm10g7")},m(n,r){Z(n,e,r),E(e,i)},p(n,r){r[0]&2097152&&t!==(t=je(n[21])+"")&&rt(i,t)},d(n){n&&v(e)}}}function oi(o){let e,t;return e=new ht({}),{c(){ee(e.$$.fragment)},l(i){te(e.$$.fragment,i)},m(i,n){ie(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){ne(e,i)}}}function li(o){let e,t,i,n,r,s,l,u,d;const a=[si,ri],c=[];function k(f,p){return f[1]===null?0:f[15]?1:-1}return~(n=k(o))&&(r=c[n]=a[n](o)),{c(){e=x("audio"),i=J(),r&&r.c(),s=Se(),this.h()},l(f){e=H(f,"AUDIO",{class:!0,preload:!0}),D(e).forEach(v),i=Q(f),r&&r.l(f),s=Se(),this.h()},h(){h(e,"class","standard-player svelte-1vm10g7"),e.controls=!0,e.autoplay=t=o[8].autoplay,h(e,"preload","metadata"),Ne(e,"hidden",o[15])},m(f,p){Z(f,e,p),o[29](e),Z(f,i,p),~n&&c[n].m(f,p),Z(f,s,p),l=!0,u||(d=[$(e,"load",o[28]),$(e,"ended",o[30]),$(e,"play",o[31])],u=!0)},p(f,p){(!l||p[0]&256&&t!==(t=f[8].autoplay))&&(e.autoplay=t),(!l||p[0]&32768)&&Ne(e,"hidden",f[15]);let C=n;n=k(f),n===C?~n&&c[n].p(f,p):(r&&(_e(),z(c[C],1,1,()=>{c[C]=null}),be()),~n?(r=c[n],r?r.p(f,p):(r=c[n]=a[n](f),r.c()),A(r,1),r.m(s.parentNode,s)):r=null)},i(f){l||(A(r),l=!0)},o(f){z(r),l=!1},d(f){f&&(v(e),v(i),v(s)),o[29](null),~n&&c[n].d(f),u=!1,Be(d)}}}function ai(o){const e=o.split(`
`),t=[];for(let i=0;i<e.length;i++){const n=e[i].trim();if(n.includes(" --> ")){const[r,s]=n.split(" --> "),l=it(r),u=it(s);let d="";for(let a=i+1;a<e.length&&e[a].trim()!=="";a++)d&&(d+=" "),d+=e[a].trim();d&&t.push({start:l,end:u,text:d})}}return t}function it(o){const e=o.split(":");if(e.length===3){const t=parseInt(e[0]),i=parseInt(e[1]),n=parseFloat(e[2]);return t*3600+i*60+n}return 0}function ui(o,e,t){let i,n,{value:r=null}=e,{subtitles:s=null}=e,{label:l}=e,{i18n:u}=e,{dispatch_blob:d=()=>Promise.resolve()}=e,{interactive:a=!1}=e,{editable:c=!0}=e,{trim_region_settings:k={}}=e,{waveform_settings:f}=e,{waveform_options:p}=e,{mode:C=""}=e,{loop:S}=e,{handle_reset_value:N=()=>{}}=e,T,m,P=!1,M,y,_,B,q=0,Y=!1,O,K=!1,w=!0,R=[];const W=at(),V=()=>{t(12,m=Fe.create({container:T,...f})),s&&m&&(w?I(m,s):U()),r!=null&&r.url&&m&&m.load(r==null?void 0:r.url),m==null||m.on("decode",g=>{t(20,B=g),_&&t(19,_.textContent=je(g),_)}),m==null||m.on("timeupdate",g=>y&&t(18,y.textContent=je(g),y)),m==null||m.on("ready",()=>{f.autoplay?m==null||m.play():m==null||m.stop()}),m==null||m.on("finish",()=>{S?m==null||m.play():(t(16,P=!1),W("stop"))}),m==null||m.on("pause",()=>{t(16,P=!1),W("pause")}),m==null||m.on("play",()=>{t(16,P=!0),W("play")}),m==null||m.on("load",()=>{W("load")})},le=async(g,oe)=>{t(0,C="");const me=m==null?void 0:m.getDecodedData();me&&await xt(me,g,oe,f.sampleRate).then(async ue=>{await d([ue],"change"),m==null||m.destroy(),t(11,T.innerHTML="",T)}),W("edit")};async function de(g){K=!1,p.show_recording_waveform?m==null||m.load(g):O&&t(13,O.src=g,O)}function ke(g){if(!(!g||!g.is_stream||!g.url))if(Ee.isSupported()&&!K){const oe=new Ee({maxBufferLength:1,maxMaxBufferLength:1,lowLatencyMode:!0});oe.loadSource(g.url),oe.attachMedia(O),oe.on(Ee.Events.MANIFEST_PARSED,function(){f.autoplay&&O.play()}),oe.on(Ee.Events.ERROR,function(me,ue){if(console.error("HLS error:",me,ue),ue.fatal)switch(ue.type){case Ee.ErrorTypes.NETWORK_ERROR:console.error("Fatal network error encountered, trying to recover"),oe.startLoad();break;case Ee.ErrorTypes.MEDIA_ERROR:console.error("Fatal media error encountered, trying to recover"),oe.recoverMediaError();break;default:console.error("Fatal error, cannot recover"),oe.destroy();break}}),K=!0}else K||(t(13,O.src=g.url,O),f.autoplay&&O.play(),K=!0)}nt(()=>{window.addEventListener("keydown",g=>{!m||Y||(g.key==="ArrowRight"&&C!=="edit"?Ye(m,.1):g.key==="ArrowLeft"&&C!=="edit"&&Ye(m,-.1))})});async function I(g,oe){L();try{let me;if(Array.isArray(oe))me=oe;else{const We=await(await fetch(oe)).text();me=ai(We)}if(me.length>0){let ue="";if(M){t(17,M.style.display="",M);const We=Xe=>{const Oe=me.find(Ge=>Xe>=Ge.start&&Xe<=Ge.end);Oe&&Oe.text!==ue?(ue=Oe.text,t(17,M.textContent=ue,M)):!Oe&&ue!==""&&(ue="",t(17,M.textContent="",M))};g.on("audioprocess",We),R.push(()=>{g.un("audioprocess",We)})}}}catch{}}function U(){M&&t(17,M.style.display="none",M)}function L(){M&&t(17,M.textContent="",M),R.forEach(g=>g()),R=[]}function j(g){ut.call(this,o,g)}function se(g){he[g?"unshift":"push"](()=>{O=g,t(13,O)})}const ce=()=>W("stop"),b=()=>W("play");function ae(g){he[g?"unshift":"push"](()=>{T=g,t(11,T),t(15,n),t(12,m),t(9,p),t(1,r)})}function re(g){he[g?"unshift":"push"](()=>{y=g,t(18,y)})}function fe(g){he[g?"unshift":"push"](()=>{_=g,t(19,_)})}function Pe(g){he[g?"unshift":"push"](()=>{M=g,t(17,M)})}function Ae(g){C=g,t(0,C)}function Ce(g){q=g,t(21,q)}function ot(g){Y=g,t(22,Y)}function lt(g){w=g,t(14,w)}return o.$$set=g=>{"value"in g&&t(1,r=g.value),"subtitles"in g&&t(2,s=g.subtitles),"label"in g&&t(3,l=g.label),"i18n"in g&&t(4,u=g.i18n),"dispatch_blob"in g&&t(25,d=g.dispatch_blob),"interactive"in g&&t(5,a=g.interactive),"editable"in g&&t(6,c=g.editable),"trim_region_settings"in g&&t(7,k=g.trim_region_settings),"waveform_settings"in g&&t(8,f=g.waveform_settings),"waveform_options"in g&&t(9,p=g.waveform_options),"mode"in g&&t(0,C=g.mode),"loop"in g&&t(26,S=g.loop),"handle_reset_value"in g&&t(10,N=g.handle_reset_value)},o.$$.update=()=>{o.$$.dirty[0]&2&&t(27,i=r==null?void 0:r.url),o.$$.dirty[0]&514&&t(15,n=p.show_recording_waveform&&!(r!=null&&r.is_stream)),o.$$.dirty[0]&38912&&n&&T!==void 0&&T!==null&&(m!==void 0&&m.destroy(),t(11,T.innerHTML="",T),V(),t(16,P=!1)),o.$$.dirty[0]&134217728&&i&&de(i),o.$$.dirty[0]&20484&&s&&m&&(w?I(m,s):U()),o.$$.dirty[0]&8194&&O&&r!=null&&r.is_stream&&ke(r)},[C,r,s,l,u,a,c,k,f,p,N,T,m,O,w,n,P,M,y,_,B,q,Y,W,le,d,S,i,j,se,ce,b,ae,re,fe,Pe,Ae,Ce,ot,lt]}class hi extends pe{constructor(e){super(),ge(this,e,ui,li,ve,{value:1,subtitles:2,label:3,i18n:4,dispatch_blob:25,interactive:5,editable:6,trim_region_settings:7,waveform_settings:8,waveform_options:9,mode:0,loop:26,handle_reset_value:10},null,[-1,-1])}}const wi=hi;export{wi as A,ni as W,Fe as a,xt as p,Ye as s};
//# sourceMappingURL=AudioPlayer.Dm9zAm0U.js.map
