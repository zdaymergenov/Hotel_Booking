{"version":3,"mappings":"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","names":["fn","semiver","a","b","bool","HOST_URL","SSE_URL","SSE_DATA_URL","UPLOAD_URL","LOGIN_URL","CONFIG_URL","API_INFO_URL","RUNTIME_URL","SLEEPTIME_URL","HEARTBEAT_URL","COMPONENT_SERVER_URL","RESET_URL","CANCEL_URL","APP_ID_URL","SPACE_FETCHER_URL","QUEUE_FULL_MSG","BROKEN_CONNECTION_MSG","CONFIG_ERROR_MSG","SPACE_STATUS_ERROR_MSG","API_INFO_ERROR_MSG","SPACE_METADATA_ERROR_MSG","INVALID_URL_MSG","UNAUTHORIZED_MSG","INVALID_CREDENTIALS_MSG","MISSING_CREDENTIALS_MSG","NODEJS_FS_ERROR_MSG","ROOT_URL_ERROR_MSG","FILE_PROCESSING_ERROR_MSG","resolve_root","base_url","root_path","prioritize_base","get_jwt","space","token","cookies","map_names_to_ids","fns","apis","api_name","id","resolve_config","endpoint","headers","config_url","join_urls","response","handleConfigResponse","authorized","auth_message","config","dep","resolve_cookies","http_protocol","host","process_endpoint","cookie_header","get_cookie_header","auth","_fetch","hf_token","formData","res","determine_protocol","protocol","pathname","parse_and_set_cookies","cookie","cookie_name","cookie_value","RE_SPACE_NAME","RE_SPACE_DOMAIN","app_reference","_app_reference","_host","ws_protocol","urls","part","transform_api_info","api_info","api_map","transformed_info","category","parameters","returns","dependencyIndex","dependencyTypes","components","input","c","comp","idx","new_param","e","transform_type","data","component","serializer","signature_type","get_description","get_type","p","r","type","handle_message","last_status","map_data_to_params","endpoint_info","resolved_data","provided_keys","param","index","key","value","view_api","url","upload_files","root_url","files","upload_id","chunkSize","uploadResponses","i","chunk","file","upload_url","error_text","output","upload","file_data","max_file_size","oversized_files","f","FileData","prepare_files","is_stream","path","orig_name","size","blob","mime_type","alt_text","b64","Command","command","meta","update_object","object","newValue","stack","walk_and_store_blobs","root","blob_refs","_","new_path","array_refs","skip_queue","fn_queue","post_message","message","origin","_rej","channel","handle_payload","resolved_payload","dependency","with_null_state","updated_payload","payload_index","deps","input_id","handle_blob","self","process_local_file_commands","blobRefs","file_url","name","client","recursively_process_commands","process_single_command","cmd_item","fileBuffer","fullPath","fs","__vitePreload","n","fileData","error","post_data","body","additional_headers","status","predict","data_returned","status_complete","trimmed_endpoint","resolve","reject","app","result","check_space_status","status_callback","_status","stage","space_name","discussions_enabled","check_and_wake_space","space_id","retries","max_retries","check_interval","RE_DISABLED_DISCUSSION","get_space_hardware","hardware","set_space_timeout","timeout","hardware_types","duplicate","options","_private","v","user","original_hardware","requested_hardware","Client","duplicated_space","get_space_reference","regex","match","TextLineStream","#currentLine","chars","controller","lfIndex","crIndex","endIndex","currentLine","stream","decoder","split","fallback","events","signal","iter","utils.stream","line","reader","event","field","utils.split","init","req","utils.fallback","open_stream","event_callbacks","unclosed_events","pending_stream_messages","stream_status","jwt","that","params","_data","close_stream","event_id","abort_controller","apply_diff_stream","pending_diff_streams","new_data","apply_diff","obj","diff","action","apply_edit","target","current","last_path","readable_stream","instance","submit","event_data","trigger_id","all_events","fire_event","events_to_publish","push_event","close","done","resolvers","push","values","push_error","thenable_reject","next","fetch","session_hash","api_prefix","fn_index","get_endpoint_info","websocket","event_id_final","event_id_cb","_endpoint","payload","complete","url_params","acc","cancel","reset_request","cancel_request","resolve_heartbeat","handle_render_config","render_config","render_id","d","any_state","any_unload","t","_payload","status_code","evt","hostname","callback","original_msg","broken","msg","iterator","stripSlashes","str","url_path","page","_config","heartbeat_url","app_id_url","app_id","configUrl","component_id","fn_name","raw_cookies","ws","ENTRY_CSS","FONTS","IndexComponent","mount_css","_res","pending","get_index","modules","create_custom_element","o","svelte","GradioApp","mutations","old_val","new_val"],"ignoreList":[0,14,15,16],"sources":["../../../../node_modules/.pnpm/semiver@1.1.0/node_modules/semiver/dist/semiver.mjs","../../../../client/js/src/constants.ts","../../../../client/js/src/helpers/init_helpers.ts","../../../../client/js/src/helpers/api_info.ts","../../../../client/js/src/utils/view_api.ts","../../../../client/js/src/utils/upload_files.ts","../../../../client/js/src/upload.ts","../../../../client/js/src/types.ts","../../../../client/js/src/helpers/data.ts","../../../../client/js/src/utils/handle_blob.ts","../../../../client/js/src/utils/post_data.ts","../../../../client/js/src/utils/predict.ts","../../../../client/js/src/helpers/spaces.ts","../../../../client/js/src/utils/duplicate.ts","../../../../node_modules/.pnpm/fetch-event-stream@0.1.5/node_modules/fetch-event-stream/esm/deps/jsr.io/@std/streams/0.221.0/text_line_stream.js","../../../../node_modules/.pnpm/fetch-event-stream@0.1.5/node_modules/fetch-event-stream/esm/utils.js","../../../../node_modules/.pnpm/fetch-event-stream@0.1.5/node_modules/fetch-event-stream/esm/mod.js","../../../../client/js/src/utils/stream.ts","../../../../client/js/src/utils/submit.ts","../../../../client/js/src/client.ts","../../../../js/spa/src/main.ts"],"sourcesContent":["var fn = new Intl.Collator(0, { numeric:1 }).compare;\n\nexport default function (a, b, bool) {\n\ta = a.split('.');\n\tb = b.split('.');\n\n\treturn fn(a[0], b[0]) || fn(a[1], b[1]) || (\n\t\tb[2] = b.slice(2).join('.'),\n\t\tbool = /[.-]/.test(a[2] = a.slice(2).join('.')),\n\t\tbool == /[.-]/.test(b[2]) ? fn(a[2], b[2]) : bool ? -1 : 1\n\t);\n}\n","// endpoints\nexport const HOST_URL = `host`;\nexport const API_URL = `predict/`;\nexport const SSE_URL_V0 = `queue/join`;\nexport const SSE_DATA_URL_V0 = `queue/data`;\nexport const SSE_URL = `queue/data`;\nexport const SSE_DATA_URL = `queue/join`;\nexport const UPLOAD_URL = `upload`;\nexport const LOGIN_URL = `login`;\nexport const CONFIG_URL = `config`;\nexport const API_INFO_URL = `info`;\nexport const RUNTIME_URL = `runtime`;\nexport const SLEEPTIME_URL = `sleeptime`;\nexport const HEARTBEAT_URL = `heartbeat`;\nexport const COMPONENT_SERVER_URL = `component_server`;\nexport const RESET_URL = `reset`;\nexport const CANCEL_URL = `cancel`;\nexport const APP_ID_URL = `app_id`;\n\nexport const RAW_API_INFO_URL = `info?serialize=False`;\nexport const SPACE_FETCHER_URL =\n\t\"https://gradio-space-api-fetcher-v2.hf.space/api\";\nexport const SPACE_URL = \"https://hf.space/{}\";\n\n// messages\nexport const QUEUE_FULL_MSG =\n\t\"This application is currently busy. Please try again. \";\nexport const BROKEN_CONNECTION_MSG = \"Connection errored out. \";\nexport const CONFIG_ERROR_MSG = \"Could not resolve app config. \";\nexport const SPACE_STATUS_ERROR_MSG = \"Could not get space status. \";\nexport const API_INFO_ERROR_MSG = \"Could not get API info. \";\nexport const SPACE_METADATA_ERROR_MSG = \"Space metadata could not be loaded. \";\nexport const INVALID_URL_MSG = \"Invalid URL. A full URL path is required.\";\nexport const UNAUTHORIZED_MSG = \"Not authorized to access this space. \";\nexport const INVALID_CREDENTIALS_MSG = \"Invalid credentials. Could not login. \";\nexport const MISSING_CREDENTIALS_MSG =\n\t\"Login credentials are required to access this space.\";\nexport const NODEJS_FS_ERROR_MSG =\n\t\"File system access is only available in Node.js environments\";\nexport const ROOT_URL_ERROR_MSG = \"Root URL not found in client config\";\nexport const FILE_PROCESSING_ERROR_MSG = \"Error uploading file\";\n","import type { Config } from \"../types\";\nimport {\n\tCONFIG_ERROR_MSG,\n\tCONFIG_URL,\n\tINVALID_CREDENTIALS_MSG,\n\tLOGIN_URL,\n\tMISSING_CREDENTIALS_MSG,\n\tSPACE_METADATA_ERROR_MSG,\n\tUNAUTHORIZED_MSG\n} from \"../constants\";\nimport { Client } from \"..\";\nimport { join_urls, process_endpoint } from \"./api_info\";\n\n/**\n * This function is used to resolve the URL for making requests when the app has a root path.\n * The root path could be a path suffix like \"/app\" which is appended to the end of the base URL. Or\n * it could be a full URL like \"https://abidlabs-test-client-replica--gqf2x.hf.space\" which is used when hosting\n * Gradio apps on Hugging Face Spaces.\n * @param {string} base_url The base URL at which the Gradio server is hosted\n * @param {string} root_path The root path, which could be a path suffix (e.g. mounted in FastAPI app) or a full URL (e.g. hosted on Hugging Face Spaces)\n * @param {boolean} prioritize_base Whether to prioritize the base URL over the root path. This is used when both the base path and root paths are full URLs. For example, for fetching files the root path should be prioritized, but for making requests, the base URL should be prioritized.\n * @returns {string} the resolved URL\n */\nexport function resolve_root(\n\tbase_url: string,\n\troot_path: string,\n\tprioritize_base: boolean\n): string {\n\tif (root_path.startsWith(\"http://\") || root_path.startsWith(\"https://\")) {\n\t\treturn prioritize_base ? base_url : root_path;\n\t}\n\treturn base_url + root_path;\n}\n\nexport async function get_jwt(\n\tspace: string,\n\ttoken: `hf_${string}`,\n\tcookies?: string | null\n): Promise<string | false> {\n\ttry {\n\t\tconst r = await fetch(`https://huggingface.co/api/spaces/${space}/jwt`, {\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t...(cookies ? { Cookie: cookies } : {})\n\t\t\t}\n\t\t});\n\n\t\tconst jwt = (await r.json()).token;\n\n\t\treturn jwt || false;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nexport function map_names_to_ids(\n\tfns: Config[\"dependencies\"]\n): Record<string, number> {\n\tlet apis: Record<string, number> = {};\n\n\tfns.forEach(({ api_name, id }) => {\n\t\tif (api_name) apis[api_name] = id;\n\t});\n\treturn apis;\n}\n\nexport async function resolve_config(\n\tthis: Client,\n\tendpoint: string\n): Promise<Config | undefined> {\n\tconst headers: Record<string, string> = this.options.hf_token\n\t\t? { Authorization: `Bearer ${this.options.hf_token}` }\n\t\t: {};\n\n\theaders[\"Content-Type\"] = \"application/json\";\n\n\tif (\n\t\ttypeof window !== \"undefined\" &&\n\t\twindow.gradio_config &&\n\t\tlocation.origin !== \"http://localhost:9876\" &&\n\t\t!window.gradio_config.dev_mode\n\t) {\n\t\tif (window.gradio_config.current_page) {\n\t\t\tendpoint = endpoint.substring(0, endpoint.lastIndexOf(\"/\"));\n\t\t}\n\t\twindow.gradio_config.root = endpoint;\n\t\t// @ts-ignore\n\t\treturn { ...window.gradio_config } as Config;\n\t} else if (endpoint) {\n\t\tlet config_url = join_urls(\n\t\t\tendpoint,\n\t\t\tthis.deep_link ? CONFIG_URL + \"?deep_link=\" + this.deep_link : CONFIG_URL\n\t\t);\n\n\t\tconst response = await this.fetch(config_url, {\n\t\t\theaders,\n\t\t\tcredentials: \"include\"\n\t\t});\n\n\t\treturn handleConfigResponse(response, endpoint, !!this.options.auth);\n\t}\n\n\tthrow new Error(CONFIG_ERROR_MSG);\n}\n\nasync function handleConfigResponse(\n\tresponse: Response,\n\tendpoint: string,\n\tauthorized: boolean\n): Promise<Config> {\n\tif (response?.status === 401 && !authorized) {\n\t\tconst error_data = await response.json();\n\t\tconst auth_message = error_data?.detail?.auth_message;\n\t\tthrow new Error(auth_message || MISSING_CREDENTIALS_MSG);\n\t} else if (response?.status === 401 && authorized) {\n\t\tthrow new Error(INVALID_CREDENTIALS_MSG);\n\t}\n\n\tif (response?.status === 200) {\n\t\tlet config = await response.json();\n\t\tconfig.root = endpoint;\n\t\tconfig.dependencies?.forEach((dep: any, i: number) => {\n\t\t\tif (dep.id === undefined) {\n\t\t\t\tdep.id = i;\n\t\t\t}\n\t\t});\n\t\treturn config;\n\t} else if (response?.status === 401) {\n\t\tthrow new Error(UNAUTHORIZED_MSG);\n\t}\n\n\tthrow new Error(CONFIG_ERROR_MSG);\n}\n\nexport async function resolve_cookies(this: Client): Promise<void> {\n\tconst { http_protocol, host } = await process_endpoint(\n\t\tthis.app_reference,\n\t\tthis.options.hf_token\n\t);\n\n\ttry {\n\t\tif (this.options.auth) {\n\t\t\tconst cookie_header = await get_cookie_header(\n\t\t\t\thttp_protocol,\n\t\t\t\thost,\n\t\t\t\tthis.options.auth,\n\t\t\t\tthis.fetch,\n\t\t\t\tthis.options.hf_token\n\t\t\t);\n\n\t\t\tif (cookie_header) this.set_cookies(cookie_header);\n\t\t}\n\t} catch (e: unknown) {\n\t\tthrow Error((e as Error).message);\n\t}\n}\n\n// separating this from client-bound resolve_cookies so that it can be used in duplicate\nexport async function get_cookie_header(\n\thttp_protocol: string,\n\thost: string,\n\tauth: [string, string],\n\t_fetch: typeof fetch,\n\thf_token?: `hf_${string}`\n): Promise<string | null> {\n\tconst formData = new FormData();\n\tformData.append(\"username\", auth?.[0]);\n\tformData.append(\"password\", auth?.[1]);\n\n\tlet headers: { Authorization?: string } = {};\n\n\tif (hf_token) {\n\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t}\n\n\tconst res = await _fetch(`${http_protocol}//${host}/${LOGIN_URL}`, {\n\t\theaders,\n\t\tmethod: \"POST\",\n\t\tbody: formData,\n\t\tcredentials: \"include\"\n\t});\n\n\tif (res.status === 200) {\n\t\treturn res.headers.get(\"set-cookie\");\n\t} else if (res.status === 401) {\n\t\tthrow new Error(INVALID_CREDENTIALS_MSG);\n\t} else {\n\t\tthrow new Error(SPACE_METADATA_ERROR_MSG);\n\t}\n}\n\nexport function determine_protocol(endpoint: string): {\n\tws_protocol: \"ws\" | \"wss\";\n\thttp_protocol: \"http:\" | \"https:\";\n\thost: string;\n} {\n\tif (endpoint.startsWith(\"http\")) {\n\t\tconst { protocol, host, pathname } = new URL(endpoint);\n\n\t\treturn {\n\t\t\tws_protocol: protocol === \"https:\" ? \"wss\" : \"ws\",\n\t\t\thttp_protocol: protocol as \"http:\" | \"https:\",\n\t\t\thost: host + (pathname !== \"/\" ? pathname : \"\")\n\t\t};\n\t}\n\n\t// default to secure if no protocol is provided\n\n\treturn {\n\t\tws_protocol: \"wss\",\n\t\thttp_protocol: \"https:\",\n\t\thost: new URL(endpoint).host\n\t};\n}\n\nexport const parse_and_set_cookies = (cookie_header: string): string[] => {\n\tlet cookies: string[] = [];\n\tconst parts = cookie_header.split(/,(?=\\s*[^\\s=;]+=[^\\s=;]+)/);\n\tparts.forEach((cookie) => {\n\t\tconst [cookie_name, cookie_value] = cookie.split(\";\")[0].split(\"=\");\n\t\tif (cookie_name && cookie_value) {\n\t\t\tcookies.push(`${cookie_name.trim()}=${cookie_value.trim()}`);\n\t\t}\n\t});\n\treturn cookies;\n};\n","import {\n\tHOST_URL,\n\tINVALID_URL_MSG,\n\tQUEUE_FULL_MSG,\n\tSPACE_METADATA_ERROR_MSG\n} from \"../constants\";\nimport type {\n\tApiData,\n\tApiInfo,\n\tConfig,\n\tJsApiData,\n\tEndpointInfo,\n\tStatus\n} from \"../types\";\nimport { determine_protocol } from \"./init_helpers\";\n\nexport const RE_SPACE_NAME = /^[a-zA-Z0-9_\\-\\.]+\\/[a-zA-Z0-9_\\-\\.]+$/;\nexport const RE_SPACE_DOMAIN = /.*hf\\.space\\/{0,1}.*$/;\n\nexport async function process_endpoint(\n\tapp_reference: string,\n\thf_token?: `hf_${string}`\n): Promise<{\n\tspace_id: string | false;\n\thost: string;\n\tws_protocol: \"ws\" | \"wss\";\n\thttp_protocol: \"http:\" | \"https:\";\n}> {\n\tconst headers: { Authorization?: string } = {};\n\tif (hf_token) {\n\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t}\n\n\tconst _app_reference = app_reference.trim().replace(/\\/$/, \"\");\n\n\tif (RE_SPACE_NAME.test(_app_reference)) {\n\t\t// app_reference is a HF space name\n\t\ttry {\n\t\t\tconst res = await fetch(\n\t\t\t\t`https://huggingface.co/api/spaces/${_app_reference}/${HOST_URL}`,\n\t\t\t\t{ headers }\n\t\t\t);\n\n\t\t\tconst _host = (await res.json()).host;\n\n\t\t\treturn {\n\t\t\t\tspace_id: app_reference,\n\t\t\t\t...determine_protocol(_host)\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tthrow new Error(SPACE_METADATA_ERROR_MSG);\n\t\t}\n\t}\n\n\tif (RE_SPACE_DOMAIN.test(_app_reference)) {\n\t\t// app_reference is a direct HF space domain\n\t\tconst { ws_protocol, http_protocol, host } =\n\t\t\tdetermine_protocol(_app_reference);\n\n\t\treturn {\n\t\t\tspace_id: host.split(\"/\")[0].replace(\".hf.space\", \"\"),\n\t\t\tws_protocol,\n\t\t\thttp_protocol,\n\t\t\thost\n\t\t};\n\t}\n\n\treturn {\n\t\tspace_id: false,\n\t\t...determine_protocol(_app_reference)\n\t};\n}\n\nexport const join_urls = (...urls: string[]): string => {\n\ttry {\n\t\treturn urls.reduce((base_url: string, part: string) => {\n\t\t\tbase_url = base_url.replace(/\\/+$/, \"\");\n\t\t\tpart = part.replace(/^\\/+/, \"\");\n\t\t\treturn new URL(part, base_url + \"/\").toString();\n\t\t});\n\t} catch (e) {\n\t\tthrow new Error(INVALID_URL_MSG);\n\t}\n};\n\nexport function transform_api_info(\n\tapi_info: ApiInfo<ApiData>,\n\tconfig: Config,\n\tapi_map: Record<string, number>\n): ApiInfo<JsApiData> {\n\tconst transformed_info: ApiInfo<JsApiData> = {\n\t\tnamed_endpoints: {},\n\t\tunnamed_endpoints: {}\n\t};\n\n\tObject.keys(api_info).forEach((category) => {\n\t\tif (category === \"named_endpoints\" || category === \"unnamed_endpoints\") {\n\t\t\ttransformed_info[category] = {};\n\n\t\t\tObject.entries(api_info[category]).forEach(\n\t\t\t\t([endpoint, { parameters, returns }]) => {\n\t\t\t\t\tconst dependencyIndex =\n\t\t\t\t\t\tconfig.dependencies.find(\n\t\t\t\t\t\t\t(dep) =>\n\t\t\t\t\t\t\t\tdep.api_name === endpoint ||\n\t\t\t\t\t\t\t\tdep.api_name === endpoint.replace(\"/\", \"\")\n\t\t\t\t\t\t)?.id ||\n\t\t\t\t\t\tapi_map[endpoint.replace(\"/\", \"\")] ||\n\t\t\t\t\t\t-1;\n\n\t\t\t\t\tconst dependencyTypes =\n\t\t\t\t\t\tdependencyIndex !== -1\n\t\t\t\t\t\t\t? config.dependencies.find((dep) => dep.id == dependencyIndex)\n\t\t\t\t\t\t\t\t\t?.types\n\t\t\t\t\t\t\t: { generator: false, cancel: false };\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tdependencyIndex !== -1 &&\n\t\t\t\t\t\tconfig.dependencies.find((dep) => dep.id == dependencyIndex)?.inputs\n\t\t\t\t\t\t\t?.length !== parameters.length\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst components = config.dependencies\n\t\t\t\t\t\t\t.find((dep) => dep.id == dependencyIndex)!\n\t\t\t\t\t\t\t.inputs.map(\n\t\t\t\t\t\t\t\t(input) => config.components.find((c) => c.id === input)?.type\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcomponents.forEach((comp, idx) => {\n\t\t\t\t\t\t\t\tif (comp === \"state\") {\n\t\t\t\t\t\t\t\t\tconst new_param = {\n\t\t\t\t\t\t\t\t\t\tcomponent: \"state\",\n\t\t\t\t\t\t\t\t\t\texample: null,\n\t\t\t\t\t\t\t\t\t\tparameter_default: null,\n\t\t\t\t\t\t\t\t\t\tparameter_has_default: true,\n\t\t\t\t\t\t\t\t\t\tparameter_name: null,\n\t\t\t\t\t\t\t\t\t\thidden: true\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\t\t\tparameters.splice(idx, 0, new_param);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst transform_type = (\n\t\t\t\t\t\tdata: ApiData,\n\t\t\t\t\t\tcomponent: string,\n\t\t\t\t\t\tserializer: string,\n\t\t\t\t\t\tsignature_type: \"return\" | \"parameter\"\n\t\t\t\t\t): JsApiData => ({\n\t\t\t\t\t\t...data,\n\t\t\t\t\t\tdescription: get_description(data?.type, serializer),\n\t\t\t\t\t\ttype:\n\t\t\t\t\t\t\tget_type(data?.type, component, serializer, signature_type) || \"\"\n\t\t\t\t\t});\n\n\t\t\t\t\ttransformed_info[category][endpoint] = {\n\t\t\t\t\t\tparameters: parameters.map((p: ApiData) =>\n\t\t\t\t\t\t\ttransform_type(p, p?.component, p?.serializer, \"parameter\")\n\t\t\t\t\t\t),\n\t\t\t\t\t\treturns: returns.map((r: ApiData) =>\n\t\t\t\t\t\t\ttransform_type(r, r?.component, r?.serializer, \"return\")\n\t\t\t\t\t\t),\n\t\t\t\t\t\ttype: dependencyTypes\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t});\n\n\treturn transformed_info;\n}\n\nexport function get_type(\n\ttype: { type: any; description: string },\n\tcomponent: string,\n\tserializer: string,\n\tsignature_type: \"return\" | \"parameter\"\n): string | undefined {\n\tif (component === \"Api\") return type.type;\n\tswitch (type?.type) {\n\t\tcase \"string\":\n\t\t\treturn \"string\";\n\t\tcase \"boolean\":\n\t\t\treturn \"boolean\";\n\t\tcase \"number\":\n\t\t\treturn \"number\";\n\t}\n\n\tif (\n\t\tserializer === \"JSONSerializable\" ||\n\t\tserializer === \"StringSerializable\"\n\t) {\n\t\treturn \"any\";\n\t} else if (serializer === \"ListStringSerializable\") {\n\t\treturn \"string[]\";\n\t} else if (component === \"Image\") {\n\t\treturn signature_type === \"parameter\" ? \"Blob | File | Buffer\" : \"string\";\n\t} else if (serializer === \"FileSerializable\") {\n\t\tif (type?.type === \"array\") {\n\t\t\treturn signature_type === \"parameter\"\n\t\t\t\t? \"(Blob | File | Buffer)[]\"\n\t\t\t\t: `{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]`;\n\t\t}\n\t\treturn signature_type === \"parameter\"\n\t\t\t? \"Blob | File | Buffer\"\n\t\t\t: `{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}`;\n\t} else if (serializer === \"GallerySerializable\") {\n\t\treturn signature_type === \"parameter\"\n\t\t\t? \"[(Blob | File | Buffer), (string | null)][]\"\n\t\t\t: `[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]`;\n\t}\n}\n\nexport function get_description(\n\ttype: { type: any; description: string },\n\tserializer: string\n): string {\n\tif (serializer === \"GallerySerializable\") {\n\t\treturn \"array of [file, label] tuples\";\n\t} else if (serializer === \"ListStringSerializable\") {\n\t\treturn \"array of strings\";\n\t} else if (serializer === \"FileSerializable\") {\n\t\treturn \"array of files or single file\";\n\t}\n\treturn type?.description;\n}\n\n/* eslint-disable complexity */\nexport function handle_message(\n\tdata: any,\n\tlast_status: Status[\"stage\"]\n): {\n\ttype:\n\t\t| \"hash\"\n\t\t| \"data\"\n\t\t| \"update\"\n\t\t| \"complete\"\n\t\t| \"generating\"\n\t\t| \"log\"\n\t\t| \"none\"\n\t\t| \"heartbeat\"\n\t\t| \"streaming\"\n\t\t| \"broken_connection\"\n\t\t| \"unexpected_error\";\n\tdata?: any;\n\tstatus?: Status;\n\toriginal_msg?: string;\n} {\n\tconst queue = true;\n\tswitch (data.msg) {\n\t\tcase \"send_data\":\n\t\t\treturn { type: \"data\" };\n\t\tcase \"send_hash\":\n\t\t\treturn { type: \"hash\" };\n\t\tcase \"queue_full\":\n\t\t\treturn {\n\t\t\t\ttype: \"update\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: QUEUE_FULL_MSG,\n\t\t\t\t\tstage: \"error\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tsuccess: data.success\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"heartbeat\":\n\t\t\treturn {\n\t\t\t\ttype: \"heartbeat\"\n\t\t\t};\n\t\tcase \"unexpected_error\":\n\t\t\treturn {\n\t\t\t\ttype: \"unexpected_error\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: data.message,\n\t\t\t\t\tsession_not_found: data.session_not_found,\n\t\t\t\t\tstage: \"error\",\n\t\t\t\t\tsuccess: false\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"broken_connection\":\n\t\t\treturn {\n\t\t\t\ttype: \"broken_connection\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: data.message,\n\t\t\t\t\tstage: \"error\",\n\t\t\t\t\tsuccess: false\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"estimation\":\n\t\t\treturn {\n\t\t\t\ttype: \"update\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tstage: last_status || \"pending\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tsize: data.queue_size,\n\t\t\t\t\tposition: data.rank,\n\t\t\t\t\teta: data.rank_eta,\n\t\t\t\t\tsuccess: data.success\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"progress\":\n\t\t\treturn {\n\t\t\t\ttype: \"update\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tprogress_data: data.progress_data,\n\t\t\t\t\tsuccess: data.success\n\t\t\t\t}\n\t\t\t};\n\t\tcase \"log\":\n\t\t\treturn { type: \"log\", data: data };\n\t\tcase \"process_generating\":\n\t\t\treturn {\n\t\t\t\ttype: \"generating\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: !data.success ? data.output.error : null,\n\t\t\t\t\tstage: data.success ? \"generating\" : \"error\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tprogress_data: data.progress_data,\n\t\t\t\t\teta: data.average_duration,\n\t\t\t\t\tchanged_state_ids: data.success\n\t\t\t\t\t\t? data.output.changed_state_ids\n\t\t\t\t\t\t: undefined\n\t\t\t\t},\n\t\t\t\tdata: data.success ? data.output : null\n\t\t\t};\n\t\tcase \"process_streaming\":\n\t\t\treturn {\n\t\t\t\ttype: \"streaming\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: data.output.error,\n\t\t\t\t\tstage: \"streaming\",\n\t\t\t\t\ttime_limit: data.time_limit,\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tprogress_data: data.progress_data,\n\t\t\t\t\teta: data.eta\n\t\t\t\t},\n\t\t\t\tdata: data.output\n\t\t\t};\n\t\tcase \"process_completed\":\n\t\t\tif (\"error\" in data.output) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: \"update\",\n\t\t\t\t\tstatus: {\n\t\t\t\t\t\tqueue,\n\t\t\t\t\t\ttitle: data.output.title as string,\n\t\t\t\t\t\tmessage: data.output.error as string,\n\t\t\t\t\t\tvisible: data.output.visible as boolean,\n\t\t\t\t\t\tduration: data.output.duration as number,\n\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\tcode: data.code,\n\t\t\t\t\t\tsuccess: data.success\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\ttype: \"complete\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tmessage: !data.success ? data.output.error : undefined,\n\t\t\t\t\tstage: data.success ? \"complete\" : \"error\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tprogress_data: data.progress_data,\n\t\t\t\t\tchanged_state_ids: data.success\n\t\t\t\t\t\t? data.output.changed_state_ids\n\t\t\t\t\t\t: undefined\n\t\t\t\t},\n\t\t\t\tdata: data.success ? data.output : null\n\t\t\t};\n\n\t\tcase \"process_starts\":\n\t\t\treturn {\n\t\t\t\ttype: \"update\",\n\t\t\t\tstatus: {\n\t\t\t\t\tqueue,\n\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\tcode: data.code,\n\t\t\t\t\tsize: data.rank,\n\t\t\t\t\tposition: 0,\n\t\t\t\t\tsuccess: data.success,\n\t\t\t\t\teta: data.eta\n\t\t\t\t},\n\t\t\t\toriginal_msg: \"process_starts\"\n\t\t\t};\n\t}\n\n\treturn { type: \"none\", status: { stage: \"error\", queue } };\n}\n/* eslint-enable complexity */\n\n/**\n * Maps the provided `data` to the parameters defined by the `/info` endpoint response.\n * This allows us to support both positional and keyword arguments passed to the client\n * and ensures that all parameters are either directly provided or have default values assigned.\n *\n * @param {unknown[] | Record<string, unknown>} data - The input data for the function,\n *        which can be either an array of values for positional arguments or an object\n *        with key-value pairs for keyword arguments.\n * @param {JsApiData[]} parameters - Array of parameter descriptions retrieved from the\n *        `/info` endpoint.\n *\n * @returns {unknown[]} - Returns an array of resolved data where each element corresponds\n *         to the expected parameter from the API. The `parameter_default` value is used where\n *         a value is not provided for a parameter, and optional parameters without defaults are\n * \t\t   set to `undefined`.\n *\n * @throws {Error} - Throws an error:\n *         - If more arguments are provided than are defined in the parameters.\n *  *      - If no parameter value is provided for a required parameter and no default value is defined.\n *         - If an argument is provided that does not match any defined parameter.\n */\n\nexport const map_data_to_params = (\n\tdata: unknown[] | Record<string, unknown> = [],\n\tendpoint_info: EndpointInfo<JsApiData | ApiData>\n): unknown[] => {\n\t// Workaround for the case where the endpoint_info is undefined\n\t// See https://github.com/gradio-app/gradio/pull/8820#issuecomment-2237381761\n\tconst parameters = endpoint_info ? endpoint_info.parameters : [];\n\n\tif (Array.isArray(data)) {\n\t\tif (\n\t\t\tendpoint_info &&\n\t\t\tparameters.length > 0 &&\n\t\t\tdata.length > parameters.length\n\t\t) {\n\t\t\tconsole.warn(\"Too many arguments provided for the endpoint.\");\n\t\t}\n\t\treturn data;\n\t}\n\n\tconst resolved_data: unknown[] = [];\n\tconst provided_keys = Object.keys(data);\n\n\tparameters.forEach((param, index) => {\n\t\tif (data.hasOwnProperty(param.parameter_name)) {\n\t\t\tresolved_data[index] = data[param.parameter_name];\n\t\t} else if (param.parameter_has_default) {\n\t\t\tresolved_data[index] = param.parameter_default;\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`No value provided for required parameter: ${param.parameter_name}`\n\t\t\t);\n\t\t}\n\t});\n\n\tprovided_keys.forEach((key) => {\n\t\tif (!parameters.some((param) => param.parameter_name === key)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Parameter \\`${key}\\` is not a valid keyword argument. Please refer to the API for usage.`\n\t\t\t);\n\t\t}\n\t});\n\n\tresolved_data.forEach((value, idx) => {\n\t\tif (value === undefined && !parameters[idx].parameter_has_default) {\n\t\t\tthrow new Error(\n\t\t\t\t`No value provided for required parameter: ${parameters[idx].parameter_name}`\n\t\t\t);\n\t\t}\n\t});\n\n\treturn resolved_data;\n};\n","import type { ApiInfo, ApiData } from \"../types\";\nimport semiver from \"semiver\";\nimport { API_INFO_URL, BROKEN_CONNECTION_MSG } from \"../constants\";\nimport { Client } from \"../client\";\nimport { SPACE_FETCHER_URL } from \"../constants\";\nimport { join_urls, transform_api_info } from \"../helpers/api_info\";\n\nexport async function view_api(this: Client): Promise<any> {\n\tif (this.api_info) return this.api_info;\n\n\tconst { hf_token } = this.options;\n\tconst { config } = this;\n\n\tconst headers: {\n\t\tAuthorization?: string;\n\t\t\"Content-Type\": \"application/json\";\n\t} = { \"Content-Type\": \"application/json\" };\n\n\tif (hf_token) {\n\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t}\n\n\tif (!config) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\tlet response: Response;\n\t\tlet api_info: ApiInfo<ApiData> | { api: ApiInfo<ApiData> };\n\t\tif (typeof window !== \"undefined\" && window.gradio_api_info) {\n\t\t\tapi_info = window.gradio_api_info;\n\t\t} else {\n\t\t\tif (semiver(config?.version || \"2.0.0\", \"3.30\") < 0) {\n\t\t\t\tresponse = await this.fetch(SPACE_FETCHER_URL, {\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\tserialize: false,\n\t\t\t\t\t\tconfig: JSON.stringify(config)\n\t\t\t\t\t}),\n\t\t\t\t\theaders,\n\t\t\t\t\tcredentials: \"include\"\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst url = join_urls(config.root, this.api_prefix, API_INFO_URL);\n\t\t\t\tresponse = await this.fetch(url, {\n\t\t\t\t\theaders,\n\t\t\t\t\tcredentials: \"include\"\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(BROKEN_CONNECTION_MSG);\n\t\t\t}\n\t\t\tapi_info = await response.json();\n\t\t}\n\t\tif (\"api\" in api_info) {\n\t\t\tapi_info = api_info.api;\n\t\t}\n\n\t\tif (\n\t\t\tapi_info.named_endpoints[\"/predict\"] &&\n\t\t\t!api_info.unnamed_endpoints[\"0\"]\n\t\t) {\n\t\t\tapi_info.unnamed_endpoints[0] = api_info.named_endpoints[\"/predict\"];\n\t\t}\n\n\t\treturn transform_api_info(api_info, config, this.api_map);\n\t} catch (e) {\n\t\tthrow new Error(\"Could not get API info. \" + (e as Error).message);\n\t}\n}\n","import type { Client } from \"..\";\nimport { BROKEN_CONNECTION_MSG, UPLOAD_URL } from \"../constants\";\nimport type { UploadResponse } from \"../types\";\n\nexport async function upload_files(\n\tthis: Client,\n\troot_url: string,\n\tfiles: (Blob | File)[],\n\tupload_id?: string\n): Promise<UploadResponse> {\n\tconst headers: {\n\t\tAuthorization?: string;\n\t} = {};\n\tif (this?.options?.hf_token) {\n\t\theaders.Authorization = `Bearer ${this.options.hf_token}`;\n\t}\n\n\tconst chunkSize = 1000;\n\tconst uploadResponses = [];\n\tlet response: Response;\n\n\tfor (let i = 0; i < files.length; i += chunkSize) {\n\t\tconst chunk = files.slice(i, i + chunkSize);\n\t\tconst formData = new FormData();\n\t\tchunk.forEach((file) => {\n\t\t\tformData.append(\"files\", file);\n\t\t});\n\t\ttry {\n\t\t\tconst upload_url = upload_id\n\t\t\t\t? `${root_url}${this.api_prefix}/${UPLOAD_URL}?upload_id=${upload_id}`\n\t\t\t\t: `${root_url}${this.api_prefix}/${UPLOAD_URL}`;\n\n\t\t\tresponse = await this.fetch(upload_url, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tbody: formData,\n\t\t\t\theaders,\n\t\t\t\tcredentials: \"include\"\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tthrow new Error(BROKEN_CONNECTION_MSG + (e as Error).message);\n\t\t}\n\t\tif (!response.ok) {\n\t\t\tconst error_text = await response.text();\n\t\t\treturn { error: `HTTP ${response.status}: ${error_text}` };\n\t\t}\n\t\tconst output: UploadResponse[\"files\"] = await response.json();\n\t\tif (output) {\n\t\t\tuploadResponses.push(...output);\n\t\t}\n\t}\n\treturn { files: uploadResponses };\n}\n","import type { Client } from \"./client\";\n\nexport async function upload(\n\tthis: Client,\n\tfile_data: FileData[],\n\troot_url: string,\n\tupload_id?: string,\n\tmax_file_size?: number\n): Promise<(FileData | null)[] | null> {\n\tlet files = (Array.isArray(file_data) ? file_data : [file_data]).map(\n\t\t(file_data) => file_data.blob!\n\t);\n\n\tconst oversized_files = files.filter(\n\t\t(f) => f.size > (max_file_size ?? Infinity)\n\t);\n\tif (oversized_files.length) {\n\t\tthrow new Error(\n\t\t\t`File size exceeds the maximum allowed size of ${max_file_size} bytes: ${oversized_files\n\t\t\t\t.map((f) => f.name)\n\t\t\t\t.join(\", \")}`\n\t\t);\n\t}\n\n\treturn await Promise.all(\n\t\tawait this.upload_files(root_url, files, upload_id).then(\n\t\t\tasync (response: { files?: string[]; error?: string }) => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tthrow new Error(response.error);\n\t\t\t\t} else {\n\t\t\t\t\tif (response.files) {\n\t\t\t\t\t\treturn response.files.map((f, i) => {\n\t\t\t\t\t\t\tconst file = new FileData({\n\t\t\t\t\t\t\t\t...file_data[i],\n\t\t\t\t\t\t\t\tpath: f,\n\t\t\t\t\t\t\t\turl: `${root_url}${this.api_prefix}/file=${f}`\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn file;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t);\n}\n\nexport async function prepare_files(\n\tfiles: File[],\n\tis_stream?: boolean\n): Promise<FileData[]> {\n\treturn files.map(\n\t\t(f) =>\n\t\t\tnew FileData({\n\t\t\t\tpath: f.name,\n\t\t\t\torig_name: f.name,\n\t\t\t\tblob: f,\n\t\t\t\tsize: f.size,\n\t\t\t\tmime_type: f.type,\n\t\t\t\tis_stream\n\t\t\t})\n\t);\n}\n\nexport class FileData {\n\tpath: string;\n\turl?: string;\n\torig_name?: string;\n\tsize?: number;\n\tblob?: File;\n\tis_stream?: boolean;\n\tmime_type?: string;\n\talt_text?: string;\n\tb64?: string;\n\treadonly meta = { _type: \"gradio.FileData\" };\n\n\tconstructor({\n\t\tpath,\n\t\turl,\n\t\torig_name,\n\t\tsize,\n\t\tblob,\n\t\tis_stream,\n\t\tmime_type,\n\t\talt_text,\n\t\tb64\n\t}: {\n\t\tpath: string;\n\t\turl?: string;\n\t\torig_name?: string;\n\t\tsize?: number;\n\t\tblob?: File;\n\t\tis_stream?: boolean;\n\t\tmime_type?: string;\n\t\talt_text?: string;\n\t\tb64?: string;\n\t}) {\n\t\tthis.path = path;\n\t\tthis.url = url;\n\t\tthis.orig_name = orig_name;\n\t\tthis.size = size;\n\t\tthis.blob = url ? undefined : blob;\n\t\tthis.is_stream = is_stream;\n\t\tthis.mime_type = mime_type;\n\t\tthis.alt_text = alt_text;\n\t\tthis.b64 = b64;\n\t}\n}\n","// API Data Types\n\nimport { hardware_types } from \"./helpers/spaces\";\nimport type { SvelteComponent } from \"svelte\";\nimport type { ComponentType } from \"svelte\";\n\nexport interface ApiData {\n\tlabel: string;\n\tparameter_name: string;\n\tparameter_default?: any;\n\tparameter_has_default?: boolean;\n\ttype: {\n\t\ttype: any;\n\t\tdescription: string;\n\t};\n\tcomponent: string;\n\texample_input?: any;\n\tpython_type: { type: string; description: string };\n\tserializer: string;\n}\n\nexport interface JsApiData {\n\tlabel: string;\n\tparameter_name: string;\n\tparameter_default?: any;\n\tparameter_has_default?: boolean;\n\ttype: string;\n\tdescription: string;\n\tcomponent: string;\n\texample_input?: any;\n\tserializer: string;\n\tpython_type: { type: string; description: string };\n}\n\nexport interface EndpointInfo<T extends ApiData | JsApiData> {\n\tparameters: T[];\n\treturns: T[];\n\ttype?: DependencyTypes;\n}\n\nexport interface ApiInfo<T extends ApiData | JsApiData> {\n\tnamed_endpoints: Record<string, EndpointInfo<T>>;\n\tunnamed_endpoints: Record<string, EndpointInfo<T>>;\n}\n\nexport interface BlobRef {\n\tpath: string[];\n\ttype: string | undefined;\n\tblob: Blob | File | false;\n}\n\nexport type DataType = string | Buffer | Record<string, any> | any[];\n\n// custom class used for uploading local files\nexport class Command {\n\ttype: string;\n\tcommand: string;\n\tmeta: {\n\t\tpath: string;\n\t\tname: string;\n\t\torig_path: string;\n\t};\n\tfileData?: FileData;\n\n\tconstructor(\n\t\tcommand: string,\n\t\tmeta: { path: string; name: string; orig_path: string }\n\t) {\n\t\tthis.type = \"command\";\n\t\tthis.command = command;\n\t\tthis.meta = meta;\n\t}\n}\n\n// Function Signature Types\n\nexport type SubmitFunction = (\n\tendpoint: string | number,\n\tdata?: unknown[] | Record<string, unknown>,\n\tevent_data?: unknown,\n\ttrigger_id?: number | null\n) => SubmitIterable<GradioEvent>;\n\nexport type PredictFunction = (\n\tendpoint: string | number,\n\tdata?: unknown[] | Record<string, unknown>,\n\tevent_data?: unknown\n) => Promise<PredictReturn>;\n\nexport type client_return = {\n\tconfig: Config | undefined;\n\tpredict: PredictFunction;\n\tsubmit: SubmitFunction;\n\tcomponent_server: (\n\t\tcomponent_id: number,\n\t\tfn_name: string,\n\t\tdata: unknown[]\n\t) => any;\n\tview_api: (_fetch: typeof fetch) => Promise<ApiInfo<JsApiData>>;\n};\n\nexport interface SubmitIterable<T> extends AsyncIterable<T> {\n\t[Symbol.asyncIterator](): AsyncIterator<T>;\n\tcancel: () => Promise<void>;\n\tevent_id: () => string;\n}\n\nexport type PredictReturn = {\n\ttype: EventType;\n\ttime: Date;\n\tdata: unknown;\n\tendpoint: string;\n\tfn_index: number;\n};\n\n// Space Status Types\n\nexport type SpaceStatus = SpaceStatusNormal | SpaceStatusError;\n\nexport interface SpaceStatusNormal {\n\tstatus:\n\t\t| \"sleeping\"\n\t\t| \"running\"\n\t\t| \"building\"\n\t\t| \"error\"\n\t\t| \"stopped\"\n\t\t| \"starting\";\n\tdetail:\n\t\t| \"SLEEPING\"\n\t\t| \"RUNNING\"\n\t\t| \"RUNNING_BUILDING\"\n\t\t| \"BUILDING\"\n\t\t| \"APP_STARTING\"\n\t\t| \"NOT_FOUND\";\n\tload_status: \"pending\" | \"error\" | \"complete\" | \"generating\";\n\tmessage: string;\n}\n\nexport interface SpaceStatusError {\n\tstatus: \"space_error\" | \"paused\";\n\tdetail:\n\t\t| \"NO_APP_FILE\"\n\t\t| \"CONFIG_ERROR\"\n\t\t| \"BUILD_ERROR\"\n\t\t| \"RUNTIME_ERROR\"\n\t\t| \"PAUSED\";\n\tload_status: \"error\";\n\tmessage: string;\n\tdiscussions_enabled: boolean;\n}\n\nexport type SpaceStatusCallback = (a: SpaceStatus) => void;\n\n// Configuration and Response Types\n// --------------------------------\nexport interface Config {\n\tdeep_link_state?: \"none\" | \"valid\" | \"invalid\";\n\tauth_required?: true;\n\tapp_id?: string;\n\tanalytics_enabled: boolean;\n\tconnect_heartbeat: boolean;\n\tdev_mode: boolean;\n\tvibe_mode: boolean;\n\tauth_message: string;\n\tcomponents: ComponentMeta[];\n\tcss: string | null;\n\tjs: string | null;\n\thead: string | null;\n\tdependencies: Dependency[];\n\tenable_queue: boolean;\n\tshow_error: boolean;\n\tlayout: any;\n\tmode: \"blocks\" | \"interface\";\n\troot: string;\n\troot_url?: string;\n\ttheme: string;\n\ttitle: string;\n\tversion: string;\n\tspace_id: string | null;\n\tis_space: boolean;\n\tis_colab: boolean;\n\tshow_api: boolean;\n\tstylesheets: string[];\n\tcurrent_page: string;\n\tpage: Record<\n\t\tstring,\n\t\t{\n\t\t\tcomponents: number[];\n\t\t\tdependencies: number[];\n\t\t\tlayout: any;\n\t\t}\n\t>;\n\tpages: [string, string, boolean][];\n\tprotocol: \"sse_v3\" | \"sse_v2.1\" | \"sse_v2\" | \"sse_v1\" | \"sse\" | \"ws\";\n\tmax_file_size?: number;\n\ttheme_hash?: number;\n\tusername: string | null;\n\tapi_prefix?: string;\n\tfill_height?: boolean;\n\tfill_width?: boolean;\n\tpwa?: boolean;\n\ti18n_translations?: Record<string, Record<string, string>> | null;\n\tmcp_server?: boolean;\n}\n\n// todo: DRY up types\nexport interface ComponentMeta {\n\ttype: string;\n\tid: number;\n\thas_modes: boolean;\n\tprops: SharedProps;\n\tinstance: SvelteComponent;\n\tcomponent: ComponentType<SvelteComponent>;\n\tdocumentation?: Documentation;\n\tchildren?: ComponentMeta[];\n\tparent?: ComponentMeta;\n\tvalue?: any;\n\tcomponent_class_id: string;\n\tkey: string | number | null;\n\trendered_in?: number;\n}\n\ninterface SharedProps {\n\telem_id?: string;\n\telem_classes?: string[];\n\tcomponents?: string[];\n\tserver_fns?: string[];\n\tinteractive: boolean;\n\tvisible: boolean | \"hidden\";\n\t[key: string]: unknown;\n\troot_url?: string;\n}\n\nexport interface Documentation {\n\ttype?: TypeDescription;\n\tdescription?: TypeDescription;\n\texample_data?: string;\n}\n\ninterface TypeDescription {\n\tinput_payload?: string;\n\tresponse_object?: string;\n\tpayload?: string;\n}\n\nexport interface Dependency {\n\tid: number;\n\ttargets: [number, string][];\n\tinputs: number[];\n\toutputs: number[];\n\tbackend_fn: boolean;\n\tjs: string | null;\n\tscroll_to_output: boolean;\n\ttrigger: \"click\" | \"load\" | string;\n\tmax_batch_size: number;\n\tshow_progress: \"full\" | \"minimal\" | \"hidden\";\n\tshow_progress_on: number[] | null;\n\tfrontend_fn: ((...args: unknown[]) => Promise<unknown[]>) | null;\n\tstatus?: string;\n\tqueue: boolean | null;\n\tevery: number | null;\n\tbatch: boolean;\n\tapi_name: string | null;\n\tcancels: number[];\n\ttypes: DependencyTypes;\n\tcollects_event_data: boolean;\n\tpending_request?: boolean;\n\ttrigger_after?: number;\n\ttrigger_only_on_success?: boolean;\n\ttrigger_only_on_failure?: boolean;\n\ttrigger_mode: \"once\" | \"multiple\" | \"always_last\";\n\tfinal_event: Payload | null;\n\tshow_api: boolean;\n\trendered_in: number | null;\n\trender_id: number | null;\n\tconnection: \"stream\" | \"sse\";\n\ttime_limit: number;\n\tstream_every: number;\n\tlike_user_message: boolean;\n\tevent_specific_args: string[];\n\tjs_implementation: string | null;\n}\n\nexport interface DependencyTypes {\n\tgenerator: boolean;\n\tcancel: boolean;\n}\n\nexport interface Payload {\n\tfn_index: number;\n\tdata: unknown[];\n\ttime?: Date;\n\tevent_data?: unknown;\n\ttrigger_id?: number | null;\n}\n\nexport interface PostResponse {\n\terror?: string;\n\t[x: string]: any;\n}\n\nexport interface UploadResponse {\n\terror?: string;\n\tfiles?: string[];\n}\n\n// Client and File Handling Types\n\nexport interface DuplicateOptions extends ClientOptions {\n\tprivate?: boolean;\n\thardware?: (typeof hardware_types)[number];\n\ttimeout?: number;\n}\n\nexport interface ClientOptions {\n\thf_token?: `hf_${string}`;\n\tstatus_callback?: SpaceStatusCallback | null;\n\tauth?: [string, string] | null;\n\twith_null_state?: boolean;\n\tevents?: EventType[];\n\theaders?: Record<string, string>;\n\tquery_params?: Record<string, string>;\n\tsession_hash?: string;\n}\n\nexport interface FileData {\n\tname: string;\n\torig_name?: string;\n\tsize?: number;\n\tdata: string;\n\tblob?: File;\n\tis_file?: boolean;\n\tmime_type?: string;\n\talt_text?: string;\n}\n\n// Event and Listener Types\n\nexport type EventType = \"data\" | \"status\" | \"log\" | \"render\";\n\nexport interface EventMap {\n\tdata: PayloadMessage;\n\tstatus: StatusMessage;\n\tlog: LogMessage;\n\trender: RenderMessage;\n}\n\nexport type GradioEvent = {\n\t[P in EventType]: EventMap[P];\n}[EventType];\n\nexport interface Log {\n\tlog: string;\n\ttitle: string;\n\tlevel: \"warning\" | \"info\" | \"success\";\n}\nexport interface Render {\n\tdata: {\n\t\tcomponents: any[];\n\t\tlayout: any;\n\t\tdependencies: Dependency[];\n\t\trender_id: number;\n\t};\n}\n\nexport interface ValidationError {\n\tis_valid: boolean;\n\tmessage: string;\n}\n\nexport interface Status {\n\tqueue: boolean;\n\tcode?: string;\n\tsuccess?: boolean;\n\tstage: \"pending\" | \"error\" | \"complete\" | \"generating\" | \"streaming\";\n\tduration?: number;\n\tvisible?: boolean;\n\tbroken?: boolean;\n\tsize?: number;\n\tposition?: number;\n\teta?: number;\n\ttitle?: string;\n\tmessage?: string | ValidationError[];\n\tprogress_data?: {\n\t\tprogress: number | null;\n\t\tindex: number | null;\n\t\tlength: number | null;\n\t\tunit: string | null;\n\t\tdesc: string | null;\n\t}[];\n\ttime?: Date;\n\tchanged_state_ids?: number[];\n\ttime_limit?: number;\n\tsession_not_found?: boolean;\n}\n\nexport interface StatusMessage extends Status {\n\ttype: \"status\";\n\tendpoint: string;\n\tfn_index: number;\n\toriginal_msg?: string;\n}\n\nexport interface PayloadMessage extends Payload {\n\ttype: \"data\";\n\tendpoint: string;\n\tfn_index: number;\n}\n\nexport interface LogMessage extends Log {\n\ttype: \"log\";\n\tendpoint: string;\n\tfn_index: number;\n\tduration: number | null;\n\tvisible: boolean;\n}\n\nexport interface RenderMessage extends Render {\n\ttype: \"render\";\n\tendpoint: string;\n\tfn_index: number;\n}\n","import {\n\ttype ApiData,\n\ttype BlobRef,\n\ttype Config,\n\ttype EndpointInfo,\n\ttype JsApiData,\n\ttype DataType,\n\tCommand,\n\ttype Dependency,\n\ttype ComponentMeta\n} from \"../types\";\nimport { FileData } from \"../upload\";\n\nconst is_node =\n\ttypeof process !== \"undefined\" && process.versions && process.versions.node;\n\nexport function update_object(\n\tobject: { [x: string]: any },\n\tnewValue: any,\n\tstack: (string | number)[]\n): void {\n\twhile (stack.length > 1) {\n\t\tconst key = stack.shift();\n\t\tif (typeof key === \"string\" || typeof key === \"number\") {\n\t\t\tobject = object[key];\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid key type\");\n\t\t}\n\t}\n\n\tconst key = stack.shift();\n\tif (typeof key === \"string\" || typeof key === \"number\") {\n\t\tobject[key] = newValue;\n\t} else {\n\t\tthrow new Error(\"Invalid key type\");\n\t}\n}\n\nexport async function walk_and_store_blobs(\n\tdata: DataType,\n\ttype: string | undefined = undefined,\n\tpath: string[] = [],\n\troot = false,\n\tendpoint_info: EndpointInfo<ApiData | JsApiData> | undefined = undefined\n): Promise<BlobRef[]> {\n\tif (Array.isArray(data)) {\n\t\tlet blob_refs: BlobRef[] = [];\n\n\t\tawait Promise.all(\n\t\t\tdata.map(async (_, index) => {\n\t\t\t\tlet new_path = path.slice();\n\t\t\t\tnew_path.push(String(index));\n\n\t\t\t\tconst array_refs = await walk_and_store_blobs(\n\t\t\t\t\tdata[index],\n\t\t\t\t\troot\n\t\t\t\t\t\t? endpoint_info?.parameters[index]?.component || undefined\n\t\t\t\t\t\t: type,\n\t\t\t\t\tnew_path,\n\t\t\t\t\tfalse,\n\t\t\t\t\tendpoint_info\n\t\t\t\t);\n\n\t\t\t\tblob_refs = blob_refs.concat(array_refs);\n\t\t\t})\n\t\t);\n\n\t\treturn blob_refs;\n\t} else if (\n\t\t(globalThis.Buffer && data instanceof globalThis.Buffer) ||\n\t\tdata instanceof Blob\n\t) {\n\t\treturn [\n\t\t\t{\n\t\t\t\tpath: path,\n\t\t\t\tblob: new Blob([data]),\n\t\t\t\ttype\n\t\t\t}\n\t\t];\n\t} else if (typeof data === \"object\" && data !== null) {\n\t\tlet blob_refs: BlobRef[] = [];\n\t\tfor (const key of Object.keys(data) as (keyof typeof data)[]) {\n\t\t\tconst new_path = [...path, key];\n\t\t\tconst value = data[key];\n\n\t\t\tblob_refs = blob_refs.concat(\n\t\t\t\tawait walk_and_store_blobs(\n\t\t\t\t\tvalue,\n\t\t\t\t\tundefined,\n\t\t\t\t\tnew_path,\n\t\t\t\t\tfalse,\n\t\t\t\t\tendpoint_info\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\n\t\treturn blob_refs;\n\t}\n\n\treturn [];\n}\n\nexport function skip_queue(id: number, config: Config): boolean {\n\tlet fn_queue = config?.dependencies?.find((dep) => dep.id == id)?.queue;\n\tif (fn_queue != null) {\n\t\treturn !fn_queue;\n\t}\n\treturn !config.enable_queue;\n}\n\n// todo: add jsdoc for this function\n\nexport function post_message<Res = any>(\n\tmessage: any,\n\torigin: string\n): Promise<Res> {\n\treturn new Promise((res, _rej) => {\n\t\tconst channel = new MessageChannel();\n\t\tchannel.port1.onmessage = (({ data }) => {\n\t\t\tchannel.port1.close();\n\t\t\tres(data);\n\t\t}) as (ev: MessageEvent<Res>) => void;\n\t\twindow.parent.postMessage(message, origin, [channel.port2]);\n\t});\n}\n\nexport function handle_file(\n\tfile_or_url: File | string | Blob | Buffer\n): FileData | Blob | Command {\n\tif (typeof file_or_url === \"string\") {\n\t\tif (\n\t\t\tfile_or_url.startsWith(\"http://\") ||\n\t\t\tfile_or_url.startsWith(\"https://\")\n\t\t) {\n\t\t\treturn {\n\t\t\t\tpath: file_or_url,\n\t\t\t\turl: file_or_url,\n\t\t\t\torig_name: file_or_url.split(\"/\").pop() ?? \"unknown\",\n\t\t\t\tmeta: { _type: \"gradio.FileData\" }\n\t\t\t};\n\t\t}\n\n\t\tif (is_node) {\n\t\t\t// Handle local file paths\n\t\t\treturn new Command(\"upload_file\", {\n\t\t\t\tpath: file_or_url,\n\t\t\t\tname: file_or_url,\n\t\t\t\torig_path: file_or_url\n\t\t\t});\n\t\t}\n\t} else if (typeof File !== \"undefined\" && file_or_url instanceof File) {\n\t\treturn new Blob([file_or_url]);\n\t} else if (file_or_url instanceof Buffer) {\n\t\treturn new Blob([file_or_url]);\n\t} else if (file_or_url instanceof Blob) {\n\t\treturn file_or_url;\n\t}\n\tthrow new Error(\n\t\t\"Invalid input: must be a URL, File, Blob, or Buffer object.\"\n\t);\n}\n\n/**\n * Handles the payload by filtering out state inputs and returning an array of resolved payload values.\n * We send null values for state inputs to the server, but we don't want to include them in the resolved payload.\n *\n * @param resolved_payload - The resolved payload values received from the client or the server\n * @param dependency - The dependency object.\n * @param components - The array of component metadata.\n * @param with_null_state - Optional. Specifies whether to include null values for state inputs. Default is false.\n * @returns An array of resolved payload values, filtered based on the dependency and component metadata.\n */\nexport function handle_payload(\n\tresolved_payload: unknown[],\n\tdependency: Dependency,\n\tcomponents: ComponentMeta[],\n\ttype: \"input\" | \"output\",\n\twith_null_state = false\n): unknown[] {\n\tif (type === \"input\" && !with_null_state) {\n\t\tthrow new Error(\"Invalid code path. Cannot skip state inputs for input.\");\n\t}\n\t// data comes from the server with null state values so we skip\n\tif (type === \"output\" && with_null_state) {\n\t\treturn resolved_payload;\n\t}\n\n\tlet updated_payload: unknown[] = [];\n\tlet payload_index = 0;\n\tconst deps = type === \"input\" ? dependency.inputs : dependency.outputs;\n\tfor (let i = 0; i < deps.length; i++) {\n\t\tconst input_id = deps[i];\n\t\tconst component = components.find((c) => c.id === input_id);\n\n\t\tif (component?.type === \"state\") {\n\t\t\t// input + with_null_state needs us to fill state with null values\n\t\t\tif (with_null_state) {\n\t\t\t\tif (resolved_payload.length === deps.length) {\n\t\t\t\t\tconst value = resolved_payload[payload_index];\n\t\t\t\t\tupdated_payload.push(value);\n\t\t\t\t\tpayload_index++;\n\t\t\t\t} else {\n\t\t\t\t\tupdated_payload.push(null);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// this is output & !with_null_state, we skip state inputs\n\t\t\t\t// the server payload always comes with null state values so we move along the payload index\n\t\t\t\tpayload_index++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// input & !with_null_state isn't a case we care about, server needs null\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tconst value = resolved_payload[payload_index];\n\t\t\tupdated_payload.push(value);\n\t\t\tpayload_index++;\n\t\t}\n\t}\n\n\treturn updated_payload;\n}\n","import { update_object, walk_and_store_blobs } from \"../helpers/data\";\nimport {\n\tCommand,\n\ttype ApiData,\n\ttype EndpointInfo,\n\ttype JsApiData\n} from \"../types\";\nimport { FileData } from \"../upload\";\nimport type { Client } from \"..\";\nimport {\n\tFILE_PROCESSING_ERROR_MSG,\n\tNODEJS_FS_ERROR_MSG,\n\tROOT_URL_ERROR_MSG\n} from \"../constants\";\n\nexport async function handle_blob(\n\tthis: Client,\n\tendpoint: string,\n\tdata: unknown[],\n\tapi_info: EndpointInfo<JsApiData | ApiData>\n): Promise<unknown[]> {\n\tconst self = this;\n\n\tawait process_local_file_commands(self, data);\n\n\tconst blobRefs = await walk_and_store_blobs(\n\t\tdata,\n\t\tundefined,\n\t\t[],\n\t\ttrue,\n\t\tapi_info\n\t);\n\n\tconst results = await Promise.all(\n\t\tblobRefs.map(async ({ path, blob, type }) => {\n\t\t\tif (!blob) return { path, type };\n\n\t\t\tconst response = await self.upload_files(endpoint, [blob]);\n\t\t\tconst file_url = response.files && response.files[0];\n\t\t\treturn {\n\t\t\t\tpath,\n\t\t\t\tfile_url,\n\t\t\t\ttype,\n\t\t\t\tname:\n\t\t\t\t\ttypeof File !== \"undefined\" && blob instanceof File\n\t\t\t\t\t\t? blob?.name\n\t\t\t\t\t\t: undefined\n\t\t\t};\n\t\t})\n\t);\n\n\tresults.forEach(({ path, file_url, type, name }) => {\n\t\tif (type === \"Gallery\") {\n\t\t\tupdate_object(data, file_url, path);\n\t\t} else if (file_url) {\n\t\t\tconst file = new FileData({ path: file_url, orig_name: name });\n\t\t\tupdate_object(data, file, path);\n\t\t}\n\t});\n\n\treturn data;\n}\n\nexport async function process_local_file_commands(\n\tclient: Client,\n\tdata: unknown[]\n): Promise<void> {\n\tconst root = client.config?.root || client.config?.root_url;\n\n\tif (!root) {\n\t\tthrow new Error(ROOT_URL_ERROR_MSG);\n\t}\n\n\tawait recursively_process_commands(client, data);\n}\n\nasync function recursively_process_commands(\n\tclient: Client,\n\tdata: any,\n\tpath: string[] = []\n): Promise<void> {\n\tfor (const key in data) {\n\t\tif (data[key] instanceof Command) {\n\t\t\tawait process_single_command(client, data, key);\n\t\t} else if (typeof data[key] === \"object\" && data[key] !== null) {\n\t\t\tawait recursively_process_commands(client, data[key], [...path, key]);\n\t\t}\n\t}\n}\n\nasync function process_single_command(\n\tclient: Client,\n\tdata: any,\n\tkey: string\n): Promise<void> {\n\tlet cmd_item = data[key] as Command;\n\tconst root = client.config?.root || client.config?.root_url;\n\n\tif (!root) {\n\t\tthrow new Error(ROOT_URL_ERROR_MSG);\n\t}\n\n\ttry {\n\t\tlet fileBuffer: Buffer;\n\t\tlet fullPath: string;\n\n\t\t// check if running in a Node.js environment\n\t\tif (\n\t\t\ttypeof process !== \"undefined\" &&\n\t\t\tprocess.versions &&\n\t\t\tprocess.versions.node\n\t\t) {\n\t\t\tconst fs = await import(\"fs/promises\");\n\t\t\tconst path = await import(\"path\");\n\n\t\t\tfullPath = path.resolve(process.cwd(), cmd_item.meta.path);\n\t\t\tfileBuffer = await fs.readFile(fullPath); // Read file from disk\n\t\t} else {\n\t\t\tthrow new Error(NODEJS_FS_ERROR_MSG);\n\t\t}\n\n\t\tconst file = new Blob([fileBuffer], { type: \"application/octet-stream\" });\n\n\t\tconst response = await client.upload_files(root, [file]);\n\n\t\tconst file_url = response.files && response.files[0];\n\n\t\tif (file_url) {\n\t\t\tconst fileData = new FileData({\n\t\t\t\tpath: file_url,\n\t\t\t\torig_name: cmd_item.meta.name || \"\"\n\t\t\t});\n\n\t\t\t// replace the command object with the fileData object\n\t\t\tdata[key] = fileData;\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(FILE_PROCESSING_ERROR_MSG, error);\n\t}\n}\n","import { BROKEN_CONNECTION_MSG } from \"../constants\";\nimport type { PostResponse } from \"../types\";\nimport { Client } from \"..\";\n\nexport async function post_data(\n\tthis: Client,\n\turl: string,\n\tbody: unknown,\n\tadditional_headers?: any\n): Promise<[PostResponse, number]> {\n\tconst headers: {\n\t\tAuthorization?: string;\n\t\t\"Content-Type\": \"application/json\";\n\t} = { \"Content-Type\": \"application/json\" };\n\tif (this.options.hf_token) {\n\t\theaders.Authorization = `Bearer ${this.options.hf_token}`;\n\t}\n\ttry {\n\t\tvar response = await this.fetch(url, {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify(body),\n\t\t\theaders: { ...headers, ...additional_headers },\n\t\t\tcredentials: \"include\"\n\t\t});\n\t} catch (e) {\n\t\treturn [{ error: BROKEN_CONNECTION_MSG }, 500];\n\t}\n\tlet output: PostResponse;\n\tlet status: number;\n\ttry {\n\t\toutput = await response.json();\n\t\tstatus = response.status;\n\t} catch (e) {\n\t\toutput = { error: `Could not parse server response: ${e}` };\n\t\tstatus = 500;\n\t}\n\treturn [output, status];\n}\n","import { Client } from \"../client\";\nimport type { Dependency, PredictReturn } from \"../types\";\n\nexport async function predict(\n\tthis: Client,\n\tendpoint: string | number,\n\tdata: unknown[] | Record<string, unknown> = {}\n): Promise<PredictReturn> {\n\tlet data_returned = false;\n\tlet status_complete = false;\n\tlet dependency: Dependency;\n\n\tif (!this.config) {\n\t\tthrow new Error(\"Could not resolve app config\");\n\t}\n\n\tif (typeof endpoint === \"number\") {\n\t\tdependency = this.config.dependencies.find((dep) => dep.id == endpoint)!;\n\t} else {\n\t\tconst trimmed_endpoint = endpoint.replace(/^\\//, \"\");\n\t\tdependency = this.config.dependencies.find(\n\t\t\t(dep) => dep.id == this.api_map[trimmed_endpoint]\n\t\t)!;\n\t}\n\n\treturn new Promise(async (resolve, reject) => {\n\t\tconst app = this.submit(endpoint, data, null, null, true);\n\t\tlet result: unknown;\n\n\t\tfor await (const message of app) {\n\t\t\tif (message.type === \"data\") {\n\t\t\t\tif (status_complete) {\n\t\t\t\t\tresolve(result as PredictReturn);\n\t\t\t\t}\n\t\t\t\tdata_returned = true;\n\t\t\t\tresult = message;\n\t\t\t}\n\n\t\t\tif (message.type === \"status\") {\n\t\t\t\tif (message.stage === \"error\") reject(message);\n\t\t\t\tif (message.stage === \"complete\") {\n\t\t\t\t\tstatus_complete = true;\n\t\t\t\t\t// if complete message comes after data, resolve here\n\t\t\t\t\tif (data_returned) {\n\t\t\t\t\t\tresolve(result as PredictReturn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n","import {\n\tRUNTIME_URL,\n\tSLEEPTIME_URL,\n\tSPACE_STATUS_ERROR_MSG\n} from \"../constants\";\nimport { RE_SPACE_NAME } from \"./api_info\";\nimport type { SpaceStatusCallback } from \"../types\";\n\nexport async function check_space_status(\n\tid: string,\n\ttype: \"subdomain\" | \"space_name\",\n\tstatus_callback: SpaceStatusCallback\n): Promise<void> {\n\tlet endpoint =\n\t\ttype === \"subdomain\"\n\t\t\t? `https://huggingface.co/api/spaces/by-subdomain/${id}`\n\t\t\t: `https://huggingface.co/api/spaces/${id}`;\n\tlet response;\n\tlet _status;\n\ttry {\n\t\tresponse = await fetch(endpoint);\n\t\t_status = response.status;\n\t\tif (_status !== 200) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tresponse = await response.json();\n\t} catch (e) {\n\t\tstatus_callback({\n\t\t\tstatus: \"error\",\n\t\t\tload_status: \"error\",\n\t\t\tmessage: SPACE_STATUS_ERROR_MSG,\n\t\t\tdetail: \"NOT_FOUND\"\n\t\t});\n\t\treturn;\n\t}\n\n\tif (!response || _status !== 200) return;\n\tconst {\n\t\truntime: { stage },\n\t\tid: space_name\n\t} = response;\n\n\tswitch (stage) {\n\t\tcase \"STOPPED\":\n\t\tcase \"SLEEPING\":\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"sleeping\",\n\t\t\t\tload_status: \"pending\",\n\t\t\t\tmessage: \"Space is asleep. Waking it up...\",\n\t\t\t\tdetail: stage\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tcheck_space_status(id, type, status_callback);\n\t\t\t}, 1000); // poll for status\n\t\t\tbreak;\n\t\tcase \"PAUSED\":\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"paused\",\n\t\t\t\tload_status: \"error\",\n\t\t\t\tmessage:\n\t\t\t\t\t\"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.\",\n\t\t\t\tdetail: stage,\n\t\t\t\tdiscussions_enabled: await discussions_enabled(space_name)\n\t\t\t});\n\t\t\tbreak;\n\t\tcase \"RUNNING\":\n\t\tcase \"RUNNING_BUILDING\":\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"running\",\n\t\t\t\tload_status: \"complete\",\n\t\t\t\tmessage: \"Space is running.\",\n\t\t\t\tdetail: stage\n\t\t\t});\n\t\t\tbreak;\n\t\tcase \"BUILDING\":\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"building\",\n\t\t\t\tload_status: \"pending\",\n\t\t\t\tmessage: \"Space is building...\",\n\t\t\t\tdetail: stage\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tcheck_space_status(id, type, status_callback);\n\t\t\t}, 1000);\n\t\t\tbreak;\n\t\tcase \"APP_STARTING\":\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"starting\",\n\t\t\t\tload_status: \"pending\",\n\t\t\t\tmessage: \"Space is starting...\",\n\t\t\t\tdetail: stage\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tcheck_space_status(id, type, status_callback);\n\t\t\t}, 1000);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tstatus_callback({\n\t\t\t\tstatus: \"space_error\",\n\t\t\t\tload_status: \"error\",\n\t\t\t\tmessage: \"This space is experiencing an issue.\",\n\t\t\t\tdetail: stage,\n\t\t\t\tdiscussions_enabled: await discussions_enabled(space_name)\n\t\t\t});\n\t\t\tbreak;\n\t}\n}\n\nexport const check_and_wake_space = async (\n\tspace_id: string,\n\tstatus_callback: SpaceStatusCallback\n): Promise<void> => {\n\tlet retries = 0;\n\tconst max_retries = 12;\n\tconst check_interval = 5000;\n\n\treturn new Promise((resolve) => {\n\t\tcheck_space_status(\n\t\t\tspace_id,\n\t\t\tRE_SPACE_NAME.test(space_id) ? \"space_name\" : \"subdomain\",\n\t\t\t(status) => {\n\t\t\t\tstatus_callback(status);\n\n\t\t\t\tif (status.status === \"running\") {\n\t\t\t\t\tresolve();\n\t\t\t\t} else if (\n\t\t\t\t\tstatus.status === \"error\" ||\n\t\t\t\t\tstatus.status === \"paused\" ||\n\t\t\t\t\tstatus.status === \"space_error\"\n\t\t\t\t) {\n\t\t\t\t\tresolve();\n\t\t\t\t} else if (\n\t\t\t\t\tstatus.status === \"sleeping\" ||\n\t\t\t\t\tstatus.status === \"building\"\n\t\t\t\t) {\n\t\t\t\t\tif (retries < max_retries) {\n\t\t\t\t\t\tretries++;\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tcheck_and_wake_space(space_id, status_callback).then(resolve);\n\t\t\t\t\t\t}, check_interval);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t});\n};\n\nconst RE_DISABLED_DISCUSSION =\n\t/^(?=[^]*\\b[dD]iscussions{0,1}\\b)(?=[^]*\\b[dD]isabled\\b)[^]*$/;\nexport async function discussions_enabled(space_id: string): Promise<boolean> {\n\ttry {\n\t\tconst r = await fetch(\n\t\t\t`https://huggingface.co/api/spaces/${space_id}/discussions`,\n\t\t\t{\n\t\t\t\tmethod: \"HEAD\"\n\t\t\t}\n\t\t);\n\n\t\tconst error = r.headers.get(\"x-error-message\");\n\n\t\tif (!r.ok || (error && RE_DISABLED_DISCUSSION.test(error))) return false;\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nexport async function get_space_hardware(\n\tspace_id: string,\n\thf_token?: `hf_${string}` | undefined\n): Promise<(typeof hardware_types)[number]> {\n\tconst headers: { Authorization?: string } = {};\n\tif (hf_token) {\n\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t}\n\n\ttry {\n\t\tconst res = await fetch(\n\t\t\t`https://huggingface.co/api/spaces/${space_id}/${RUNTIME_URL}`,\n\t\t\t{ headers }\n\t\t);\n\n\t\tif (res.status !== 200)\n\t\t\tthrow new Error(\"Space hardware could not be obtained.\");\n\n\t\tconst { hardware } = await res.json();\n\n\t\treturn hardware.current;\n\t} catch (e: any) {\n\t\tthrow new Error(e.message);\n\t}\n}\n\nexport async function set_space_timeout(\n\tspace_id: string,\n\ttimeout: number,\n\thf_token?: `hf_${string}`\n): Promise<any> {\n\tconst headers: { Authorization?: string } = {};\n\tif (hf_token) {\n\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t}\n\n\tconst body: {\n\t\tseconds?: number;\n\t} = {\n\t\tseconds: timeout\n\t};\n\n\ttry {\n\t\tconst res = await fetch(\n\t\t\t`https://huggingface.co/api/spaces/${space_id}/${SLEEPTIME_URL}`,\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { \"Content-Type\": \"application/json\", ...headers },\n\t\t\t\tbody: JSON.stringify(body)\n\t\t\t}\n\t\t);\n\n\t\tif (res.status !== 200) {\n\t\t\tthrow new Error(\n\t\t\t\t\"Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.\"\n\t\t\t);\n\t\t}\n\n\t\tconst response = await res.json();\n\t\treturn response;\n\t} catch (e: any) {\n\t\tthrow new Error(e.message);\n\t}\n}\n\nexport const hardware_types = [\n\t\"cpu-basic\",\n\t\"cpu-upgrade\",\n\t\"cpu-xl\",\n\t\"t4-small\",\n\t\"t4-medium\",\n\t\"a10g-small\",\n\t\"a10g-large\",\n\t\"a10g-largex2\",\n\t\"a10g-largex4\",\n\t\"a100-large\",\n\t\"zero-a10g\",\n\t\"h100\",\n\t\"h100x8\"\n] as const;\n","import {\n\tget_space_hardware,\n\thardware_types,\n\tset_space_timeout\n} from \"../helpers/spaces\";\nimport type { DuplicateOptions } from \"../types\";\nimport { Client } from \"../client\";\nimport { SPACE_METADATA_ERROR_MSG } from \"../constants\";\nimport {\n\tget_cookie_header,\n\tparse_and_set_cookies\n} from \"../helpers/init_helpers\";\nimport { process_endpoint } from \"../helpers/api_info\";\n\nexport async function duplicate(\n\tapp_reference: string,\n\toptions: DuplicateOptions\n): Promise<Client> {\n\tconst { hf_token, private: _private, hardware, timeout, auth } = options;\n\n\tif (hardware && !hardware_types.includes(hardware)) {\n\t\tthrow new Error(\n\t\t\t`Invalid hardware type provided. Valid types are: ${hardware_types\n\t\t\t\t.map((v) => `\"${v}\"`)\n\t\t\t\t.join(\",\")}.`\n\t\t);\n\t}\n\n\tconst { http_protocol, host } = await process_endpoint(\n\t\tapp_reference,\n\t\thf_token\n\t);\n\n\tlet cookies: string[] | null = null;\n\n\tif (auth) {\n\t\tconst cookie_header = await get_cookie_header(\n\t\t\thttp_protocol,\n\t\t\thost,\n\t\t\tauth,\n\t\t\tfetch\n\t\t);\n\n\t\tif (cookie_header) cookies = parse_and_set_cookies(cookie_header);\n\t}\n\n\tconst headers = {\n\t\tAuthorization: `Bearer ${hf_token}`,\n\t\t\"Content-Type\": \"application/json\",\n\t\t...(cookies ? { Cookie: cookies.join(\"; \") } : {})\n\t};\n\n\tconst user = (\n\t\tawait (\n\t\t\tawait fetch(`https://huggingface.co/api/whoami-v2`, {\n\t\t\t\theaders\n\t\t\t})\n\t\t).json()\n\t).name;\n\n\tconst space_name = app_reference.split(\"/\")[1];\n\tconst body: {\n\t\trepository: string;\n\t\tprivate?: boolean;\n\t\thardware?: string;\n\t} = {\n\t\trepository: `${user}/${space_name}`\n\t};\n\n\tif (_private) {\n\t\tbody.private = true;\n\t}\n\n\tlet original_hardware;\n\n\ttry {\n\t\tif (!hardware) {\n\t\t\toriginal_hardware = await get_space_hardware(app_reference, hf_token);\n\t\t}\n\t} catch (e) {\n\t\tthrow Error(SPACE_METADATA_ERROR_MSG + (e as Error).message);\n\t}\n\n\tconst requested_hardware = hardware || original_hardware || \"cpu-basic\";\n\n\tbody.hardware = requested_hardware;\n\n\ttry {\n\t\tconst response = await fetch(\n\t\t\t`https://huggingface.co/api/spaces/${app_reference}/duplicate`,\n\t\t\t{\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders,\n\t\t\t\tbody: JSON.stringify(body)\n\t\t\t}\n\t\t);\n\n\t\tif (response.status === 409) {\n\t\t\ttry {\n\t\t\t\tconst client = await Client.connect(`${user}/${space_name}`, options);\n\t\t\t\treturn client;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to connect Client instance:\", error);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t} else if (response.status !== 200) {\n\t\t\tthrow new Error(response.statusText);\n\t\t}\n\n\t\tconst duplicated_space = await response.json();\n\n\t\tawait set_space_timeout(`${user}/${space_name}`, timeout || 300, hf_token);\n\n\t\treturn await Client.connect(\n\t\t\tget_space_reference(duplicated_space.url),\n\t\t\toptions\n\t\t);\n\t} catch (e: any) {\n\t\tthrow new Error(e);\n\t}\n}\n\nfunction get_space_reference(url: string): any {\n\tconst regex = /https:\\/\\/huggingface.co\\/spaces\\/([^/]+\\/[^/]+)/;\n\tconst match = url.match(regex);\n\tif (match) {\n\t\treturn match[1];\n\t}\n}\n","// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.\n// This module is browser compatible.\n/**\n * Transform a stream into a stream where each chunk is divided by a newline,\n * be it `\\n` or `\\r\\n`. `\\r` can be enabled via the `allowCR` option.\n *\n * @example\n * ```ts\n * import { TextLineStream } from \"@std/streams/text-line-stream\";\n *\n * const res = await fetch(\"https://example.com\");\n * const lines = res.body!\n *   .pipeThrough(new TextDecoderStream())\n *   .pipeThrough(new TextLineStream());\n * ```\n */\nexport class TextLineStream extends TransformStream {\n    #currentLine = \"\";\n    /** Constructs a new instance. */\n    constructor(options = { allowCR: false }) {\n        super({\n            transform: (chars, controller) => {\n                chars = this.#currentLine + chars;\n                while (true) {\n                    const lfIndex = chars.indexOf(\"\\n\");\n                    const crIndex = options.allowCR ? chars.indexOf(\"\\r\") : -1;\n                    if (crIndex !== -1 && crIndex !== (chars.length - 1) &&\n                        (lfIndex === -1 || (lfIndex - 1) > crIndex)) {\n                        controller.enqueue(chars.slice(0, crIndex));\n                        chars = chars.slice(crIndex + 1);\n                        continue;\n                    }\n                    if (lfIndex === -1)\n                        break;\n                    const endIndex = chars[lfIndex - 1] === \"\\r\" ? lfIndex - 1 : lfIndex;\n                    controller.enqueue(chars.slice(0, endIndex));\n                    chars = chars.slice(lfIndex + 1);\n                }\n                this.#currentLine = chars;\n            },\n            flush: (controller) => {\n                if (this.#currentLine === \"\")\n                    return;\n                const currentLine = options.allowCR && this.#currentLine.endsWith(\"\\r\")\n                    ? this.#currentLine.slice(0, -1)\n                    : this.#currentLine;\n                controller.enqueue(currentLine);\n            },\n        });\n    }\n}\n","import { TextLineStream } from './deps/jsr.io/@std/streams/0.221.0/text_line_stream.js';\nexport function stream(input) {\n    let decoder = new TextDecoderStream();\n    let split = new TextLineStream({ allowCR: true });\n    return input.pipeThrough(decoder).pipeThrough(split);\n}\nexport function split(input) {\n    let rgx = /[:]\\s*/;\n    let match = rgx.exec(input);\n    // \": comment\" -> index=0 -> ignore\n    let idx = match && match.index;\n    if (idx) {\n        return [\n            input.substring(0, idx),\n            input.substring(idx + match[0].length),\n        ];\n    }\n}\nexport function fallback(headers, key, value) {\n    let tmp = headers.get(key);\n    if (!tmp)\n        headers.set(key, value);\n}\n","import * as utils from './utils.js';\n/**\n * Convert a `Response` body containing Server Sent Events (SSE) into an Async Iterator that yields {@linkcode ServerSentEventMessage} objects.\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events}\n *\n * @example\n * ```js\n * // Optional\n * let abort = new AbortController;\n *\n * // Manually fetch a Response\n * let res = await fetch('https://...', {\n *   method: 'POST',\n *   signal: abort.signal,\n *   headers: {\n *     'api-key': 'token <value>',\n *     'content-type': 'application/json',\n *   },\n *   body: JSON.stringify({\n *     stream: true, // <- hypothetical\n *     // ...\n *   })\n * });\n *\n * if (res.ok) {\n *   let stream = events(res, abort.signal);\n *   for await (let event of stream) {\n *     console.log('<<', event.data);\n *   }\n * }\n * ```\n */\nexport async function* events(res, signal) {\n    // TODO: throw error?\n    if (!res.body)\n        return;\n    let iter = utils.stream(res.body);\n    let line, reader = iter.getReader();\n    let event;\n    for (;;) {\n        if (signal && signal.aborted) {\n            return reader.cancel();\n        }\n        line = await reader.read();\n        if (line.done)\n            return;\n        if (!line.value) {\n            if (event)\n                yield event;\n            event = undefined;\n            continue;\n        }\n        let [field, value] = utils.split(line.value) || [];\n        if (!field)\n            continue; // comment or invalid\n        if (field === 'data') {\n            event ||= {};\n            event[field] = event[field] ? (event[field] + '\\n' + value) : value;\n        }\n        else if (field === 'event') {\n            event ||= {};\n            event[field] = value;\n        }\n        else if (field === 'id') {\n            event ||= {};\n            event[field] = +value || value;\n        }\n        else if (field === 'retry') {\n            event ||= {};\n            event[field] = +value || undefined;\n        }\n    }\n}\n/**\n * Convenience function that will `fetch` with the given arguments and, if ok, will return the {@linkcode events} async iterator.\n *\n * If the response is not ok (status 200-299), the `Response` is thrown.\n *\n * @example\n * ```js\n * // NOTE: throws `Response` if not 2xx status\n * let events = await stream('https://api.openai.com/...', {\n *   method: 'POST',\n *   headers: {\n *     'Authorization': 'Bearer <token>',\n *     'Content-Type': 'application/json',\n *   },\n *   body: JSON.stringify({\n *     stream: true,\n *     // ...\n *   })\n * });\n *\n * for await (let event of events) {\n *   console.log('<<', JSON.parse(event.data));\n * }\n * ```\n */\nexport async function stream(input, init) {\n    let req = new Request(input, init);\n    utils.fallback(req.headers, 'Accept', 'text/event-stream');\n    utils.fallback(req.headers, 'Content-Type', 'application/json');\n    let r = await fetch(req);\n    if (!r.ok)\n        throw r;\n    return events(r, req.signal);\n}\n","import { BROKEN_CONNECTION_MSG, SSE_URL } from \"../constants\";\nimport type { Client } from \"../client\";\nimport { stream } from \"fetch-event-stream\";\n\nexport async function open_stream(this: Client): Promise<void> {\n\tlet {\n\t\tevent_callbacks,\n\t\tunclosed_events,\n\t\tpending_stream_messages,\n\t\tstream_status,\n\t\tconfig,\n\t\tjwt\n\t} = this;\n\n\tconst that = this;\n\n\tif (!config) {\n\t\tthrow new Error(\"Could not resolve app config\");\n\t}\n\n\tstream_status.open = true;\n\n\tlet stream: EventSource | null = null;\n\tlet params = new URLSearchParams({\n\t\tsession_hash: this.session_hash\n\t}).toString();\n\n\tlet url = new URL(`${config.root}${this.api_prefix}/${SSE_URL}?${params}`);\n\n\tif (jwt) {\n\t\turl.searchParams.set(\"__sign\", jwt);\n\t}\n\n\tstream = this.stream(url);\n\n\tif (!stream) {\n\t\tconsole.warn(\"Cannot connect to SSE endpoint: \" + url.toString());\n\t\treturn;\n\t}\n\n\tstream.onmessage = async function (event: MessageEvent) {\n\t\tlet _data = JSON.parse(event.data);\n\t\tif (_data.msg === \"close_stream\") {\n\t\t\tclose_stream(stream_status, that.abort_controller);\n\t\t\treturn;\n\t\t}\n\t\tconst event_id = _data.event_id;\n\t\tif (!event_id) {\n\t\t\tawait Promise.all(\n\t\t\t\tObject.keys(event_callbacks).map((event_id) =>\n\t\t\t\t\tevent_callbacks[event_id](_data)\n\t\t\t\t)\n\t\t\t);\n\t\t} else if (event_callbacks[event_id] && config) {\n\t\t\tif (\n\t\t\t\t_data.msg === \"process_completed\" &&\n\t\t\t\t[\"sse\", \"sse_v1\", \"sse_v2\", \"sse_v2.1\", \"sse_v3\"].includes(\n\t\t\t\t\tconfig.protocol\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tunclosed_events.delete(event_id);\n\t\t\t}\n\t\t\tlet fn: (data: any) => void = event_callbacks[event_id];\n\n\t\t\tif (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\n\t\t\t\t// fn(_data); // need to do this to put the event on the end of the event loop, so the browser can refresh between callbacks and not freeze in case of quick generations. See\n\t\t\t\tsetTimeout(fn, 0, _data); // need to do this to put the event on the end of the event loop, so the browser can refresh between callbacks and not freeze in case of quick generations. See https://github.com/gradio-app/gradio/pull/7055\n\t\t\t} else {\n\t\t\t\tfn(_data);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!pending_stream_messages[event_id]) {\n\t\t\t\tpending_stream_messages[event_id] = [];\n\t\t\t}\n\t\t\tpending_stream_messages[event_id].push(_data);\n\t\t}\n\t};\n\tstream.onerror = async function (e) {\n\t\tconsole.error(e);\n\t\tawait Promise.all(\n\t\t\tObject.keys(event_callbacks).map((event_id) =>\n\t\t\t\tevent_callbacks[event_id]({\n\t\t\t\t\tmsg: \"broken_connection\",\n\t\t\t\t\tmessage: BROKEN_CONNECTION_MSG\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t};\n}\n\nexport function close_stream(\n\tstream_status: { open: boolean },\n\tabort_controller: AbortController | null\n): void {\n\tif (stream_status) {\n\t\tstream_status.open = false;\n\t\tabort_controller?.abort();\n\t}\n}\n\nexport function apply_diff_stream(\n\tpending_diff_streams: Record<string, any[][]>,\n\tevent_id: string,\n\tdata: any\n): void {\n\tlet is_first_generation = !pending_diff_streams[event_id];\n\tif (is_first_generation) {\n\t\tpending_diff_streams[event_id] = [];\n\t\tdata.data.forEach((value: any, i: number) => {\n\t\t\tpending_diff_streams[event_id][i] = value;\n\t\t});\n\t} else {\n\t\tdata.data.forEach((value: any, i: number) => {\n\t\t\tlet new_data = apply_diff(pending_diff_streams[event_id][i], value);\n\t\t\tpending_diff_streams[event_id][i] = new_data;\n\t\t\tdata.data[i] = new_data;\n\t\t});\n\t}\n}\n\nexport function apply_diff(\n\tobj: any,\n\tdiff: [string, (number | string)[], any][]\n): any {\n\tdiff.forEach(([action, path, value]) => {\n\t\tobj = apply_edit(obj, path, action, value);\n\t});\n\n\treturn obj;\n}\n\nfunction apply_edit(\n\ttarget: any,\n\tpath: (number | string)[],\n\taction: string,\n\tvalue: any\n): any {\n\tif (path.length === 0) {\n\t\tif (action === \"replace\") {\n\t\t\treturn value;\n\t\t} else if (action === \"append\") {\n\t\t\treturn target + value;\n\t\t}\n\t\tthrow new Error(`Unsupported action: ${action}`);\n\t}\n\n\tlet current = target;\n\tfor (let i = 0; i < path.length - 1; i++) {\n\t\tcurrent = current[path[i]];\n\t}\n\n\tconst last_path = path[path.length - 1];\n\tswitch (action) {\n\t\tcase \"replace\":\n\t\t\tcurrent[last_path] = value;\n\t\t\tbreak;\n\t\tcase \"append\":\n\t\t\tcurrent[last_path] += value;\n\t\t\tbreak;\n\t\tcase \"add\":\n\t\t\tif (Array.isArray(current)) {\n\t\t\t\tcurrent.splice(Number(last_path), 0, value);\n\t\t\t} else {\n\t\t\t\tcurrent[last_path] = value;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"delete\":\n\t\t\tif (Array.isArray(current)) {\n\t\t\t\tcurrent.splice(Number(last_path), 1);\n\t\t\t} else {\n\t\t\t\tdelete current[last_path];\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error(`Unknown action: ${action}`);\n\t}\n\treturn target;\n}\n\nexport function readable_stream(\n\tinput: RequestInfo | URL,\n\tinit: RequestInit = {}\n): EventSource {\n\tconst instance: EventSource & { readyState: number } = {\n\t\tclose: () => {\n\t\t\tconsole.warn(\"Method not implemented.\");\n\t\t},\n\t\tonerror: null,\n\t\tonmessage: null,\n\t\tonopen: null,\n\t\treadyState: 0,\n\t\turl: input.toString(),\n\t\twithCredentials: false,\n\t\tCONNECTING: 0,\n\t\tOPEN: 1,\n\t\tCLOSED: 2,\n\t\taddEventListener: () => {\n\t\t\tthrow new Error(\"Method not implemented.\");\n\t\t},\n\t\tdispatchEvent: () => {\n\t\t\tthrow new Error(\"Method not implemented.\");\n\t\t},\n\t\tremoveEventListener: () => {\n\t\t\tthrow new Error(\"Method not implemented.\");\n\t\t}\n\t};\n\n\tstream(input, init)\n\t\t.then(async (res) => {\n\t\t\tinstance.readyState = instance.OPEN;\n\t\t\ttry {\n\t\t\t\tfor await (const chunk of res) {\n\t\t\t\t\t//@ts-ignore\n\t\t\t\t\tinstance.onmessage && instance.onmessage(chunk);\n\t\t\t\t}\n\t\t\t\tinstance.readyState = instance.CLOSED;\n\t\t\t} catch (e) {\n\t\t\t\tinstance.onerror && instance.onerror(e as Event);\n\t\t\t\tinstance.readyState = instance.CLOSED;\n\t\t\t}\n\t\t})\n\t\t.catch((e) => {\n\t\t\tconsole.error(e);\n\t\t\tinstance.onerror && instance.onerror(e as Event);\n\t\t\tinstance.readyState = instance.CLOSED;\n\t\t});\n\n\treturn instance as EventSource;\n}\n","/* eslint-disable complexity */\nimport type {\n\tStatus,\n\tPayload,\n\tGradioEvent,\n\tJsApiData,\n\tEndpointInfo,\n\tApiInfo,\n\tConfig,\n\tDependency,\n\tSubmitIterable\n} from \"../types\";\n\nimport { skip_queue, post_message, handle_payload } from \"../helpers/data\";\nimport { resolve_root } from \"../helpers/init_helpers\";\nimport {\n\thandle_message,\n\tmap_data_to_params,\n\tprocess_endpoint\n} from \"../helpers/api_info\";\nimport semiver from \"semiver\";\nimport {\n\tBROKEN_CONNECTION_MSG,\n\tQUEUE_FULL_MSG,\n\tSSE_URL,\n\tSSE_DATA_URL,\n\tRESET_URL,\n\tCANCEL_URL\n} from \"../constants\";\nimport { apply_diff_stream, close_stream } from \"./stream\";\nimport { Client } from \"../client\";\n\nexport function submit(\n\tthis: Client,\n\tendpoint: string | number,\n\tdata: unknown[] | Record<string, unknown> = {},\n\tevent_data?: unknown,\n\ttrigger_id?: number | null,\n\tall_events?: boolean\n): SubmitIterable<GradioEvent> {\n\ttry {\n\t\tconst { hf_token } = this.options;\n\t\tconst {\n\t\t\tfetch,\n\t\t\tapp_reference,\n\t\t\tconfig,\n\t\t\tsession_hash,\n\t\t\tapi_info,\n\t\t\tapi_map,\n\t\t\tstream_status,\n\t\t\tpending_stream_messages,\n\t\t\tpending_diff_streams,\n\t\t\tevent_callbacks,\n\t\t\tunclosed_events,\n\t\t\tpost_data,\n\t\t\toptions,\n\t\t\tapi_prefix\n\t\t} = this;\n\n\t\tconst that = this;\n\n\t\tif (!api_info) throw new Error(\"No API found\");\n\t\tif (!config) throw new Error(\"Could not resolve app config\");\n\n\t\tlet { fn_index, endpoint_info, dependency } = get_endpoint_info(\n\t\t\tapi_info,\n\t\t\tendpoint,\n\t\t\tapi_map,\n\t\t\tconfig\n\t\t);\n\n\t\tlet resolved_data = map_data_to_params(data, endpoint_info);\n\n\t\tlet websocket: WebSocket;\n\t\tlet stream: EventSource | null;\n\t\tlet protocol = config.protocol ?? \"ws\";\n\t\tlet event_id_final = \"\";\n\t\tlet event_id_cb: () => string = () => event_id_final;\n\n\t\tconst _endpoint = typeof endpoint === \"number\" ? \"/predict\" : endpoint;\n\t\tlet payload: Payload;\n\t\tlet event_id: string | null = null;\n\t\tlet complete: Status | undefined | false = false;\n\t\tlet last_status: Record<string, Status[\"stage\"]> = {};\n\t\tlet url_params =\n\t\t\ttypeof window !== \"undefined\" && typeof document !== \"undefined\"\n\t\t\t\t? new URLSearchParams(window.location.search).toString()\n\t\t\t\t: \"\";\n\n\t\tconst events_to_publish =\n\t\t\toptions?.events?.reduce(\n\t\t\t\t(acc, event) => {\n\t\t\t\t\tacc[event] = true;\n\t\t\t\t\treturn acc;\n\t\t\t\t},\n\t\t\t\t{} as Record<string, boolean>\n\t\t\t) || {};\n\n\t\t// event subscription methods\n\t\tfunction fire_event(event: GradioEvent): void {\n\t\t\tif (all_events || events_to_publish[event.type]) {\n\t\t\t\tpush_event(event);\n\t\t\t}\n\t\t}\n\n\t\tasync function cancel(): Promise<void> {\n\t\t\tlet reset_request = {};\n\t\t\tlet cancel_request = {};\n\t\t\tif (protocol === \"ws\") {\n\t\t\t\tif (websocket && websocket.readyState === 0) {\n\t\t\t\t\twebsocket.addEventListener(\"open\", () => {\n\t\t\t\t\t\twebsocket.close();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\twebsocket.close();\n\t\t\t\t}\n\t\t\t\treset_request = { fn_index, session_hash };\n\t\t\t} else {\n\t\t\t\treset_request = { event_id };\n\t\t\t\tcancel_request = { event_id, session_hash, fn_index };\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif (!config) {\n\t\t\t\t\tthrow new Error(\"Could not resolve app config\");\n\t\t\t\t}\n\n\t\t\t\tif (\"event_id\" in cancel_request) {\n\t\t\t\t\tawait fetch(`${config.root}${api_prefix}/${CANCEL_URL}`, {\n\t\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\tbody: JSON.stringify(cancel_request)\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tawait fetch(`${config.root}${api_prefix}/${RESET_URL}`, {\n\t\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: JSON.stringify(reset_request)\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t\"The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.\"\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst resolve_heartbeat = async (config: Config): Promise<void> => {\n\t\t\tawait this._resolve_heartbeat(config);\n\t\t};\n\n\t\tasync function handle_render_config(render_config: any): Promise<void> {\n\t\t\tif (!config) return;\n\t\t\tlet render_id: number = render_config.render_id;\n\t\t\tconfig.components = [\n\t\t\t\t...config.components.filter((c) => c.props.rendered_in !== render_id),\n\t\t\t\t...render_config.components\n\t\t\t];\n\t\t\tconfig.dependencies = [\n\t\t\t\t...config.dependencies.filter((d) => d.rendered_in !== render_id),\n\t\t\t\t...render_config.dependencies\n\t\t\t];\n\t\t\tconst any_state = config.components.some((c) => c.type === \"state\");\n\t\t\tconst any_unload = config.dependencies.some((d) =>\n\t\t\t\td.targets.some((t) => t[1] === \"unload\")\n\t\t\t);\n\t\t\tconfig.connect_heartbeat = any_state || any_unload;\n\t\t\tawait resolve_heartbeat(config);\n\t\t\tfire_event({\n\t\t\t\ttype: \"render\",\n\t\t\t\tdata: render_config,\n\t\t\t\tendpoint: _endpoint,\n\t\t\t\tfn_index\n\t\t\t});\n\t\t}\n\n\t\tthis.handle_blob(config.root, resolved_data, endpoint_info).then(\n\t\t\tasync (_payload) => {\n\t\t\t\tlet input_data = handle_payload(\n\t\t\t\t\t_payload,\n\t\t\t\t\tdependency,\n\t\t\t\t\tconfig.components,\n\t\t\t\t\t\"input\",\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t\tpayload = {\n\t\t\t\t\tdata: input_data || [],\n\t\t\t\t\tevent_data,\n\t\t\t\t\tfn_index,\n\t\t\t\t\ttrigger_id\n\t\t\t\t};\n\t\t\t\tif (skip_queue(fn_index, config)) {\n\t\t\t\t\tfire_event({\n\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\t\tqueue: false,\n\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t});\n\n\t\t\t\t\tpost_data(\n\t\t\t\t\t\t`${config.root}${api_prefix}/run${\n\t\t\t\t\t\t\t_endpoint.startsWith(\"/\") ? _endpoint : `/${_endpoint}`\n\t\t\t\t\t\t}${url_params ? \"?\" + url_params : \"\"}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...payload,\n\t\t\t\t\t\t\tsession_hash\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\t\t.then(([output, status_code]: any) => {\n\t\t\t\t\t\t\tconst data = output.data;\n\t\t\t\t\t\t\tif (status_code == 200) {\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"data\",\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\tdata: handle_payload(\n\t\t\t\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\t\t\t\tdependency,\n\t\t\t\t\t\t\t\t\t\tconfig.components,\n\t\t\t\t\t\t\t\t\t\t\"output\",\n\t\t\t\t\t\t\t\t\t\toptions.with_null_state\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\tevent_data,\n\t\t\t\t\t\t\t\t\ttrigger_id\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (output.render_config) {\n\t\t\t\t\t\t\t\t\thandle_render_config(output.render_config);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\tstage: \"complete\",\n\t\t\t\t\t\t\t\t\teta: output.average_duration,\n\t\t\t\t\t\t\t\t\tqueue: false,\n\t\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\tmessage: output.error,\n\t\t\t\t\t\t\t\t\tqueue: false,\n\t\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\tmessage: e.message,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\tqueue: false,\n\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t} else if (protocol == \"ws\") {\n\t\t\t\t\tconst { ws_protocol, host } = await process_endpoint(\n\t\t\t\t\t\tapp_reference,\n\t\t\t\t\t\thf_token\n\t\t\t\t\t);\n\n\t\t\t\t\tfire_event({\n\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t});\n\n\t\t\t\t\tlet url = new URL(\n\t\t\t\t\t\t`${ws_protocol}://${resolve_root(\n\t\t\t\t\t\t\thost,\n\t\t\t\t\t\t\tconfig.root as string,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t)}/queue/join${url_params ? \"?\" + url_params : \"\"}`\n\t\t\t\t\t);\n\n\t\t\t\t\tif (this.jwt) {\n\t\t\t\t\t\turl.searchParams.set(\"__sign\", this.jwt);\n\t\t\t\t\t}\n\n\t\t\t\t\twebsocket = new WebSocket(url);\n\n\t\t\t\t\twebsocket.onclose = (evt) => {\n\t\t\t\t\t\tif (!evt.wasClean) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\tbroken: true,\n\t\t\t\t\t\t\t\tmessage: BROKEN_CONNECTION_MSG,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\twebsocket.onmessage = function (event) {\n\t\t\t\t\t\tconst _data = JSON.parse(event.data);\n\t\t\t\t\t\tconst { type, status, data } = handle_message(\n\t\t\t\t\t\t\t_data,\n\t\t\t\t\t\t\tlast_status[fn_index]\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (type === \"update\" && status && !complete) {\n\t\t\t\t\t\t\t// call 'status' listeners\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t...status\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (status.stage === \"error\") {\n\t\t\t\t\t\t\t\twebsocket.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (type === \"hash\") {\n\t\t\t\t\t\t\twebsocket.send(JSON.stringify({ fn_index, session_hash }));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else if (type === \"data\") {\n\t\t\t\t\t\t\twebsocket.send(JSON.stringify({ ...payload, session_hash }));\n\t\t\t\t\t\t} else if (type === \"complete\") {\n\t\t\t\t\t\t\tcomplete = status;\n\t\t\t\t\t\t} else if (type === \"log\") {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"log\",\n\t\t\t\t\t\t\t\ttitle: data.title,\n\t\t\t\t\t\t\t\tlog: data.log,\n\t\t\t\t\t\t\t\tlevel: data.level,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tduration: data.duration,\n\t\t\t\t\t\t\t\tvisible: data.visible,\n\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (type === \"generating\") {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t...status,\n\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"data\",\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\tdata: handle_payload(\n\t\t\t\t\t\t\t\t\tdata.data,\n\t\t\t\t\t\t\t\t\tdependency,\n\t\t\t\t\t\t\t\t\tconfig.components,\n\t\t\t\t\t\t\t\t\t\"output\",\n\t\t\t\t\t\t\t\t\toptions.with_null_state\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\tevent_data,\n\t\t\t\t\t\t\t\ttrigger_id\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (complete) {\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t...complete,\n\t\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\twebsocket.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\t// different ws contract for gradio versions older than 3.6.0\n\t\t\t\t\t//@ts-ignore\n\t\t\t\t\tif (semiver(config.version || \"2.0.0\", \"3.6\") < 0) {\n\t\t\t\t\t\taddEventListener(\"open\", () =>\n\t\t\t\t\t\t\twebsocket.send(JSON.stringify({ hash: session_hash }))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else if (protocol == \"sse\") {\n\t\t\t\t\tfire_event({\n\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t});\n\t\t\t\t\tvar params = new URLSearchParams({\n\t\t\t\t\t\tfn_index: fn_index.toString(),\n\t\t\t\t\t\tsession_hash: session_hash\n\t\t\t\t\t}).toString();\n\t\t\t\t\tlet url = new URL(\n\t\t\t\t\t\t`${config.root}${api_prefix}/${SSE_URL}?${\n\t\t\t\t\t\t\turl_params ? url_params + \"&\" : \"\"\n\t\t\t\t\t\t}${params}`\n\t\t\t\t\t);\n\n\t\t\t\t\tif (this.jwt) {\n\t\t\t\t\t\turl.searchParams.set(\"__sign\", this.jwt);\n\t\t\t\t\t}\n\n\t\t\t\t\tstream = this.stream(url);\n\n\t\t\t\t\tif (!stream) {\n\t\t\t\t\t\treturn Promise.reject(\n\t\t\t\t\t\t\tnew Error(\"Cannot connect to SSE endpoint: \" + url.toString())\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tstream.onmessage = async function (event: MessageEvent) {\n\t\t\t\t\t\tconst _data = JSON.parse(event.data);\n\t\t\t\t\t\tconst { type, status, data } = handle_message(\n\t\t\t\t\t\t\t_data,\n\t\t\t\t\t\t\tlast_status[fn_index]\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (type === \"update\" && status && !complete) {\n\t\t\t\t\t\t\t// call 'status' listeners\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t...status\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (status.stage === \"error\") {\n\t\t\t\t\t\t\t\tstream?.close();\n\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (type === \"data\") {\n\t\t\t\t\t\t\tlet [_, status] = await post_data(\n\t\t\t\t\t\t\t\t`${config.root}${api_prefix}/queue/data`,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...payload,\n\t\t\t\t\t\t\t\t\tsession_hash,\n\t\t\t\t\t\t\t\t\tevent_id\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (status !== 200) {\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\t\tmessage: BROKEN_CONNECTION_MSG,\n\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tstream?.close();\n\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (type === \"complete\") {\n\t\t\t\t\t\t\tcomplete = status;\n\t\t\t\t\t\t} else if (type === \"log\") {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"log\",\n\t\t\t\t\t\t\t\ttitle: data.title,\n\t\t\t\t\t\t\t\tlog: data.log,\n\t\t\t\t\t\t\t\tlevel: data.level,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tduration: data.duration,\n\t\t\t\t\t\t\t\tvisible: data.visible,\n\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (type === \"generating\" || type === \"streaming\") {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t...status,\n\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"data\",\n\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\tdata: handle_payload(\n\t\t\t\t\t\t\t\t\tdata.data,\n\t\t\t\t\t\t\t\t\tdependency,\n\t\t\t\t\t\t\t\t\tconfig.components,\n\t\t\t\t\t\t\t\t\t\"output\",\n\t\t\t\t\t\t\t\t\toptions.with_null_state\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\tevent_data,\n\t\t\t\t\t\t\t\ttrigger_id\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (complete) {\n\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t...complete,\n\t\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tstream?.close();\n\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t} else if (\n\t\t\t\t\tprotocol == \"sse_v1\" ||\n\t\t\t\t\tprotocol == \"sse_v2\" ||\n\t\t\t\t\tprotocol == \"sse_v2.1\" ||\n\t\t\t\t\tprotocol == \"sse_v3\"\n\t\t\t\t) {\n\t\t\t\t\t// latest API format. v2 introduces sending diffs for intermediate outputs in generative functions, which makes payloads lighter.\n\t\t\t\t\t// v3 only closes the stream when the backend sends the close stream message.\n\t\t\t\t\tfire_event({\n\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\tstage: \"pending\",\n\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t});\n\t\t\t\t\tlet hostname = \"\";\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof window !== \"undefined\" &&\n\t\t\t\t\t\ttypeof document !== \"undefined\"\n\t\t\t\t\t) {\n\t\t\t\t\t\thostname = window?.location?.hostname;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet hfhubdev = \"dev.spaces.huggingface.tech\";\n\t\t\t\t\tconst origin = hostname.includes(\".dev.\")\n\t\t\t\t\t\t? `https://moon-${hostname.split(\".\")[1]}.${hfhubdev}`\n\t\t\t\t\t\t: `https://huggingface.co`;\n\n\t\t\t\t\tconst is_zerogpu_iframe =\n\t\t\t\t\t\ttypeof window !== \"undefined\" &&\n\t\t\t\t\t\ttypeof document !== \"undefined\" &&\n\t\t\t\t\t\twindow.parent != window &&\n\t\t\t\t\t\twindow.supports_zerogpu_headers;\n\t\t\t\t\tconst zerogpu_auth_promise = is_zerogpu_iframe\n\t\t\t\t\t\t? post_message<Map<string, string>>(\"zerogpu-headers\", origin)\n\t\t\t\t\t\t: Promise.resolve(null);\n\t\t\t\t\tconst post_data_promise = zerogpu_auth_promise.then((headers) => {\n\t\t\t\t\t\treturn post_data(\n\t\t\t\t\t\t\t`${config.root}${api_prefix}/${SSE_DATA_URL}?${url_params}`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...payload,\n\t\t\t\t\t\t\t\tsession_hash\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\theaders\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\tpost_data_promise.then(async ([response, status]: any) => {\n\t\t\t\t\t\tif (status === 503) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\tmessage: QUEUE_FULL_MSG,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (status === 422) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\tmessage: response.detail,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\tcode: \"validation_error\",\n\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t} else if (status !== 200) {\n\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\tbroken: false,\n\t\t\t\t\t\t\t\tmessage: response.detail,\n\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tevent_id = response.event_id as string;\n\t\t\t\t\t\t\tevent_id_final = event_id;\n\t\t\t\t\t\t\tlet callback = async function (_data: object): Promise<void> {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst { type, status, data, original_msg } = handle_message(\n\t\t\t\t\t\t\t\t\t\t_data,\n\t\t\t\t\t\t\t\t\t\tlast_status[fn_index]\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\tif (type == \"heartbeat\") {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (type === \"update\" && status && !complete) {\n\t\t\t\t\t\t\t\t\t\t// call 'status' listeners\n\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t\t\toriginal_msg: original_msg,\n\t\t\t\t\t\t\t\t\t\t\t...status\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (type === \"complete\") {\n\t\t\t\t\t\t\t\t\t\tcomplete = status;\n\t\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\t\ttype == \"unexpected_error\" ||\n\t\t\t\t\t\t\t\t\t\ttype == \"broken_connection\"\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tconsole.error(\"Unexpected error\", status?.message);\n\t\t\t\t\t\t\t\t\t\tconst broken = type === \"broken_connection\";\n\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\t\t\t\t\tstatus?.message || \"An Unexpected Error Occurred!\",\n\t\t\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\tbroken,\n\t\t\t\t\t\t\t\t\t\t\tsession_not_found: status?.session_not_found,\n\t\t\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (type === \"log\") {\n\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"log\",\n\t\t\t\t\t\t\t\t\t\t\ttitle: data.title,\n\t\t\t\t\t\t\t\t\t\t\tlog: data.log,\n\t\t\t\t\t\t\t\t\t\t\tlevel: data.level,\n\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\tduration: data.duration,\n\t\t\t\t\t\t\t\t\t\t\tvisible: data.visible,\n\t\t\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else if (type === \"generating\" || type === \"streaming\") {\n\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t\t\t...status,\n\t\t\t\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tdata &&\n\t\t\t\t\t\t\t\t\t\t\tdependency.connection !== \"stream\" &&\n\t\t\t\t\t\t\t\t\t\t\t[\"sse_v2\", \"sse_v2.1\", \"sse_v3\"].includes(protocol)\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tapply_diff_stream(pending_diff_streams, event_id!, data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"data\",\n\t\t\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t\t\tdata: handle_payload(\n\t\t\t\t\t\t\t\t\t\t\t\tdata.data,\n\t\t\t\t\t\t\t\t\t\t\t\tdependency,\n\t\t\t\t\t\t\t\t\t\t\t\tconfig.components,\n\t\t\t\t\t\t\t\t\t\t\t\t\"output\",\n\t\t\t\t\t\t\t\t\t\t\t\toptions.with_null_state\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (data.render_config) {\n\t\t\t\t\t\t\t\t\t\t\tawait handle_render_config(data.render_config);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (complete) {\n\t\t\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\t\t\t\ttime: new Date(),\n\t\t\t\t\t\t\t\t\t\t\t\t...complete,\n\t\t\t\t\t\t\t\t\t\t\t\tstage: status?.stage!,\n\t\t\t\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\t\t\tfn_index\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tstatus?.stage === \"complete\" ||\n\t\t\t\t\t\t\t\t\t\tstatus?.stage === \"error\"\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tif (event_callbacks[event_id!]) {\n\t\t\t\t\t\t\t\t\t\t\tdelete event_callbacks[event_id!];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (event_id! in pending_diff_streams) {\n\t\t\t\t\t\t\t\t\t\t\tdelete pending_diff_streams[event_id!];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tconsole.error(\"Unexpected client exception\", e);\n\t\t\t\t\t\t\t\t\tfire_event({\n\t\t\t\t\t\t\t\t\t\ttype: \"status\",\n\t\t\t\t\t\t\t\t\t\tstage: \"error\",\n\t\t\t\t\t\t\t\t\t\tmessage: \"An Unexpected Error Occurred!\",\n\t\t\t\t\t\t\t\t\t\tqueue: true,\n\t\t\t\t\t\t\t\t\t\tendpoint: _endpoint,\n\t\t\t\t\t\t\t\t\t\tfn_index,\n\t\t\t\t\t\t\t\t\t\ttime: new Date()\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif ([\"sse_v2\", \"sse_v2.1\", \"sse_v3\"].includes(protocol)) {\n\t\t\t\t\t\t\t\t\t\tclose_stream(stream_status, that.abort_controller);\n\t\t\t\t\t\t\t\t\t\tstream_status.open = false;\n\t\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (event_id in pending_stream_messages) {\n\t\t\t\t\t\t\t\tpending_stream_messages[event_id].forEach((msg) =>\n\t\t\t\t\t\t\t\t\tcallback(msg)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tdelete pending_stream_messages[event_id];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tevent_callbacks[event_id] = callback;\n\t\t\t\t\t\t\tunclosed_events.add(event_id);\n\t\t\t\t\t\t\tif (!stream_status.open) {\n\t\t\t\t\t\t\t\tawait this.open_stream();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tlet done = false;\n\t\tconst values: (IteratorResult<GradioEvent> | PromiseLike<never>)[] = [];\n\t\tconst resolvers: ((\n\t\t\tvalue: IteratorResult<GradioEvent> | PromiseLike<never>\n\t\t) => void)[] = [];\n\n\t\tfunction close(): void {\n\t\t\tdone = true;\n\t\t\twhile (resolvers.length > 0)\n\t\t\t\t(resolvers.shift() as (typeof resolvers)[0])({\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t\tdone: true\n\t\t\t\t});\n\t\t}\n\n\t\tfunction push(\n\t\t\tdata: { value: GradioEvent; done: boolean } | PromiseLike<never>\n\t\t): void {\n\t\t\tif (resolvers.length > 0) {\n\t\t\t\t(resolvers.shift() as (typeof resolvers)[0])(data);\n\t\t\t} else {\n\t\t\t\tvalues.push(data);\n\t\t\t}\n\t\t}\n\n\t\tfunction push_error(error: unknown): void {\n\t\t\tpush(thenable_reject(error));\n\t\t\tclose();\n\t\t}\n\n\t\tfunction push_event(event: GradioEvent): void {\n\t\t\tpush({ value: event, done: false });\n\t\t}\n\n\t\tfunction next(): Promise<IteratorResult<GradioEvent, unknown>> {\n\t\t\tif (values.length > 0) {\n\t\t\t\treturn Promise.resolve(values.shift() as (typeof values)[0]);\n\t\t\t}\n\t\t\treturn new Promise((resolve) => resolvers.push(resolve));\n\t\t}\n\n\t\tconst iterator = {\n\t\t\t[Symbol.asyncIterator]: () => iterator,\n\t\t\tnext,\n\t\t\tthrow: async (value: unknown) => {\n\t\t\t\tpush_error(value);\n\t\t\t\treturn next();\n\t\t\t},\n\t\t\treturn: async () => {\n\t\t\t\tclose();\n\t\t\t\treturn next();\n\t\t\t},\n\t\t\tcancel,\n\t\t\tevent_id: event_id_cb\n\t\t};\n\n\t\treturn iterator;\n\t} catch (error) {\n\t\tconsole.error(\"Submit function encountered an error:\", error);\n\t\tthrow error;\n\t}\n}\n\nfunction thenable_reject<T>(error: T): PromiseLike<never> {\n\treturn {\n\t\tthen: (\n\t\t\tresolve: (value: never) => PromiseLike<never>,\n\t\t\treject: (error: T) => PromiseLike<never>\n\t\t) => reject(error)\n\t};\n}\n\nfunction get_endpoint_info(\n\tapi_info: ApiInfo<JsApiData>,\n\tendpoint: string | number,\n\tapi_map: Record<string, number>,\n\tconfig: Config\n): {\n\tfn_index: number;\n\tendpoint_info: EndpointInfo<JsApiData>;\n\tdependency: Dependency;\n} {\n\tlet fn_index: number;\n\tlet endpoint_info: EndpointInfo<JsApiData>;\n\tlet dependency: Dependency;\n\n\tif (typeof endpoint === \"number\") {\n\t\tfn_index = endpoint;\n\t\tendpoint_info = api_info.unnamed_endpoints[fn_index];\n\t\tdependency = config.dependencies.find((dep) => dep.id == endpoint)!;\n\t} else {\n\t\tconst trimmed_endpoint = endpoint.replace(/^\\//, \"\");\n\n\t\tfn_index = api_map[trimmed_endpoint];\n\t\tendpoint_info = api_info.named_endpoints[endpoint.trim()];\n\t\tdependency = config.dependencies.find(\n\t\t\t(dep) => dep.id == api_map[trimmed_endpoint]\n\t\t)!;\n\t}\n\n\tif (typeof fn_index !== \"number\") {\n\t\tthrow new Error(\n\t\t\t\"There is no endpoint matching that name of fn_index matching that number.\"\n\t\t);\n\t}\n\treturn { fn_index, endpoint_info, dependency };\n}\n","import type {\n\tApiData,\n\tApiInfo,\n\tClientOptions,\n\tConfig,\n\tDuplicateOptions,\n\tEndpointInfo,\n\tJsApiData,\n\tPredictReturn,\n\tSpaceStatus,\n\tStatus,\n\tUploadResponse,\n\tclient_return,\n\tSubmitIterable,\n\tGradioEvent\n} from \"./types\";\nimport { view_api } from \"./utils/view_api\";\nimport { upload_files } from \"./utils/upload_files\";\nimport { upload, FileData } from \"./upload\";\nimport { handle_blob } from \"./utils/handle_blob\";\nimport { post_data } from \"./utils/post_data\";\nimport { predict } from \"./utils/predict\";\nimport { duplicate } from \"./utils/duplicate\";\nimport { submit } from \"./utils/submit\";\nimport { RE_SPACE_NAME, process_endpoint } from \"./helpers/api_info\";\nimport {\n\tmap_names_to_ids,\n\tresolve_cookies,\n\tresolve_config,\n\tget_jwt,\n\tparse_and_set_cookies\n} from \"./helpers/init_helpers\";\nimport { check_and_wake_space, check_space_status } from \"./helpers/spaces\";\nimport { open_stream, readable_stream, close_stream } from \"./utils/stream\";\nimport {\n\tAPI_INFO_ERROR_MSG,\n\tAPP_ID_URL,\n\tCONFIG_ERROR_MSG,\n\tHEARTBEAT_URL,\n\tCOMPONENT_SERVER_URL\n} from \"./constants\";\n\ndeclare const BROWSER_BUILD: boolean;\n\nexport class Client {\n\tapp_reference: string;\n\toptions: ClientOptions;\n\tdeep_link: string | null = null;\n\n\tconfig: Config | undefined;\n\tapi_prefix = \"\";\n\tapi_info: ApiInfo<JsApiData> | undefined;\n\tapi_map: Record<string, number> = {};\n\tsession_hash: string = Math.random().toString(36).substring(2);\n\tjwt: string | false = false;\n\tlast_status: Record<string, Status[\"stage\"]> = {};\n\n\tprivate cookies: string | null = null;\n\n\t// streaming\n\tstream_status = { open: false };\n\tclosed = false;\n\tpending_stream_messages: Record<string, any[][]> = {};\n\tpending_diff_streams: Record<string, any[][]> = {};\n\tevent_callbacks: Record<string, (data?: unknown) => Promise<void>> = {};\n\tunclosed_events: Set<string> = new Set();\n\theartbeat_event: EventSource | null = null;\n\tabort_controller: AbortController | null = null;\n\tstream_instance: EventSource | null = null;\n\tcurrent_payload: any;\n\tws_map: Record<string, WebSocket | \"pending\" | \"failed\" | \"closed\"> = {};\n\n\tget_url_config(url: string | null = null): Config {\n\t\tif (!this.config) {\n\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t}\n\t\tif (url === null) {\n\t\t\turl = window.location.href;\n\t\t}\n\t\tconst stripSlashes = (str: string): string => str.replace(/^\\/+|\\/+$/g, \"\");\n\t\tlet root_path = stripSlashes(new URL(this.config.root).pathname);\n\t\tlet url_path = stripSlashes(new URL(url).pathname);\n\t\tlet page: string;\n\t\tif (!url_path.startsWith(root_path)) {\n\t\t\tpage = \"\";\n\t\t} else {\n\t\t\tpage = stripSlashes(url_path.substring(root_path.length));\n\t\t}\n\t\treturn this.get_page_config(page);\n\t}\n\tget_page_config(page: string): Config {\n\t\tif (!this.config) {\n\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t}\n\t\tlet config = this.config;\n\t\tif (!(page in config.page)) {\n\t\t\tpage = \"\";\n\t\t}\n\t\treturn {\n\t\t\t...config,\n\t\t\tcurrent_page: page,\n\t\t\tlayout: config.page[page].layout,\n\t\t\tcomponents: config.components.filter((c) =>\n\t\t\t\tconfig.page[page].components.includes(c.id)\n\t\t\t),\n\t\t\tdependencies: this.config.dependencies.filter((d) =>\n\t\t\t\tconfig.page[page].dependencies.includes(d.id)\n\t\t\t)\n\t\t};\n\t}\n\n\tfetch(input: RequestInfo | URL, init?: RequestInit): Promise<Response> {\n\t\tconst headers = new Headers(init?.headers || {});\n\t\tif (this && this.cookies) {\n\t\t\theaders.append(\"Cookie\", this.cookies);\n\t\t}\n\t\tif (this && this.options.headers) {\n\t\t\tfor (const name in this.options.headers) {\n\t\t\t\theaders.append(name, this.options.headers[name]);\n\t\t\t}\n\t\t}\n\n\t\treturn fetch(input, { ...init, headers });\n\t}\n\n\tstream(url: URL): EventSource {\n\t\tconst headers = new Headers();\n\t\tif (this && this.cookies) {\n\t\t\theaders.append(\"Cookie\", this.cookies);\n\t\t}\n\t\tif (this && this.options.headers) {\n\t\t\tfor (const name in this.options.headers) {\n\t\t\t\theaders.append(name, this.options.headers[name]);\n\t\t\t}\n\t\t}\n\t\tif (this && this.options.hf_token) {\n\t\t\theaders.append(\"Authorization\", `Bearer ${this.options.hf_token}`);\n\t\t}\n\n\t\tthis.abort_controller = new AbortController();\n\n\t\tthis.stream_instance = readable_stream(url.toString(), {\n\t\t\tcredentials: \"include\",\n\t\t\theaders: headers,\n\t\t\tsignal: this.abort_controller.signal\n\t\t});\n\n\t\treturn this.stream_instance;\n\t}\n\n\tview_api: () => Promise<ApiInfo<JsApiData>>;\n\tupload_files: (\n\t\troot_url: string,\n\t\tfiles: (Blob | File)[],\n\t\tupload_id?: string\n\t) => Promise<UploadResponse>;\n\tupload: (\n\t\tfile_data: FileData[],\n\t\troot_url: string,\n\t\tupload_id?: string,\n\t\tmax_file_size?: number\n\t) => Promise<(FileData | null)[] | null>;\n\thandle_blob: (\n\t\tendpoint: string,\n\t\tdata: unknown[],\n\t\tendpoint_info: EndpointInfo<ApiData | JsApiData>\n\t) => Promise<unknown[]>;\n\tpost_data: (\n\t\turl: string,\n\t\tbody: unknown,\n\t\tadditional_headers?: any\n\t) => Promise<unknown[]>;\n\tsubmit: (\n\t\tendpoint: string | number,\n\t\tdata: unknown[] | Record<string, unknown> | undefined,\n\t\tevent_data?: unknown,\n\t\ttrigger_id?: number | null,\n\t\tall_events?: boolean\n\t) => SubmitIterable<GradioEvent>;\n\tpredict: (\n\t\tendpoint: string | number,\n\t\tdata: unknown[] | Record<string, unknown> | undefined,\n\t\tevent_data?: unknown\n\t) => Promise<PredictReturn>;\n\topen_stream: () => Promise<void>;\n\tprivate resolve_config: (endpoint: string) => Promise<Config | undefined>;\n\tprivate resolve_cookies: () => Promise<void>;\n\tconstructor(\n\t\tapp_reference: string,\n\t\toptions: ClientOptions = { events: [\"data\"] }\n\t) {\n\t\tthis.app_reference = app_reference;\n\t\tthis.deep_link = options.query_params?.deep_link || null;\n\t\tif (!options.events) {\n\t\t\toptions.events = [\"data\"];\n\t\t}\n\n\t\tthis.options = options;\n\t\tthis.current_payload = {};\n\t\tthis.view_api = view_api.bind(this);\n\t\tthis.upload_files = upload_files.bind(this);\n\t\tthis.handle_blob = handle_blob.bind(this);\n\t\tthis.post_data = post_data.bind(this);\n\t\tthis.submit = submit.bind(this);\n\t\tthis.predict = predict.bind(this);\n\t\tthis.open_stream = open_stream.bind(this);\n\t\tthis.resolve_config = resolve_config.bind(this);\n\t\tthis.resolve_cookies = resolve_cookies.bind(this);\n\t\tthis.upload = upload.bind(this);\n\t\tthis.fetch = this.fetch.bind(this);\n\t\tthis.handle_space_success = this.handle_space_success.bind(this);\n\t\tthis.stream = this.stream.bind(this);\n\t}\n\n\tprivate async init(): Promise<void> {\n\t\tif (\n\t\t\t(typeof window === \"undefined\" || !(\"WebSocket\" in window)) &&\n\t\t\t!global.WebSocket\n\t\t) {\n\t\t\tif (!BROWSER_BUILD) {\n\t\t\t\tconst ws = await import(\"ws\");\n\t\t\t\tglobal.WebSocket = ws.WebSocket as unknown as typeof WebSocket;\n\t\t\t}\n\t\t}\n\n\t\tif (this.options.auth) {\n\t\t\tawait this.resolve_cookies();\n\t\t}\n\n\t\tawait this._resolve_config().then(({ config }) =>\n\t\t\tthis._resolve_heartbeat(config)\n\t\t);\n\n\t\tthis.api_info = await this.view_api();\n\t\tthis.api_map = map_names_to_ids(this.config?.dependencies || []);\n\t}\n\n\tasync _resolve_heartbeat(_config: Config): Promise<void> {\n\t\tif (_config) {\n\t\t\tthis.config = _config;\n\t\t\tthis.api_prefix = _config.api_prefix || \"\";\n\n\t\t\tif (this.config && this.config.connect_heartbeat) {\n\t\t\t\tif (this.config.space_id && this.options.hf_token) {\n\t\t\t\t\tthis.jwt = await get_jwt(\n\t\t\t\t\t\tthis.config.space_id,\n\t\t\t\t\t\tthis.options.hf_token,\n\t\t\t\t\t\tthis.cookies\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (_config.space_id && this.options.hf_token) {\n\t\t\tthis.jwt = await get_jwt(_config.space_id, this.options.hf_token);\n\t\t}\n\n\t\tif (this.config && this.config.connect_heartbeat) {\n\t\t\t// connect to the heartbeat endpoint via GET request\n\t\t\tconst heartbeat_url = new URL(\n\t\t\t\t`${this.config.root}${this.api_prefix}/${HEARTBEAT_URL}/${this.session_hash}`\n\t\t\t);\n\n\t\t\t// if the jwt is available, add it to the query params\n\t\t\tif (this.jwt) {\n\t\t\t\theartbeat_url.searchParams.set(\"__sign\", this.jwt);\n\t\t\t}\n\n\t\t\t// Just connect to the endpoint without parsing the response. Ref: https://github.com/gradio-app/gradio/pull/7974#discussion_r1557717540\n\t\t\tif (!this.heartbeat_event) {\n\t\t\t\tthis.heartbeat_event = this.stream(heartbeat_url);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic async connect(\n\t\tapp_reference: string,\n\t\toptions: ClientOptions = {\n\t\t\tevents: [\"data\"]\n\t\t}\n\t): Promise<Client> {\n\t\tconst client = new this(app_reference, options); // this refers to the class itself, not the instance\n\t\tif (options.session_hash) {\n\t\t\tclient.session_hash = options.session_hash;\n\t\t}\n\t\tawait client.init();\n\t\treturn client;\n\t}\n\n\tasync reconnect(): Promise<\"connected\" | \"broken\" | \"changed\"> {\n\t\tconst app_id_url = new URL(\n\t\t\t`${this.config!.root}${this.api_prefix}/${APP_ID_URL}`\n\t\t);\n\t\tlet app_id: string;\n\t\ttry {\n\t\t\tconst response = await this.fetch(app_id_url);\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t\tapp_id = ((await response.json()) as any).app_id;\n\t\t} catch (e) {\n\t\t\treturn \"broken\";\n\t\t}\n\t\tif (app_id !== this.config!.app_id) {\n\t\t\treturn \"changed\";\n\t\t}\n\t\treturn \"connected\";\n\t}\n\n\tclose(): void {\n\t\tthis.closed = true;\n\t\tclose_stream(this.stream_status, this.abort_controller);\n\t}\n\n\tset_current_payload(payload: any): void {\n\t\tthis.current_payload = payload;\n\t}\n\n\tstatic async duplicate(\n\t\tapp_reference: string,\n\t\toptions: DuplicateOptions = {\n\t\t\tevents: [\"data\"]\n\t\t}\n\t): Promise<Client> {\n\t\treturn duplicate(app_reference, options);\n\t}\n\n\tprivate async _resolve_config(): Promise<any> {\n\t\tconst { http_protocol, host, space_id } = await process_endpoint(\n\t\t\tthis.app_reference,\n\t\t\tthis.options.hf_token\n\t\t);\n\n\t\tconst { status_callback } = this.options;\n\n\t\tif (space_id && status_callback) {\n\t\t\tawait check_and_wake_space(space_id, status_callback);\n\t\t}\n\n\t\tlet config: Config | undefined;\n\n\t\ttry {\n\t\t\t// Create base URL\n\t\t\tlet configUrl = `${http_protocol}//${host}`;\n\t\t\tconfig = await this.resolve_config(configUrl);\n\n\t\t\tif (!config) {\n\t\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t\t}\n\n\t\t\treturn this.config_success(config);\n\t\t} catch (e: any) {\n\t\t\tif (space_id && status_callback) {\n\t\t\t\tcheck_space_status(\n\t\t\t\t\tspace_id,\n\t\t\t\t\tRE_SPACE_NAME.test(space_id) ? \"space_name\" : \"subdomain\",\n\t\t\t\t\tthis.handle_space_success\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tif (status_callback)\n\t\t\t\t\tstatus_callback({\n\t\t\t\t\t\tstatus: \"error\",\n\t\t\t\t\t\tmessage: \"Could not load this space.\",\n\t\t\t\t\t\tload_status: \"error\",\n\t\t\t\t\t\tdetail: \"NOT_FOUND\"\n\t\t\t\t\t});\n\t\t\t\tthrow Error(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async config_success(\n\t\t_config: Config\n\t): Promise<Config | client_return> {\n\t\tthis.config = _config;\n\t\tthis.api_prefix = _config.api_prefix || \"\";\n\n\t\tif (this.config.auth_required) {\n\t\t\treturn this.prepare_return_obj();\n\t\t}\n\n\t\ttry {\n\t\t\tthis.api_info = await this.view_api();\n\t\t} catch (e) {\n\t\t\tconsole.error(API_INFO_ERROR_MSG + (e as Error).message);\n\t\t}\n\n\t\treturn this.prepare_return_obj();\n\t}\n\n\tasync handle_space_success(status: SpaceStatus): Promise<Config | void> {\n\t\tif (!this) {\n\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t}\n\t\tconst { status_callback } = this.options;\n\t\tif (status_callback) status_callback(status);\n\t\tif (status.status === \"running\") {\n\t\t\ttry {\n\t\t\t\tthis.config = await this._resolve_config();\n\t\t\t\tthis.api_prefix = this?.config?.api_prefix || \"\";\n\n\t\t\t\tif (!this.config) {\n\t\t\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t\t\t}\n\n\t\t\t\tconst _config = await this.config_success(this.config);\n\n\t\t\t\treturn _config as Config;\n\t\t\t} catch (e) {\n\t\t\t\tif (status_callback) {\n\t\t\t\t\tstatus_callback({\n\t\t\t\t\t\tstatus: \"error\",\n\t\t\t\t\t\tmessage: \"Could not load this space.\",\n\t\t\t\t\t\tload_status: \"error\",\n\t\t\t\t\t\tdetail: \"NOT_FOUND\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async component_server(\n\t\tcomponent_id: number,\n\t\tfn_name: string,\n\t\tdata: unknown[] | { binary: boolean; data: Record<string, any> }\n\t): Promise<unknown> {\n\t\tif (!this.config) {\n\t\t\tthrow new Error(CONFIG_ERROR_MSG);\n\t\t}\n\n\t\tconst headers: {\n\t\t\tAuthorization?: string;\n\t\t\t\"Content-Type\"?: \"application/json\";\n\t\t} = {};\n\n\t\tconst { hf_token } = this.options;\n\t\tconst { session_hash } = this;\n\n\t\tif (hf_token) {\n\t\t\theaders.Authorization = `Bearer ${this.options.hf_token}`;\n\t\t}\n\n\t\tlet root_url: string;\n\t\tlet component = this.config.components.find(\n\t\t\t(comp) => comp.id === component_id\n\t\t);\n\t\tif (component?.props?.root_url) {\n\t\t\troot_url = component.props.root_url;\n\t\t} else {\n\t\t\troot_url = this.config.root;\n\t\t}\n\n\t\tlet body: FormData | string;\n\n\t\tif (\"binary\" in data) {\n\t\t\tbody = new FormData();\n\t\t\tfor (const key in data.data) {\n\t\t\t\tif (key === \"binary\") continue;\n\t\t\t\tbody.append(key, data.data[key]);\n\t\t\t}\n\t\t\tbody.set(\"component_id\", component_id.toString());\n\t\t\tbody.set(\"fn_name\", fn_name);\n\t\t\tbody.set(\"session_hash\", session_hash);\n\t\t} else {\n\t\t\tbody = JSON.stringify({\n\t\t\t\tdata: data,\n\t\t\t\tcomponent_id,\n\t\t\t\tfn_name,\n\t\t\t\tsession_hash\n\t\t\t});\n\n\t\t\theaders[\"Content-Type\"] = \"application/json\";\n\t\t}\n\n\t\tif (hf_token) {\n\t\t\theaders.Authorization = `Bearer ${hf_token}`;\n\t\t}\n\n\t\ttry {\n\t\t\tconst response = await this.fetch(\n\t\t\t\t`${root_url}${this.api_prefix}/${COMPONENT_SERVER_URL}/`,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: body,\n\t\t\t\t\theaders,\n\t\t\t\t\tcredentials: \"include\"\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Could not connect to component server: \" + response.statusText\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst output = await response.json();\n\t\t\treturn output;\n\t\t} catch (e) {\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\n\tpublic set_cookies(raw_cookies: string): void {\n\t\tthis.cookies = parse_and_set_cookies(raw_cookies).join(\"; \");\n\t}\n\n\tprivate prepare_return_obj(): client_return {\n\t\treturn {\n\t\t\tconfig: this.config,\n\t\t\tpredict: this.predict,\n\t\t\tsubmit: this.submit,\n\t\t\tview_api: this.view_api,\n\t\t\tcomponent_server: this.component_server\n\t\t};\n\t}\n\n\tprivate async connect_ws(url: string): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet ws;\n\t\t\ttry {\n\t\t\t\tws = new WebSocket(url);\n\t\t\t} catch (e) {\n\t\t\t\tthis.ws_map[url] = \"failed\";\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.ws_map[url] = \"pending\";\n\t\t\tws.onopen = () => {\n\t\t\t\tthis.ws_map[url] = ws;\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tws.onerror = (error) => {\n\t\t\t\tconsole.error(\"WebSocket error:\", error);\n\t\t\t\tthis.close_ws(url);\n\t\t\t\tthis.ws_map[url] = \"failed\";\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tws.onclose = () => {\n\t\t\t\tthis.ws_map[url] = \"closed\";\n\t\t\t};\n\n\t\t\tws.onmessage = (event) => {};\n\t\t});\n\t}\n\n\tasync send_ws_message(url: string, data: any): Promise<void> {\n\t\t// connect if not connected\n\t\tif (!(url in this.ws_map)) {\n\t\t\tawait this.connect_ws(url);\n\t\t} else if (\n\t\t\tthis.ws_map[url] === \"pending\" ||\n\t\t\tthis.ws_map[url] === \"closed\" ||\n\t\t\tthis.ws_map[url] === \"failed\"\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tconst ws = this.ws_map[url];\n\t\tif (ws instanceof WebSocket) {\n\t\t\tws.send(JSON.stringify(data));\n\t\t} else {\n\t\t\tthis.post_data(url, data);\n\t\t}\n\t}\n\n\tasync close_ws(url: string): Promise<void> {\n\t\tif (url in this.ws_map) {\n\t\t\tconst ws = this.ws_map[url];\n\t\t\tif (ws instanceof WebSocket) {\n\t\t\t\tws.close();\n\t\t\t\tdelete this.ws_map[url];\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @deprecated This method will be removed in v1.0. Use `Client.connect()` instead.\n * Creates a client instance for interacting with Gradio apps.\n *\n * @param {string} app_reference - The reference or URL to a Gradio space or app.\n * @param {ClientOptions} options - Configuration options for the client.\n * @returns {Promise<Client>} A promise that resolves to a `Client` instance.\n */\nexport async function client(\n\tapp_reference: string,\n\toptions: ClientOptions = {\n\t\tevents: [\"data\"]\n\t}\n): Promise<Client> {\n\treturn await Client.connect(app_reference, options);\n}\n\n/**\n * @deprecated This method will be removed in v1.0. Use `Client.duplicate()` instead.\n * Creates a duplicate of a space and returns a client instance for the duplicated space.\n *\n * @param {string} app_reference - The reference or URL to a Gradio space or app to duplicate.\n * @param {DuplicateOptions} options - Configuration options for the client.\n * @returns {Promise<Client>} A promise that resolves to a `Client` instance.\n */\nexport async function duplicate_space(\n\tapp_reference: string,\n\toptions: DuplicateOptions\n): Promise<Client> {\n\treturn await Client.duplicate(app_reference, options);\n}\n\nexport type ClientInstance = Client;\n","import \"@gradio/theme/reset.css\";\nimport \"@gradio/theme/global.css\";\nimport \"@gradio/theme/pollen.css\";\nimport \"@gradio/theme/typography.css\";\n//@ts-ignore\nimport * as svelte from \"./svelte/svelte.js\";\nimport { Client } from \"@gradio/client\";\nimport type Index from \"./Index.svelte\";\nimport type { ThemeMode } from \"@gradio/core\";\n\ndeclare let BUILD_MODE: string;\ndeclare let GRADIO_VERSION: string;\n\nconst ENTRY_CSS = \"__ENTRY_CSS__\";\n\nlet FONTS: string | [];\n\nFONTS = \"__FONTS_CSS__\";\n\nlet IndexComponent: typeof Index;\nlet mount_css: typeof import(\"@gradio/core\").mount_css;\nlet _res: (value?: unknown) => void;\nlet pending = new Promise((res) => {\n\t_res = res;\n});\nasync function get_index(): Promise<void> {\n\tconst modules = await Promise.all([\n\t\timport(\"./Index.svelte\"),\n\t\timport(\"@gradio/core\")\n\t]);\n\tIndexComponent = modules[0].default;\n\tmount_css = modules[1].mount_css;\n\t_res();\n}\n\nfunction create_custom_element(): void {\n\tconst o = {\n\t\tSvelteComponent: svelte.SvelteComponent\n\t};\n\tfor (const key in svelte) {\n\t\tif (key === \"SvelteComponent\") continue;\n\t\tif (key === \"SvelteComponentDev\") {\n\t\t\t//@ts-ignore\n\t\t\to[key] = o[\"SvelteComponent\"];\n\t\t} else {\n\t\t\t//@ts-ignore\n\t\t\to[key] = svelte[key];\n\t\t}\n\t}\n\t//@ts-ignore\n\twindow.__gradio__svelte__internal = o;\n\tclass GradioApp extends HTMLElement {\n\t\tcontrol_page_title: string | null;\n\t\tinitial_height: string;\n\t\tis_embed: string;\n\t\tcontainer: string;\n\t\tinfo: string | true;\n\t\tautoscroll: string | null;\n\t\teager: string | null;\n\t\ttheme_mode: ThemeMode | null;\n\t\thost: string | null;\n\t\tspace: string | null;\n\t\tsrc: string | null;\n\t\tapp?: Index;\n\t\tloading: boolean;\n\t\tupdating: { name: string; value: string } | false;\n\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t\tthis.host = this.getAttribute(\"host\");\n\t\t\tthis.space = this.getAttribute(\"space\");\n\t\t\tthis.src = this.getAttribute(\"src\");\n\n\t\t\tthis.control_page_title = this.getAttribute(\"control_page_title\");\n\t\t\tthis.initial_height = this.getAttribute(\"initial_height\") ?? \"300px\"; // default: 300px\n\t\t\tthis.is_embed = this.getAttribute(\"embed\") ?? \"true\"; // default: true\n\t\t\tthis.container = this.getAttribute(\"container\") ?? \"true\"; // default: true\n\t\t\tthis.info = this.getAttribute(\"info\") ?? true; // default: true\n\t\t\tthis.autoscroll = this.getAttribute(\"autoscroll\");\n\t\t\tthis.eager = this.getAttribute(\"eager\");\n\t\t\tthis.theme_mode = this.getAttribute(\"theme_mode\") as ThemeMode | null;\n\t\t\tthis.updating = false;\n\t\t\tthis.loading = false;\n\t\t}\n\n\t\tasync connectedCallback(): Promise<void> {\n\t\t\tawait get_index();\n\t\t\tthis.loading = true;\n\n\t\t\tif (this.app) {\n\t\t\t\tthis.app.$destroy();\n\t\t\t}\n\n\t\t\tif (typeof FONTS !== \"string\") {\n\t\t\t\tFONTS.forEach((f) => mount_css(f, document.head));\n\t\t\t}\n\n\t\t\tawait mount_css(ENTRY_CSS, document.head);\n\n\t\t\tconst event = new CustomEvent(\"domchange\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: false,\n\t\t\t\tcomposed: true\n\t\t\t});\n\n\t\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\t\tthis.dispatchEvent(event);\n\t\t\t});\n\n\t\t\tobserver.observe(this, { childList: true });\n\n\t\t\tthis.app = new IndexComponent({\n\t\t\t\ttarget: this,\n\t\t\t\tprops: {\n\t\t\t\t\t// embed source\n\t\t\t\t\tspace: this.space ? this.space.trim() : this.space,\n\t\t\t\t\tsrc: this.src ? this.src.trim() : this.src,\n\t\t\t\t\t// embed info\n\t\t\t\t\tinfo: this.info === \"false\" ? false : true,\n\t\t\t\t\tcontainer: this.container === \"false\" ? false : true,\n\t\t\t\t\tis_embed: this.is_embed === \"false\" ? false : true,\n\t\t\t\t\tinitial_height: this.initial_height,\n\t\t\t\t\teager: this.eager === \"true\" ? true : false,\n\t\t\t\t\t// gradio meta info\n\t\t\t\t\tversion: GRADIO_VERSION,\n\t\t\t\t\ttheme_mode: this.theme_mode,\n\t\t\t\t\t// misc global behaviour\n\t\t\t\t\tautoscroll: this.autoscroll === \"true\" ? true : false,\n\t\t\t\t\tcontrol_page_title: this.control_page_title === \"true\" ? true : false,\n\t\t\t\t\t// injectables\n\t\t\t\t\tClient,\n\t\t\t\t\t// for gradio docs\n\t\t\t\t\t// TODO: Remove -- i think this is just for autoscroll behavhiour, app vs embeds\n\t\t\t\t\tapp_mode: window.__gradio_mode__ === \"app\"\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.updating) {\n\t\t\t\tthis.setAttribute(this.updating.name, this.updating.value);\n\t\t\t}\n\n\t\t\tthis.loading = false;\n\t\t}\n\n\t\tstatic get observedAttributes(): [\"src\", \"space\", \"host\"] {\n\t\t\treturn [\"src\", \"space\", \"host\"];\n\t\t}\n\n\t\tasync attributeChangedCallback(\n\t\t\tname: string,\n\t\t\told_val: string,\n\t\t\tnew_val: string\n\t\t): Promise<void> {\n\t\t\tawait pending;\n\t\t\tif (\n\t\t\t\t(name === \"host\" || name === \"space\" || name === \"src\") &&\n\t\t\t\tnew_val !== old_val\n\t\t\t) {\n\t\t\t\tthis.updating = { name, value: new_val };\n\t\t\t\tif (this.loading) return;\n\n\t\t\t\tif (this.app) {\n\t\t\t\t\tthis.app.$destroy();\n\t\t\t\t}\n\n\t\t\t\tthis.space = null;\n\t\t\t\tthis.host = null;\n\t\t\t\tthis.src = null;\n\n\t\t\t\tif (name === \"host\") {\n\t\t\t\t\tthis.host = new_val;\n\t\t\t\t} else if (name === \"space\") {\n\t\t\t\t\tthis.space = new_val;\n\t\t\t\t} else if (name === \"src\") {\n\t\t\t\t\tthis.src = new_val;\n\t\t\t\t}\n\n\t\t\t\tthis.app = new IndexComponent({\n\t\t\t\t\ttarget: this,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t// embed source\n\t\t\t\t\t\tspace: this.space ? this.space.trim() : this.space,\n\t\t\t\t\t\tsrc: this.src ? this.src.trim() : this.src,\n\t\t\t\t\t\t// embed info\n\t\t\t\t\t\tinfo: this.info === \"false\" ? false : true,\n\t\t\t\t\t\tcontainer: this.container === \"false\" ? false : true,\n\t\t\t\t\t\tis_embed: this.is_embed === \"false\" ? false : true,\n\t\t\t\t\t\tinitial_height: this.initial_height,\n\t\t\t\t\t\teager: this.eager === \"true\" ? true : false,\n\t\t\t\t\t\t// gradio meta info\n\t\t\t\t\t\tversion: GRADIO_VERSION,\n\t\t\t\t\t\ttheme_mode: this.theme_mode,\n\t\t\t\t\t\t// misc global behaviour\n\t\t\t\t\t\tautoscroll: this.autoscroll === \"true\" ? true : false,\n\t\t\t\t\t\tcontrol_page_title:\n\t\t\t\t\t\t\tthis.control_page_title === \"true\" ? true : false,\n\t\t\t\t\t\t// injectables\n\t\t\t\t\t\tClient,\n\t\t\t\t\t\t// for gradio docs\n\t\t\t\t\t\t// TODO: Remove -- i think this is just for autoscroll behavhiour, app vs embeds\n\t\t\t\t\t\tapp_mode: window.__gradio_mode__ === \"app\"\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.updating = false;\n\t\t\t}\n\t\t}\n\t}\n\tif (!customElements.get(\"gradio-app\"))\n\t\tcustomElements.define(\"gradio-app\", GradioApp);\n}\n\ncreate_custom_element();\n"],"file":"assets/index-sqki5BVz.js"}